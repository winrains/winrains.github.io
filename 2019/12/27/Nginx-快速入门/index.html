<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://winrains.cn').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="一、前言Nginx 是一个高性能的 Web 和反向代理服务器, 它具有有很多非常优越的特性。">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx 快速入门">
<meta property="og:url" content="http:&#x2F;&#x2F;winrains.cn&#x2F;2019&#x2F;12&#x2F;27&#x2F;Nginx-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8&#x2F;index.html">
<meta property="og:site_name" content="个人博客">
<meta property="og:description" content="一、前言Nginx 是一个高性能的 Web 和反向代理服务器, 它具有有很多非常优越的特性。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;09&#x2F;30042-nginx-logo.png">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;09&#x2F;3d75c-nginx-01.jpg">
<meta property="og:updated_time" content="2019-12-27T07:52:41.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;09&#x2F;30042-nginx-logo.png">

<link rel="canonical" href="http://winrains.cn/2019/12/27/Nginx-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>Nginx 快速入门 | 个人博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">winrains的个人博客</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">85</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">65</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">289</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://winrains.cn/2019/12/27/Nginx-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="winrains">
      <meta itemprop="description" content="淡泊明志">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Nginx 快速入门
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-27 15:52:41" itemprop="dateCreated datePublished" datetime="2019-12-27T15:52:41+08:00">2019-12-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%85%B6%E5%AE%83%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">其它技术</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%85%B6%E5%AE%83%E6%8A%80%E6%9C%AF/Nginx/" itemprop="url" rel="index">
                    <span itemprop="name">Nginx</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><a href="http://image.winrains.cn/2019/09/30042-nginx-logo.png" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/09/30042-nginx-logo.png" alt="img"></a></p>
<h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>Nginx 是一个高性能的 Web 和反向代理服务器, 它具有有很多非常优越的特性。</p>
<a id="more"></a>

<h3 id="1-1-作为-Web-服务器"><a href="#1-1-作为-Web-服务器" class="headerlink" title="# 1.1 作为 Web 服务器"></a># 1.1 作为 Web 服务器</h3><p>相比 Apache，Nginx 使用更少的资源，支持更多的并发连接，体现更高的效率。能够支持高达 50,000 个并发连接数的响应，其使用 epoll and kqueue 作为开发模型。</p>
<h3 id="1-2-作为负载均衡服务器"><a href="#1-2-作为负载均衡服务器" class="headerlink" title="# 1.2 作为负载均衡服务器"></a># 1.2 作为负载均衡服务器</h3><p>Nginx 既可以在内部直接支持 Rails 和 PHP，也可以支持作为 HTTP代理服务器 对外进行服务。Nginx 用 C 编写, 不论是系统资源开销还是 CPU 使用效率都比 Perlbal 要好的多。<br>Nginx 安装非常的简单，配置文件 非常简洁（还能够支持perl语法），Bugs 非常少的服务器: Nginx 启动特别容易，并且几乎可以做到 7*24 不间断运行，即使运行数个月也不需要重新启动。</p>
<h2 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h2><h3 id="2-1-添加仓库资源"><a href="#2-1-添加仓库资源" class="headerlink" title="# 2.1 添加仓库资源"></a># 2.1 添加仓库资源</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/etc/yum</span>.repos.d<span class="regexp">/nginx.repo</span></span></pre></td></tr></table></figure>

<p>添加如下内容：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="section">[nginx]</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attr">name</span>=nginx repo</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="attr">baseurl</span>=http://nginx.org/packages/centos/<span class="number">7</span>/<span class="variable">$basearch</span>/</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="attr">gpgcheck</span>=<span class="number">0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="attr">enabled</span>=<span class="number">1</span></span></pre></td></tr></table></figure>

<p><strong>注意 <code>baseurl=http://nginx.org/packages/OS/OSRELEASE/$basearch/</code> 中<code>OS/OSRELEASE</code> 表示系统和版本号，根据自己情况而定。</strong></p>
<h3 id="2-2-查看-yum-资源列表"><a href="#2-2-查看-yum-资源列表" class="headerlink" title="# 2.2 查看 yum 资源列表"></a># 2.2 查看 yum 资源列表</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">list</span> | <span class="keyword">grep</span> nginx</span></pre></td></tr></table></figure>

<h3 id="2-3-安装"><a href="#2-3-安装" class="headerlink" title="# 2.3 安装"></a># 2.3 安装</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> nginx</span></pre></td></tr></table></figure>

<h3 id="2-4-查看版本"><a href="#2-4-查看版本" class="headerlink" title="# 2.4 查看版本"></a># 2.4 查看版本</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">nginx</span> -v <span class="comment"># 使用 -V 可以查看 nginx 安装时依赖的模块</span></span></pre></td></tr></table></figure>

<h3 id="2-5-常用命令"><a href="#2-5-常用命令" class="headerlink" title="# 2.5 常用命令"></a># 2.5 常用命令</h3><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="meta"># 启动 nginx 服务</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">nginx</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="meta"># 重启 nginx 服务</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">nginx -s reload</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="meta"># 关闭 nginx 服务</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">nginx -s quit</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="meta"># 测试 nginx.conf 配置文件合法性</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">nginx -t</span></pre></td></tr></table></figure>

<h3 id="2-6-信号量"><a href="#2-6-信号量" class="headerlink" title="# 2.6 信号量"></a># 2.6 信号量</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新加载配置文件</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">kill HUP `cat /var/<span class="keyword">run</span><span class="bash">/nginx.pid`</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重读日志文件</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">kill USR1 `cat /var/<span class="keyword">run</span><span class="bash">/nginx.pid`</span></span></pre></td></tr></table></figure>

<p>下图为启动 nginx 服务的默认首页：<br><a href="http://image.winrains.cn/2019/09/3d75c-nginx-01.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/09/3d75c-nginx-01.jpg" alt="img"></a></p>
<h2 id="三、目录-文件介绍"><a href="#三、目录-文件介绍" class="headerlink" title="三、目录/文件介绍"></a>三、目录/文件介绍</h2><h3 id="3-1-目录介绍"><a href="#3-1-目录介绍" class="headerlink" title="# 3.1 目录介绍"></a># 3.1 目录介绍</h3><p>日志相关</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="meta-keyword">/etc/</span>logrotate.d/nginx <span class="meta"># Nginx 日志轮转，用于 logrotate 服务的日志切割</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="meta-keyword">/var/</span>log/nginx         <span class="meta"># 存放请求日志和错误日志</span></span></pre></td></tr></table></figure>

<p>服务配置相关</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">/etc/nginx/nginx.conf           <span class="comment"># 主配置文件</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">/etc/nginx/conf.d/default.conf  <span class="comment"># 默认加载配置文件</span></span></pre></td></tr></table></figure>

<p>编码相关</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">/etc/nginx/koi-utf</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">/etc/nginx/koi-win</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">/etc/nginx/win-utf</span></pre></td></tr></table></figure>

<p>请求类型相关</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="meta-keyword">/etc/</span>nginx/mime.types <span class="meta"># 设置 http 协议的 Content-Type 与扩展名对应关系</span></span></pre></td></tr></table></figure>

<p>守护进程相关</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">nginx</span>-<span class="title">debug</span>.<span class="title">service</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">nginx</span>.<span class="title">service</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">/etc/sysconfig/nginx</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">/etc/sysconfig/nginx-debug</span></pre></td></tr></table></figure>

<p>模块相关</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>lib64<span class="regexp">/nginx/m</span>odules</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>nginx<span class="regexp">/modules</span></span></pre></td></tr></table></figure>

<p>命令相关</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="meta-keyword">/usr/</span>sbin/nginx</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="meta-keyword">/usr/</span>sbin/nginx-debug</span></pre></td></tr></table></figure>

<p>帮助文档</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">/usr/share/doc/nginx<span class="number">-1.12</span><span class="number">.1</span></span></pre></td></tr></table></figure>

<p>缓存相关</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">/<span class="built_in">var</span>/<span class="keyword">cache</span>/nginx</span></pre></td></tr></table></figure>

<h3 id="3-2-配置文件介绍"><a href="#3-2-配置文件介绍" class="headerlink" title="# 3.2 配置文件介绍"></a># 3.2 配置文件介绍</h3><p>以下是主配置文件内容（<code>/etc/nginx/nginx.conf</code> 和 <code>/etc/nginx/conf.d/default.conf</code>），下文介绍的内容基本上都是在配置文件中进行配置。<br>其中，<code>/etc/nginx/nginx.conf</code> 引用了 <code>/etc/nginx/conf.d/default.conf</code> 内容。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#运行用户</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span> nginx;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动进程,通常设置成和cpu的数量相等</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#全局错误日志及PID文件</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">error_log</span>  /var/log/nginx/error.log <span class="literal">warn</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">pid</span>        /var/run/nginx.pid;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#工作模式及连接数上限</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="section">events</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">#epoll是多路复用IO(I/O Multiplexing)中的一种方式,</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">#仅用于linux2.6以上内核,可以大大提高nginx的性能</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">use</span>   <span class="literal">epoll</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">#单个后台worker process进程的最大并发链接数</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">#设定mime类型,类型由mime.type文件定义</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">include</span>       /etc/nginx/mime.types;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">#设定日志格式</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" '</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">                      <span class="string">'<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">                      <span class="string">'"<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">access_log</span>  /var/log/nginx/access.log  main;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">#sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">#对于普通应用，必须设为 on,</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">#如果用来进行下载等应用磁盘IO重负载应用，可设置为 off，</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">#以平衡磁盘与网络I/O处理速度，降低系统的uptime.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">sendfile</span>     <span class="literal">on</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">#tcp_nopush     on;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">#连接超时时间</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">tcp_nodelay</span>     <span class="literal">on</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">#开启gzip压缩</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">gzip</span>  <span class="literal">on</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">gzip_disable</span> <span class="string">"MSIE [1-6]."</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">#设定请求缓冲</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">client_header_buffer_size</span>    <span class="number">128k</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">large_client_header_buffers</span>  <span class="number">4</span> <span class="number">128k</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">#设定虚拟主机配置</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">    <span class="section">server</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">#侦听80端口</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">listen</span>    <span class="number">80</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">#定义使用 www.extlight.com访问</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">server_name</span>  www.extlight.com;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">#设定本虚拟主机的访问日志</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">access_log</span>  logs/nginx.access.log  main;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">#默认请求</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">location</span> / &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">            <span class="comment">#定义服务器的默认网站根目录位置</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">            <span class="attribute">root</span>   /usr/share/nginx/html;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line">            <span class="comment">#定义首页索引文件的名称</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">            <span class="attribute">index</span>  index.html index.htm;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line">        <span class="comment"># 定义错误提示页面</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">location</span> = /50x.html &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">            <span class="attribute">root</span>   /usr/share/nginx/html;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h2 id="四、location-讲解"><a href="#四、location-讲解" class="headerlink" title="四、location 讲解"></a>四、location 讲解</h2><p>location 用于匹配客户端发送的 url ，从而定位请求资源。<br>匹配方式大致分成 3 类：</p>
<ol>
<li>location = xxx {} # 精准匹配</li>
<li>location pattern {} # 一般匹配</li>
<li>location ~ pattern {} # 正则表达式匹配</li>
</ol>
<h3 id="4-1-案例分析"><a href="#4-1-案例分析" class="headerlink" title="# 4.1 案例分析"></a># 4.1 案例分析</h3><p>假设 Nginx 配置文件中有如下配置：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">= / &#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="title">    [ 配置 A</span> ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">/ &#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="title">    [ 配置 B</span> ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">/documents</span>/ &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    [ 配置 C ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">^~ /images</span>/ &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    [ 配置 D ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">~* \.(gif</span>|jpg|jpeg)$ &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    [ 配置 E ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>当请求 <a href="http://192.168.2.25/" target="_blank" rel="noopener">http://192.168.2.25/</a> 时，会定位到配置 A；<br>当请求 <a href="http://192.168.2.25/index.html" target="_blank" rel="noopener">http://192.168.2.25/index.html</a> 时，会定位到配置 B；<br>当请求 <a href="http://192.168.2.25/documents/document.html" target="_blank" rel="noopener">http://192.168.2.25/documents/document.html</a> 时，会定位到配置 C；<br>当请求 <a href="http://192.168.2.25/images/1.gif" target="_blank" rel="noopener">http://192.168.2.25/images/1.gif</a> 时，会定位到配置 D；<br>当请求 <a href="http://192.168.2.25/documents/1.jpg" target="_blank" rel="noopener">http://192.168.2.25/documents/1.jpg</a> 时，会定位到配置 E。</p>
<h2 id="五、rewrite-重写"><a href="#五、rewrite-重写" class="headerlink" title="五、rewrite 重写"></a>五、rewrite 重写</h2><p>使用 Nginx 提供的全局变量或自己设置的变量，结合正则表达式和标志位实现 url 重写以及重定向。<br>rewrite 使用范围：在 server、location 和 if 中。<br>rewrite 与 location 的区别：rewrite 是在同一域名内更改获取资源的路径，而 location 是对一类路径做控制访问或反向代理。</p>
<h3 id="5-1-rewrite-语法"><a href="#5-1-rewrite-语法" class="headerlink" title="# 5.1 rewrite 语法"></a># 5.1 rewrite 语法</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">rewrite</span> regex replacement<span class="meta"> [flag]</span></span></pre></td></tr></table></figure>

<p>语法说明：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">regex：正则表达式</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attr">replacement</span> <span class="string">：重定向位置</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="attr">flag：标志位</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">last</span> : <span class="string">相当于Apache的[L]标记，表示完成rewrite</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">break</span> : <span class="string">停止执行当前虚拟主机的后续rewrite指令集</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">redirect</span> : <span class="string">返回302临时重定向，地址栏会显示跳转后的地址</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">permanent</span> : <span class="string">返回301永久重定向，地址栏会显示跳转后的地址</span></span></pre></td></tr></table></figure>

<h3 id="5-2-if-语法"><a href="#5-2-if-语法" class="headerlink" title="# 5.2 if 语法"></a># 5.2 if 语法</h3><p>如果在 if 中执行 rewrite 操作，需要了解如下判断规则：</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(condition)<span class="meta">&#123;...&#125;</span></span></pre></td></tr></table></figure>

<p>判断规则：</p>
<figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">当表达式只是一个变量时，如果值为空或任何以 <span class="number">0</span> 开头的字符串都会当做 false</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">直接比较变量和内容时，使用 = 或 !=</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">~ 正则表达式匹配，~*不区分大小写的匹配，!~ 区分大小写的不匹配</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">-f 和 !-f 用来判断是否存在文件</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">-d 和 !-d 用来判断是否存在目录</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">-e 和 !-e 用来判断是否存在文件或目录</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">-x 和 !-x 用来判断文件是否可执行</span></pre></td></tr></table></figure>

<h3 id="5-3-案例介绍"><a href="#5-3-案例介绍" class="headerlink" title="# 5.3 案例介绍"></a># 5.3 案例介绍</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ MSIE) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    rewrite ^(.*)$ /msie/<span class="variable">$1</span> <span class="keyword">break</span>; # 如果UA包含<span class="string">"MSIE"</span>，rewrite请求到/msie/目录下</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$http_cookie</span> ~* <span class="string">"id=([^;]+)(?:;|$)"</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">set</span> <span class="variable">$id</span> <span class="variable">$1</span>; # 如果cookie匹配正则，设置变量<span class="variable">$id</span>等于正则引用部分</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"> &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$request_method</span> = <span class="keyword">POST</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> 405; # 如果提交方法为<span class="keyword">POST</span>，则返回状态405（Method not allowed）。<span class="keyword">return</span>不能返回301,302</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$slow</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    limit_rate 10k; # 限速，<span class="variable">$slow</span>可以通过 <span class="keyword">set</span> 指令设置</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!-f <span class="variable">$request_filename</span>)&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">break</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    proxy_pass  http:<span class="comment">//127.0.0.1; # 如果请求的文件名不存在，则反向代理到 localhost 。这里的break也是停止rewrite检查</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$args</span> ~ <span class="keyword">post</span>=140)&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    rewrite ^ http:<span class="comment">//example.com/ permanent; # 如果query string中包含"post=140"，永久重定向到 example.com</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>常用变量如下：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$args             <span class="meta"># 这个变量等于请求行中的参数，同 $query_string</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$content_length   <span class="meta"># 请求头中的 Content-length 字段。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$content_type     <span class="meta"># 请求头中的 Content-Type 字段。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">$document_root    <span class="meta"># 当前请求在 root 指令中指定的值。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">$host             <span class="meta"># 请求主机头字段，否则为服务器名称。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">$http_user_agent  <span class="meta"># 客户端 agent 信息</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">$http_cookie      <span class="meta"># 客户端 cookie 信息</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">$limit_rate       <span class="meta"># 这个变量可以限制连接速率。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">$request_method   <span class="meta"># 客户端请求的动作，通常为 GET 或 POST。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">$remote_addr      <span class="meta"># 客户端的IP地址。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">$remote_port      <span class="meta"># 客户端的端口。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">$remote_user      <span class="meta"># 已经经过 Auth Basic Module 验证的用户名。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">$request_filename <span class="meta"># 当前请求的文件路径，由 root 或 alias 指令与 URI 请求生成。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">$scheme           <span class="meta"># HTTP 方法（如http，https）。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">$server_protocol  <span class="meta"># 请求使用的协议，通常是 HTTP/1.0 或 HTTP/1.1。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">$server_addr      <span class="meta"># 服务器地址，在完成一次系统调用后可以确定这个值。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">$server_name      <span class="meta"># 服务器名称。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">$server_port      <span class="meta"># 请求到达服务器的端口号。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">$request_uri      <span class="meta"># 包含请求参数的原始URI，不包含主机名，如：”/foo/bar.php?arg=baz”。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">$uri              <span class="meta"># 不带请求参数的当前URI，$uri不包含主机名，如”/foo/bar.html”。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">$document_uri     <span class="meta"># 与 $uri 相同。</span></span></pre></td></tr></table></figure>

<h2 id="六、访问控制"><a href="#六、访问控制" class="headerlink" title="六、访问控制"></a>六、访问控制</h2><p>依赖 <strong><a href="http://nginx.org/en/docs/http/ngx_http_access_module.html" target="_blank" rel="noopener">ngx_http_access_module</a></strong> 模块。<br>在 <code>/etc/nginx/nginx.conf</code> 文件末尾中，有一行 <code>include /etc/nginx/conf.d/*.conf;</code> 设置，表示该文件会引入 <code>/etc/nginx/conf.d/</code> 下的 .conf 结尾的文件。<br>在 <code>/etc/nginx/conf.d/</code> 下有一个 <code>default.conf</code> 文件，我们修改其部分内容：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">server_name</span>  access;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">root</span>   /usr/share/nginx/html;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">deny</span>   <span class="number">192.168.2.2</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">allow</span> all;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">index</span>  index.html index.htm;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>在 location 中配置了 deny 和 allow，表示除了 192.168.2.2 的 ip，允许其他 ip 访问 nginx。其中，192.168.2.2 为宿主机 ip 地址。</p>
<h2 id="七、文件压缩"><a href="#七、文件压缩" class="headerlink" title="七、文件压缩"></a>七、文件压缩</h2><p>依赖 <strong><a href="http://nginx.org/en/docs/http/ngx_http_gzip_module.html" target="_blank" rel="noopener">ngx_http_gzip_module</a></strong> 模块。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">location</span> ~* \.(jpg|gif|png|txt|<span class="type">xml</span>)$ &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    gzip <span class="keyword">on</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    gzip_http_version <span class="number">1.1</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    gzip_comp_level <span class="number">6</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    gzip_types <span class="type">text</span>/plain <span class="type">text</span>/css application/<span class="type">json</span> application/x-javascript <span class="type">text</span>/<span class="type">xml</span> application/<span class="type">xml</span> application/<span class="type">xml</span>+rss <span class="type">text</span>/javascript image/jpeg image/gif image/png</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    ;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    root /opt/test;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>压缩 <code>/opt/test</code> 目录下的资源。可通过浏览器调试工具查看请求返回加载资源文件的大小。<br>常用配置说明：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip</span> <span class="literal">on</span>|<span class="literal">off</span>;               <span class="comment"># 是否开启 gzip，默认值为 off。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip_buffers</span> <span class="number">32</span> <span class="number">4k</span>|<span class="number">16</span> <span class="number">8k</span>;  <span class="comment"># 缓冲，压缩在内存中缓存分成几块，每块大小</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip_comp_level</span> [<span class="number">1</span>~<span class="number">9</span>];     <span class="comment"># 指定 gzip 压缩程度。推荐使用 6。压缩级别越高，越浪费 cpu 计算资源</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip_disable</span> MSIE [<span class="number">4</span>-<span class="number">6</span>]\.; <span class="comment"># 响应 IE4~IE6 浏览器的请求时，不使用 gzip。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip_min_length</span> <span class="number">200</span>;       <span class="comment"># 大于 200 字节就进行文件压缩</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip_http_version</span> <span class="number">1</span>.<span class="number">0</span>|<span class="number">1</span>.<span class="number">1</span>; <span class="comment"># 使用 http/1.1 协议才进行文件压缩，默认值为 1.1。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip_types</span> mime-type ...;  <span class="comment"># 设置需要压缩文件的类型，如：text/plain text/css</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip_vary</span> <span class="literal">on</span>|<span class="literal">off</span>;          <span class="comment"># 是否传输 gzip 压缩标识，默认值为 off。</span></span></pre></td></tr></table></figure>

<h2 id="八、静态资源缓存"><a href="#八、静态资源缓存" class="headerlink" title="八、静态资源缓存"></a>八、静态资源缓存</h2><p>依赖 <a href="http://nginx.org/en/docs/http/ngx_http_headers_module.html" target="_blank" rel="noopener">ngx_http_headers_module</a> 模块。</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">location ~* \.(jpg|<span class="type">gif</span>|<span class="type">png</span>|<span class="type">txt</span>|<span class="type">xml</span>)$ &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    expires <span class="number">24</span>h;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    root /opt/test;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>向响应头中添加 Cache-Control，设置缓存时间为 24 小时。<br>语法：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">expires <span class="number">60</span>s; # <span class="number">60</span> 秒</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">expires <span class="number">10</span>m; # <span class="number">10</span> 分钟</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">expires <span class="number">2</span>h;  # <span class="number">2</span> 小时</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">expires <span class="number">30</span>d; # <span class="number">30</span> 天</span></pre></td></tr></table></figure>

<h2 id="九、跨域"><a href="#九、跨域" class="headerlink" title="九、跨域"></a>九、跨域</h2><p>依赖 <strong><a href="http://nginx.org/en/docs/http/ngx_http_headers_module.html" target="_blank" rel="noopener">ngx_http_headers_module</a></strong> 模块。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~* \.(jpg|gif|png|txt|xml)$</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">gzip</span> <span class="literal">on</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">gzip_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">gzip_comp_level</span> <span class="number">2</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">gzip_types</span> text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript image/jpeg image/gif image/png</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    ;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="comment"># 设置允许跨域请求</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">add_header</span> <span class="string">'Access-Control-Allow-Origin'</span> <span class="string">'*'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">add_header</span> <span class="string">'Access-Control-Allow-Credentials'</span> <span class="string">'true'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">add_header</span> <span class="string">'Access-Control-Allow-Methods'</span> <span class="string">'GET, POST,PUT,DELETE, OPTIONS'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">root</span> /opt/test;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h2 id="十、防盗链"><a href="#十、防盗链" class="headerlink" title="十、防盗链"></a>十、防盗链</h2><p>依赖 <strong><a href="http://nginx.org/en/docs/http/ngx_http_referer_module.html" target="_blank" rel="noopener">ngx_http_referer_module</a></strong> 模块。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~* \.(jpg|gif|png|txt|xml)$</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">valid_referers</span> <span class="literal">none</span> <span class="literal">blocked</span> <span class="number">192.168.2.25</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">            <span class="attribute">return</span> <span class="number">403</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>只允许 192.168.2.25 的服务器请求资源。</p>
<h2 id="十一、反向代理"><a href="#十一、反向代理" class="headerlink" title="十一、反向代理"></a>十一、反向代理</h2><p>依赖 <strong><a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html" target="_blank" rel="noopener">ngx_http_proxy_module</a></strong> 模块。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">listen</span>       <span class="number">80</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">proxy_pass</span> http://192.168.2.25:8080;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">proxy_connect_timeout</span> <span class="number">30</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">proxy_send_timeout</span> <span class="number">30</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">proxy_read_timeout</span> <span class="number">30</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">proxy_buffering</span> <span class="literal">on</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">proxy_buffer_size</span> <span class="number">32k</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">proxy_buffers</span> <span class="number">4</span> <span class="number">128k</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">proxy_busy_buffers_size</span> <span class="number">256k</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">proxy_temp_file_write_size</span> <span class="number">128k</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">proxy_max_temp_file_size</span> <span class="number">256k</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>8080 端口为 tomcat 启动端口。浏览器访问 <a href="http://192.168.2.25" target="_blank" rel="noopener">http://192.168.2.25</a> 后会看到 tomcat 首页。<br>常用配置说明：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_pass</span> url;                  <span class="comment"># 被代理服务器地址。如：http://127.0.0.1:8080。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_set_header</span> xx xx;          <span class="comment"># 更改 Nginx 服务器接收的客户端请求的头信息，然后将新请求头发给后端服务器。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_connect_timeout</span> <span class="number">30</span>;        <span class="comment"># Nginx 与后端服务器建立连接超时时间</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_send_timeout</span> <span class="number">30</span>;           <span class="comment"># Nginx 向后端服务器发送 write 请求后，等待响应的超时时间。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_read_timeout</span> <span class="number">30</span>;           <span class="comment"># Nginx 向后端服务器发送 read 请求后，等待响应的超时时间。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_buffering</span> <span class="literal">on</span>|<span class="literal">off</span>;          <span class="comment"># 是否开启 Proxy Buffer</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_buffer_size</span> <span class="number">32k</span>;           <span class="comment"># 缓冲区大小</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_buffers</span> <span class="number">4</span> <span class="number">128k</span>;            <span class="comment"># 缓冲区数量和大小</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_busy_buffers_size</span> <span class="number">256k</span>;    <span class="comment"># 设置系统很忙时可以使用的 proxy_buffers的大小，官方推荐位 proxy_buffers * 2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_temp_file_write_size</span> <span class="number">128k</span>; <span class="comment"># 当后端服务器的响应过大时 Nginx 一次性写入临时文件的数据大小</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_max_temp_file_size</span> <span class="number">256k</span>;   <span class="comment"># 每个请求能用磁盘上临时文件最大大小</span></span></pre></td></tr></table></figure>

<h2 id="十二、负载均衡"><a href="#十二、负载均衡" class="headerlink" title="十二、负载均衡"></a>十二、负载均衡</h2><p>依赖 <strong><a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html" target="_blank" rel="noopener">ngx_http_upstream_module</a></strong> 模块。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">upstream mytomcat &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    server <span class="number">192.168</span><span class="number">.2</span><span class="number">.25</span>:<span class="number">8081</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    server <span class="number">192.168</span><span class="number">.2</span><span class="number">.25</span>:<span class="number">8082</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    server <span class="number">192.168</span><span class="number">.2</span><span class="number">.25</span>:<span class="number">8083</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">server &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    location / &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        proxy_pass http:<span class="comment">//mytomcat;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>启动 3 个 tomcat 服务。浏览器访问 <a href="http://192.168.2.25，nginx" target="_blank" rel="noopener">http://192.168.2.25，nginx</a> 默认通过轮询方式将请求转发给 3 个 tomcat 服务。<br><strong>均衡策略补充：</strong><br>策略一：轮询（默认），即上述配置。<br>策略二：最少链接，客户端请求会被转发到连接数最少的服务器上。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">upstream mytomcat &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    least_conn;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8081;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8082;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8083;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>策略三：weight 权重，指定轮询几率，权重越大，请求转发到的几率越大。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">upstream mytomcat &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8081 <span class="attribute">weight</span>=3;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8082 <span class="attribute">weight</span>=2;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8083;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>策略四：ip_hash，每个请求按访问 ip 的 hash 值分配。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">upstream mytomcat &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    ip_hash;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8081;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8082;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8083;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>策略五：url_hash（第三方），需要安装 <a href="https://github.com/evanmiller/nginx_upstream_hash" target="_blank" rel="noopener">url_hash</a> 模块，按访问 url 的 hash 结果来分配请求。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">upstream mytomcat &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    hash  <span class="variable">$request_uri</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8081;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8082;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8083;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>策略六：fair（第三方），需要安装 <a href="https://github.com/gnosek/nginx-upstream-fair" target="_blank" rel="noopener">nginx-upstream-fair</a> 模块，按后端服务器的响应时间来分配请求，响应时间短的优先分配。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">upstream mytomcat &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    fair;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8081;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8082;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">   <span class="built_in"> server </span>192.168.2.25:8083;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h2 id="十三、代理缓存"><a href="#十三、代理缓存" class="headerlink" title="十三、代理缓存"></a>十三、代理缓存</h2><p>依赖 <strong><a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html" target="_blank" rel="noopener">ngx_http_proxy_module</a></strong> 模块。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> mytomcat &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">server</span> <span class="number">192.168.2.25:8081</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">server</span> <span class="number">192.168.2.25:8082</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">server</span> <span class="number">192.168.2.25:8083</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_cache_path</span> /usr/proxy/cache level=<span class="number">1</span>:<span class="number">2</span> keys_zone=light_cache:<span class="number">10m</span> max_size=<span class="number">10g</span> inactive=<span class="number">60m</span> use_temp_path=<span class="literal">off</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">location</span> / &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">proxy_pass</span> http://mytomcat;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">proxy_buffering</span> <span class="literal">on</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">proxy_cache</span> light_cache;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">proxy_cache_valid</span> <span class="number">200</span> <span class="number">304</span> <span class="number">12h</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">proxy_cache_valid</span> any <span class="number">10m</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">proxy_cache_key</span> <span class="variable">$host</span><span class="variable">$uri</span><span class="variable">$is_args</span><span class="variable">$args</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">add_header</span> Nginx-Cache <span class="string">"<span class="variable">$upstream_cache_status</span>"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>Proxy Cache 机制依赖于 Proxy Buffer 机制，因此，只有当 Proxy Buffer 开启时，Proxy Cache 的配置才发挥作用。<br>常用配置说明：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">proxy_cache_path xx xx <span class="built_in">..</span>      # 设置 Nginx 服务器存储缓存数据路径以及缓存索引相关内容</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">proxy_cache name|off;          # name 表示存放缓存索引的内存区域名称，off 表示关闭<span class="built_in"> Proxy </span>Cache</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">proxy_cache_valid 200 304 12h; # 针对不同的 HTTP 响应状态设置不同的缓存时间</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">proxy_cache_key xxx;           # 设置 Nginx 服务器在内存中为缓存数据建立索引时使用的关键字</span></pre></td></tr></table></figure>

<h2 id="十四、配置-HTTPS"><a href="#十四、配置-HTTPS" class="headerlink" title="十四、配置 HTTPS"></a>十四、配置 HTTPS</h2><p>依赖 <strong><a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html" target="_blank" rel="noopener">ngx_http_ssl_module</a></strong> 模块。<br>需要开发者购买 CA 证书。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">listen</span>  <span class="number">443</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">ssl</span> <span class="literal">on</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">ssl_certificate</span>  /etc/nginx/cert/xxx.pem;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">ssl_certificate_key</span>  /etc/nginx/cert/xxx.key;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">ssl_session_cache</span> shared:SSL:<span class="number">10m</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">10m</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h2 id="十五、参考资料"><a href="#十五、参考资料" class="headerlink" title="十五、参考资料"></a>十五、参考资料</h2><ul>
<li><a href="http://nginx.org/en/linux_packages.html" target="_blank" rel="noopener">http://nginx.org/en/linux_packages.html</a></li>
<li><a href="http://nginx.org/en/docs/" target="_blank" rel="noopener">http://nginx.org/en/docs/</a></li>
<li><a href="http://www.nginx.cn/doc/index.html" target="_blank" rel="noopener">http://www.nginx.cn/doc/index.html</a></li>
</ul>
<blockquote>
<p>作者：月光中的污点</p>
<p>来源：<a href="https://www.extlight.com/2017/10/18/Nginx-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" target="_blank" rel="noopener">https://www.extlight.com/2017/10/18/Nginx-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</a></p>
</blockquote>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/12/27/MySQL-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7/" rel="prev" title="MySQL 性能优化技巧">
      <i class="fa fa-chevron-left"></i> MySQL 性能优化技巧
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/12/27/Web-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B8%8E%E9%98%B2%E5%BE%A1%EF%BC%881%EF%BC%89%EF%BC%9A-XSS%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB/" rel="next" title="Web 漏洞分析与防御（1）： XSS跨站脚本攻击">
      Web 漏洞分析与防御（1）： XSS跨站脚本攻击 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、前言"><span class="nav-number">1.</span> <span class="nav-text">一、前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-作为-Web-服务器"><span class="nav-number">1.1.</span> <span class="nav-text"># 1.1 作为 Web 服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-作为负载均衡服务器"><span class="nav-number">1.2.</span> <span class="nav-text"># 1.2 作为负载均衡服务器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、安装"><span class="nav-number">2.</span> <span class="nav-text">二、安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-添加仓库资源"><span class="nav-number">2.1.</span> <span class="nav-text"># 2.1 添加仓库资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-查看-yum-资源列表"><span class="nav-number">2.2.</span> <span class="nav-text"># 2.2 查看 yum 资源列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-安装"><span class="nav-number">2.3.</span> <span class="nav-text"># 2.3 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-查看版本"><span class="nav-number">2.4.</span> <span class="nav-text"># 2.4 查看版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-常用命令"><span class="nav-number">2.5.</span> <span class="nav-text"># 2.5 常用命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-信号量"><span class="nav-number">2.6.</span> <span class="nav-text"># 2.6 信号量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、目录-文件介绍"><span class="nav-number">3.</span> <span class="nav-text">三、目录/文件介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-目录介绍"><span class="nav-number">3.1.</span> <span class="nav-text"># 3.1 目录介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-配置文件介绍"><span class="nav-number">3.2.</span> <span class="nav-text"># 3.2 配置文件介绍</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、location-讲解"><span class="nav-number">4.</span> <span class="nav-text">四、location 讲解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-案例分析"><span class="nav-number">4.1.</span> <span class="nav-text"># 4.1 案例分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五、rewrite-重写"><span class="nav-number">5.</span> <span class="nav-text">五、rewrite 重写</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-rewrite-语法"><span class="nav-number">5.1.</span> <span class="nav-text"># 5.1 rewrite 语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-if-语法"><span class="nav-number">5.2.</span> <span class="nav-text"># 5.2 if 语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-案例介绍"><span class="nav-number">5.3.</span> <span class="nav-text"># 5.3 案例介绍</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#六、访问控制"><span class="nav-number">6.</span> <span class="nav-text">六、访问控制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#七、文件压缩"><span class="nav-number">7.</span> <span class="nav-text">七、文件压缩</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#八、静态资源缓存"><span class="nav-number">8.</span> <span class="nav-text">八、静态资源缓存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#九、跨域"><span class="nav-number">9.</span> <span class="nav-text">九、跨域</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十、防盗链"><span class="nav-number">10.</span> <span class="nav-text">十、防盗链</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十一、反向代理"><span class="nav-number">11.</span> <span class="nav-text">十一、反向代理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十二、负载均衡"><span class="nav-number">12.</span> <span class="nav-text">十二、负载均衡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十三、代理缓存"><span class="nav-number">13.</span> <span class="nav-text">十三、代理缓存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十四、配置-HTTPS"><span class="nav-number">14.</span> <span class="nav-text">十四、配置 HTTPS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十五、参考资料"><span class="nav-number">15.</span> <span class="nav-text">十五、参考资料</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">winrains</p>
  <div class="site-description" itemprop="description">淡泊明志</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">289</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">85</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">winrains</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.6.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
