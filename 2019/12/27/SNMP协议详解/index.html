<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://congsheng.wang').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="简单网络管理协议（SNMP）是TCP&#x2F;IP协议簇的一个应用层协议。在1988年被制定，并被Internet体系结构委员会（IAB）采纳作为一个短期的网络管理解决方案；由于SNMP的简单性，在Internet时代得到了蓬勃的发展，1992年发布了SNMPv2版本，以增强SNMPv1的安全性和功能。现在，已经有了SNMPv3版本。一套完整的SNMP系统主要包括管理信息库（MIB）、管理信息结构（SMI">
<meta name="keywords" content="SNMP">
<meta property="og:type" content="article">
<meta property="og:title" content="SNMP协议详解">
<meta property="og:url" content="http:&#x2F;&#x2F;congsheng.wang&#x2F;2019&#x2F;12&#x2F;27&#x2F;SNMP%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3&#x2F;index.html">
<meta property="og:site_name" content="个人博客">
<meta property="og:description" content="简单网络管理协议（SNMP）是TCP&#x2F;IP协议簇的一个应用层协议。在1988年被制定，并被Internet体系结构委员会（IAB）采纳作为一个短期的网络管理解决方案；由于SNMP的简单性，在Internet时代得到了蓬勃的发展，1992年发布了SNMPv2版本，以增强SNMPv1的安全性和功能。现在，已经有了SNMPv3版本。一套完整的SNMP系统主要包括管理信息库（MIB）、管理信息结构（SMI">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;08&#x2F;20190823160451-33a25.png">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;08&#x2F;20190823160451-81351.png">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;08&#x2F;20190823160451-32836.png">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;08&#x2F;20190823160451-590cc.png">
<meta property="og:updated_time" content="2019-12-27T01:19:13.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;08&#x2F;20190823160451-33a25.png">

<link rel="canonical" href="http://congsheng.wang/2019/12/27/SNMP%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>SNMP协议详解 | 个人博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">congsheng的博客</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">156</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">94</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">984</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2019/12/27/SNMP%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="congsheng.wang">
      <meta itemprop="description" content="trouble is a friend">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SNMP协议详解
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-27 09:19:13" itemprop="dateCreated datePublished" datetime="2019-12-27T09:19:13+08:00">2019-12-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">网络技术</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" itemprop="url" rel="index">
                    <span itemprop="name">网络协议</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>简单网络管理协议（SNMP）是TCP/IP协议簇的一个应用层协议。在1988年被制定，并被Internet体系结构委员会（IAB）采纳作为一个短期的网络管理解决方案；由于SNMP的简单性，在Internet时代得到了蓬勃的发展，1992年发布了SNMPv2版本，以增强SNMPv1的安全性和功能。现在，已经有了SNMPv3版本。<br>一套完整的SNMP系统主要包括管理信息库（MIB）、管理信息结构（SMI）及SNMP报文协议。</p>
<a id="more"></a>

<p>（1）管理信息库MIB：任何一个被管理的资源都表示成一个对象，称为被管理的对象。MIB是被管理对象的集合。它定义了被管理对象的一系列属性：对象的名称、对象的访问权限和对象的数据类型等。每个SNMP设备（Agent）都有自己的MIB。MIB也可以看作是NMS（网管系统）和Agent之间的沟通桥梁。它们之间的关系如图1所示。</p>
<p><img src="http://image.winrains.cn/2019/08/20190823160451-33a25.png" alt="img"><br>图1 NMS Agent和MIB的关系</p>
<p>MIB文件中的变量使用的名字取自ISO和ITU管理的对象标识符（object identifier）名字空间。它是一种分级树的结构。如图2所示，第一级有三个节点：ccitt、iso、iso-ccitt。低级的对象ID分别由相关组织分配。一个特定对象的标识符可通过由根到该对象的路径获得。一般网络设备取iso节点下的对象内容。如名字空间ip结点下一个名字为ipInReceives的MIB变量被指派数字值3，因而该变量的名字为：<br>iso.org.dod.internet.mgmt.mib.ip.ipInReceives<br>相应的数字表示（对象标识符OID，唯一标识一个MIB对象）为：<br>1.3.6.1.2.1.4.3<br><img src="http://image.winrains.cn/2019/08/20190823160451-81351.png" alt="snmps树"></p>
<p>图2 MIB树结构</p>
<p>当网络管理协议在报文中使用MIB变量时，每个变量名后还要加一个后缀，以作为该变量的一个实例。如ipInReceives的实例数字表示为：1.3.6.1.2.1.4.3.0.<br>需要注意的是，MIB中的管理对象的OID有些需要动态确定，如IP路由表，为了指明地址202.120.86.71的下一站路由(next hop)，我们可以引用这样的实例：<br>iso.org.dod.internet.mgmt.mib.ip. ipRouteTable.ipRouteEntry.ipRouteNextHop.202.120.86.71, 相应的数字表示为：1.3.6.1.2.1.4.21.1.7.202.120.86.71<br>对于这种动态对象标识的实例，由于无法转换为预先指定的Readkey名称，与飞邻的产品架构冲突（需要动态生成可变Readkey），暂不考虑支持。<br>（2）管理信息结构（SMI）<br>SMI定义了SNMP框架所用信息的组织、组成和标识，它还为描述MIB对象和描述协议怎样交换信息奠定了基础。<br>SMI定义的数据类型：<br>◆ 简单类型（simple）<br>Integer：整型是-2,147,483,648<del>2,147,483,647的有符号整数<br>octet string: 字符串是0</del>65535个字节的有序序列<br>OBJECT IDENTIFIER: 来自按照ASN.1规则分配的对象标识符集<br>◆ 简单结构类型（simple-constructed）<br>SEQUENCE 用于列表。这一数据类型与大多数程序设计语言中的“structure”类似。一个SEQUENCE包括0个或更多元素，每一个元素又是另一个ASN.1数据类型<br>SEQUENCE OF type 用于表格。这一数据类型与大多数程序设计语言中的“array”类似。一个表格包括0个或更多元素，每一个元素又是另一个ASN.1数据类型。<br>◆ 应用类型（application-wide）<br>IpAddress: 以网络序表示的IP地址。因为它是一个32位的值，所以定义为4个字节；<br>counter：计数器是一个非负的整数，它递增至最大值，而后回零。在SNMPv1中定义的计数器是32位的，即最大值为4，294，967，295；<br>Gauge ：也是一个非负整数，它可以递增或递减，但达到最大值时保持在最大值，最大值为232-1；<br>time ticks：是一个时间单位，表示以0.01秒为单位计算的时间；<br>SNMP报文<br>SNMP报文结构如下：（编码之前）</p>
<table>
<thead>
<tr>
<th>版本号</th>
</tr>
</thead>
<tbody><tr>
<td>团体名</td>
</tr>
<tr>
<td>协议数据单元PDU</td>
</tr>
</tbody></table>
<p>SNMP共有5种报文，所以其PDU也有5中，第七点会详细介绍SNMP的5种协议数据单元。</p>
<h1 id="1-SNMP的5种协议数据单元"><a href="#1-SNMP的5种协议数据单元" class="headerlink" title="1 SNMP的5种协议数据单元"></a><strong>1 SNMP的5种协议数据单元</strong></h1><p>SNMP规定了5种协议数据单元PDU（也就是SNMP报文），用来在管理进程和代理之间的交换。<br>get-request操作：从代理进程处提取一个或多个参数值。<br>get-next-request操作：从代理进程处提取紧跟当前参数值的下一个参数值。<br>set-request操作：设置代理进程的一个或多个参数值。<br>get-response操作：返回的一个或多个参数值。这个操作是由代理进程发出的，它是前面三种操作的响应操作。trap操作：代理进程主动发出的报文，通知管理进程有某些事情发生。<br>前面的3种操作是由管理进程向代理进程发出的，后面的2个操作是代理进程发给管理进程的，为了简化起见，前面3个操作今后叫做get、get-next和set操作。图1描述了SNMP的这5种报文操作。请注意，在代理进程端是用熟知端口161俩接收get或set报文，而在管理进程端是用熟知端口162来接收trap报文。<br><img src="http://image.winrains.cn/2019/08/20190823160451-32836.png" alt="snmp报文转发流程"></p>
<p>图1 SNMP的5种报文操作</p>
<p>图2是封装成UDP数据报的5种操作的SNMP报文格式。可见一个SNMP报文共有三个部分组成，即公共SNMP首部、get/set首部、trap首部、变量绑定。<br><img src="http://image.winrains.cn/2019/08/20190823160451-590cc.png" alt="snmp报文格式PDU"><br>（1）公共SNMP首部<br>共三个字段：<br> 版本<br>写入版本字段的是版本号减1，对于SNMP（即SNMPV1）则应写入0。<br> 共同体（community）<br>共同体就是一个字符串，作为管理进程和代理进程之间的明文口令，常用的是6个字符“public”。<br> PDU类型<br>根据PDU的类型，填入0～4中的一个数字，其对应关系如表2所示意图。<br>表2 PDU类型</p>
<table>
<thead>
<tr>
<th>PDU类型</th>
<th>名称</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>get-request</td>
</tr>
<tr>
<td>1</td>
<td>get-next-request</td>
</tr>
<tr>
<td>2</td>
<td>get-response</td>
</tr>
<tr>
<td>3</td>
<td>set-request</td>
</tr>
<tr>
<td>4</td>
<td>trap</td>
</tr>
</tbody></table>
<p>（2）get/set首部<br> 请求标识符(request ID)<br>这是由管理进程设置的一个整数值。代理进程在发送get-response报文时也要返回此请求标识符。管理进程可同时向许多代理发出get报文，这些报文都使用UDP传送，先发送的有可能后到达。设置了请求标识符可使管理进程能够识别返回的响应报文对于哪一个请求报文<br> 差错状态（error status）<br>由代理进程回答时填入0～5中的一个数字，见表3的描述<br>表3 差错状态描述</p>
<table>
<thead>
<tr>
<th>差错状态</th>
<th>名字</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>noError</td>
<td>一切正常</td>
</tr>
<tr>
<td>1</td>
<td>tooBig</td>
<td>代理无法将回答装入到一个SNMP报文之中</td>
</tr>
<tr>
<td>2</td>
<td>noSuchName</td>
<td>操作指明了一个不存在的变量</td>
</tr>
<tr>
<td>3</td>
<td>badValue</td>
<td>一个set操作指明了一个无效值或无效语法</td>
</tr>
<tr>
<td>4</td>
<td>readOnly</td>
<td>管理进程试图修改一个只读变量</td>
</tr>
<tr>
<td>5</td>
<td>genErr</td>
<td>某些其他的差错</td>
</tr>
</tbody></table>
<p> 差错索引(error index)<br>当出现noSuchName、badValue或readOnly的差错时，由代理进程在回答时设置的一个整数，它指明有差错的变量在变量列表中的偏移。<br>（3）trap首部<br> 企业（enterprise）<br>填入trap报文的网络设备的对象标识符。此对象标识符肯定是在图3的对象命名树上的enterprise结点{1.3.6.1.4.1}下面的一棵子树上。<br> trap类型<br>此字段正式的名称是generic-trap，共分为表4中的7种。</p>
<table>
<thead>
<tr>
<th>trap类型</th>
<th>名字</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>coldStart</td>
<td>代理进行了初始化</td>
</tr>
<tr>
<td>1</td>
<td>warmStart</td>
<td>代理进行了重新初始化</td>
</tr>
<tr>
<td>2</td>
<td>linkDown</td>
<td>一个接口从工作状态变为故障状态</td>
</tr>
<tr>
<td>3</td>
<td>linkUp</td>
<td>一个接口从故障状态变为工作状态</td>
</tr>
<tr>
<td>4</td>
<td>authenticationFailure</td>
<td>从SNMP管理进程接收到具有一个无效共同体的报文</td>
</tr>
<tr>
<td>5</td>
<td>egpNeighborLoss</td>
<td>一个EGP相邻路由器变为故障状态</td>
</tr>
<tr>
<td>6</td>
<td>enterpriseSpecific</td>
<td>代理自定义的事件，需要用后面的“特定代码”来指明</td>
</tr>
</tbody></table>
<p>当使用上述类型2、3、5时，在报文后面变量部分的第一个变量应标识响应的接口。<br> 特定代码(specific-code)<br>指明代理自定义的时间（若trap类型为6），否则为0。<br> 时间戳(timestamp)<br>指明自代理进程初始化到trap报告的事件发生所经历的时间，单位为10ms。例如时间戳为1908表明在代理初始化后1908ms发生了该时间。<br>（4）变量绑定(variable-bindings)<br>指明一个或多个变量的名和对应的值。在get或get-next报文中，变量的值应忽略。<br>管理变量的表示<br>管理变量表示管理对象类型在某一时刻的值（或称该类型的实例），SNMP以管理变量作为操作对象。<br>管理变量的表示方法是这样规定的：形如x.y，其中x是管理对象的object identifer。y是能唯一确定对象类型值的一组数字，在非表型变量中为0，在表型变量中是这个表的索引，比如接口表中的接口号，或路由表中的目的网络地址等等 。如：在MIB文件里定义了ipAdEntNetMask这一管理对象，其object identifier为1.3.6.1.1.5.6.1.3它是个路由表中的一项，它的一个实例就是路由表中某一行的子网掩码，如果这行的索引、目的网络地址为129.102.1.0。则这个变量名是：1.3.6.1.1.5.6.1.3.129.102.1.0。在以后的说明中，为了方便，把唯一确定管理变量的一组数字，也就是x.y中的y称作实例。<br>SNMP的运行过程<br>驻留在被管设备上的AGENT从UDP端口161接受来自网管站的串行化报文，经解码、团体名验证、分析得到管理变量在MIB树中对应的节点，从相应的模块中得到管理变量的值，再形成响应报文，编码发送回网管站。网管站得到响应报文后，再经同样的处理，最终显示结果。<br>下面根据RFC1157详细介绍Agent接受到报文后采取的动作：<br>首先解码生成用内部数据结构表示的报文，解码依据ASN.1的基本编码规则，如果在此过程中出现错误导致解码失败则丢弃该报文，不做进一步处理。<br>第二步：将报文中的版本号取出，如果与本Agent支持的SNMP版本不一致，则丢弃该报文，不做进一步处理。当前北研的数据通信产品只支持SNMP版本1。<br>第三步：将报文中的团体名取出，此团体名由发出请求的网管站填写。如与本设备认可的团体名不符，则丢弃该报文，不做进一步处理，同时产生一个陷阱报文。SNMPv1只提供了较弱的安全措施，在版本3中这一功能将大大加强。<br>第四步：从通过验证的ASN.1对象中提出协议数据单元PDU，如果失败，丢弃报文，不做进一不处理。否则处理PDU，结果将产生一个报文，该报文的发送目的地址应同收到报文的源地址一致。<br>根据不同的PDU，SNMP协议实体将做不同的处理：</p>
<h2 id="1-1-GetRequest-PDU"><a href="#1-1-GetRequest-PDU" class="headerlink" title="1.1 GetRequest PDU"></a><strong>1.1 GetRequest PDU</strong></h2><p>第一种情况：如果PDU中的变量名在本地维护的MIB树中不存在,则接受到这个PDU的协议实体将向发出者发送一个GetResponse报文，其中的PDU与源PDU只有一点不同：将ERROR-STATUS置为noSuchName,并在ERROR-INDEX中指出产生该变量在变量LIST中的位置。<br>第二种情况：如果本地协议实体将产生的响应报文的长度大于本地长度限制，将向该PDU的发出者发送一个GetResponse报文，该PDU除了ERROR-STATUS置为tooBig，ERROR-INDEX置为0以外，与源PDU相同。<br>第三种情况：如果本地协议实体因为其他原因不能产生正确的响应报文，将向该PDU的发出者发送一个GetResponse报文，该PDU除了ERROR-STATUS置为genErr，ERROR-INDEX置为出错变量在变量LIST中的位置，其余与源PDU相同。<br>第四中情况：如果上面的情况都没有发生，则本地协议实体向该PDU的发出者发送一个GetResponse报文，该PDU中将包含变量名和相应值的对偶表，ERROR-STATUS为noError,ERROR-INDEX为0，request-id域的值应与收到PDU的request-id相同。</p>
<h2 id="1-2-GetNextRequest-PDU"><a href="#1-2-GetNextRequest-PDU" class="headerlink" title="1.2 GetNextRequest PDU"></a><strong>1.2 GetNextRequest PDU</strong></h2><p>GetNextRequest PDU的最重要的功能是表的遍历，这种操作受到了前面所说的管理变量的表示方法的支持，从而可以访问一组相关的变量，就好象他们在一个表内。<br>下面通过一个例子解释表遍历的过程：<br>被管设备维护如下路由表：<br>Destination NextHop Metric<br>10.0.0.99 89.1.1.42 5<br>9.1.2.3 99.0.0.3 3<br>10.0.0.51 89.1.1.42 5<br>假设网管站欲取得这张路由表的信息，该表的索引是目的网络地址。<br>网管站向被管设备发送一个GetNextRequest PDU,其中的受管对象的标识如下<br>GetNextRequest ( ipRouteDest, ipRouteNextHop, ipRouteMetric1 )<br>SNMP agent响应如下GetResponse PDU:<br>GetResponse (( ipRouteDest.9.1.2.3 = “9.1.2.3” ),<br>( ipRouteNextHop.9.1.2.3 = “99.0.0.3” ),<br>( ipRouteMetric1.9.1.2.3 = 3 ))<br>网管站继续：<br>GetNextRequest ( ipRouteDest.9.1.2.3,<br>ipRouteNextHop.9.1.2.3,<br>ipRouteMetric1.9.1.2.3 )<br>agent响应：<br>GetResponse (( ipRouteDest.10.0.0.51 = “10.0.0.51” ),<br>( ipRouteNextHop.10.0.0.51 = “89.1.1.42” ),<br>( ipRouteMetric1.10.0.0.51 = 5 ))<br>值得注意的是agent必须能够确定下一个管理变量名，以保证所有变量能被取到且只被取到一次。<br>网管站继续：<br>GetNextRequest ( ipRouteDest.10.0.0.51,<br>ipRouteNextHop.10.0.0.51,<br>ipRouteMetric1.10.0.0.51 )<br>agent 响应：<br>GetResponse (( ipRouteDest.10.0.0.99 = “10.0.0.99” ),<br>( ipRouteNextHop.10.0.0.99 = “89.1.1.42” ),<br>( ipRouteMetric1.10.0.0.99 = 5 ))<br>网管站继续<br>GetNextRequest ( ipRouteDest.10.0.0.99,<br>ipRouteNextHop.10.0.0.99,<br>ipRouteMetric1.10.0.0.99 )<br>这时因为路由表中所有的行都被取遍，agent因返回路由表对象的下一字典后继即该管理对象在MIB树中的后序遍历的直接后继。这里应是nettoMediaIndex，管理对象的OBJECT IDENTIFIER。这个响应通知网管站对表的遍历已经完成。</p>
<h2 id="1-3-GetResponse-PDU"><a href="#1-3-GetResponse-PDU" class="headerlink" title="1.3 GetResponse PDU"></a><strong>1.3 GetResponse PDU</strong></h2><p>GetResponse PDU只有当受到getRequest GetNextRequest SetRequest才由协议实体产生，网管站收到这个PDU后，应显示其结果。</p>
<h2 id="1-4-SetRequest-PDU"><a href="#1-4-SetRequest-PDU" class="headerlink" title="1.4 SetRequest PDU"></a><strong>1.4 SetRequest PDU</strong></h2><p>SetRequest PDU除了PDU类型标识以外，和GetRequest相同，当需要对被管变量进行写操作时，网管站侧的协议实体将生成该PDU。<br>对SetRequest的响应将根据下面情况分别处理：<br>如果是关于一个只读变量的设置请求，则收到该PDU的协议实体产生一个GetReponse报文，并置error status为noSuchName, error index的值是错误变量在变量list中的位置。<br>如果被管设备上的协议实体收到的PDU中的变量对偶中的值，类型、长度不符和要求，则收到该PDU的协议实体产生一个GetReponse报文，并置error status为badValue, error index的值是错误变量在变量list中的位置。<br>如果需要产生的GetReponse报文长度超过了本地限制，则收到该PDU的协议实体产生一个GetReponse报文，并置error status为tooBig, error index的值是0。<br>如果是其他原因导致SET失败，则收到该PDU的协议实体产生一个GetReponse报文，并置error status为genErr, error index的值是错误变量在变量list中的位置。<br>如果不符合上面任何情况，则agent将把管理变量设置收到的PDU中的相应值，这往往可以改变被管设备的运行状态。同时产生一个GetResponse PDU，其中error status置为noError,error index的值为0。</p>
<h2 id="1-5-Trap-PDU"><a href="#1-5-Trap-PDU" class="headerlink" title="1.5 Trap PDU"></a><strong>1.5 Trap PDU</strong></h2><p>Trap PDU的有如下的形式</p>
<table>
<thead>
<tr>
<th>产生trap的系统的OBJECT IDENTIFIER</th>
</tr>
</thead>
<tbody><tr>
<td>系统的IP地址</td>
</tr>
<tr>
<td>普通类型</td>
</tr>
<tr>
<td>特定类型</td>
</tr>
<tr>
<td>时戳</td>
</tr>
<tr>
<td>变量对偶表</td>
</tr>
</tbody></table>
<blockquote>
<p>作者：shanzhizi</p>
<p>来源：<a href="https://blog.csdn.net/shanzhizi/article/details/11606767" target="_blank" rel="noopener">https://blog.csdn.net/shanzhizi/article/details/11606767</a></p>
</blockquote>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/SNMP/" rel="tag"># SNMP</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/12/27/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%8E%9F%E7%90%86/" rel="prev" title="TCP三次握手原理">
      <i class="fa fa-chevron-left"></i> TCP三次握手原理
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/12/27/%E7%90%86%E8%A7%A3%E6%9C%AC%E7%9C%9F%E7%9A%84REST%E6%9E%B6%E6%9E%84%E9%A3%8E%E6%A0%BC/" rel="next" title="理解本真的REST架构风格">
      理解本真的REST架构风格 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-SNMP的5种协议数据单元"><span class="nav-number">1.</span> <span class="nav-text">1 SNMP的5种协议数据单元</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-GetRequest-PDU"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 GetRequest PDU</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-GetNextRequest-PDU"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 GetNextRequest PDU</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-GetResponse-PDU"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 GetResponse PDU</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-SetRequest-PDU"><span class="nav-number">1.4.</span> <span class="nav-text">1.4 SetRequest PDU</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-Trap-PDU"><span class="nav-number">1.5.</span> <span class="nav-text">1.5 Trap PDU</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">congsheng.wang</p>
  <div class="site-description" itemprop="description">trouble is a friend</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">984</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">94</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">156</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">congsheng.wang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.6.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
