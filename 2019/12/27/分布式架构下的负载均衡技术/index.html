<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://congsheng.wang').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="1、引言关于“负载均衡”的解释，百度词条里：负载均衡，英文叫Load Balance，意思就是将请求或者数据分摊到多个操作单元上进行执行，共同完成工作任务。负载均衡（Load Balance）建立在现有网络结构之上，它提供了一种廉价有效透明的方法扩展网络设备和服务器的带宽、增加吞吐量、加强网络数据处理能力、提高网络的灵活性和可用性。">
<meta name="keywords" content="负载均衡">
<meta property="og:type" content="article">
<meta property="og:title" content="分布式架构下的负载均衡技术">
<meta property="og:url" content="http:&#x2F;&#x2F;congsheng.wang&#x2F;2019&#x2F;12&#x2F;27&#x2F;%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E4%B8%8B%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%8A%80%E6%9C%AF&#x2F;index.html">
<meta property="og:site_name" content="个人博客">
<meta property="og:description" content="1、引言关于“负载均衡”的解释，百度词条里：负载均衡，英文叫Load Balance，意思就是将请求或者数据分摊到多个操作单元上进行执行，共同完成工作任务。负载均衡（Load Balance）建立在现有网络结构之上，它提供了一种廉价有效透明的方法扩展网络设备和服务器的带宽、增加吞吐量、加强网络数据处理能力、提高网络的灵活性和可用性。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;09&#x2F;ae56d-133715vjegyexxnofby9bs.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;09&#x2F;a39e4-133858yh8smcmdt4zmvc9w.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;09&#x2F;b24d4-133924vyukdzkksk9lljbz.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;09&#x2F;c874f-135432wqsgspttqsbtbqeq.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;09&#x2F;8034e-141033ti5u5f2ujnnvnpuu.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;09&#x2F;53489-141041g244y2jm0upxhudz.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;09&#x2F;a9a0f-141108rq36o6ymv79oa6d9.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;09&#x2F;68f38-141113uc2jtwlx5nyy1emj.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;09&#x2F;1acfa-141122ikky2ale423yka1y.jpg">
<meta property="og:updated_time" content="2019-12-27T09:29:16.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;09&#x2F;ae56d-133715vjegyexxnofby9bs.jpg">

<link rel="canonical" href="http://congsheng.wang/2019/12/27/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E4%B8%8B%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%8A%80%E6%9C%AF/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>分布式架构下的负载均衡技术 | 个人博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">winrains的个人博客</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">108</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">82</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">469</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2019/12/27/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E4%B8%8B%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%8A%80%E6%9C%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="winrains">
      <meta itemprop="description" content="淡泊明志">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          分布式架构下的负载均衡技术
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-27 17:29:16" itemprop="dateCreated datePublished" datetime="2019-12-27T17:29:16+08:00">2019-12-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">系统架构</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">分布式</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="1、引言"><a href="#1、引言" class="headerlink" title="1、引言"></a>1、引言</h2><p>关于“负载均衡”的解释，百度词条里：负载均衡，英文叫Load Balance，意思就是将请求或者数据分摊到多个操作单元上进行执行，共同完成工作任务。<br>负载均衡（Load Balance）建立在现有网络结构之上，它提供了一种廉价有效透明的方法扩展网络设备和服务器的带宽、增加吞吐量、加强网络数据处理能力、提高网络的灵活性和可用性。</p>
<a id="more"></a>

<p><strong>负载均衡有两方面的含义：</strong></p>
<ul>
<li>1）首先，大量的并发访问或数据流量分担到多台节点设备上分别处理，减少用户等待响应的时间；</li>
<li>2）其次，单个重负载的运算分担到多台节点设备上做并行处理，每个节点设备处理结束后，将结果汇总，返回给用户，系统处理能力得到大幅度提高。</li>
</ul>
<p><strong>简单来说就是：</strong></p>
<ul>
<li>1）其一是将大量的并发处理转发给后端多个节点处理，减少工作响应时间；</li>
<li>2）其二是将单个繁重的工作转发给后端多个节点处理，处理完再返回给负载均衡中心，再返回给用户。</li>
</ul>
<p>目前负载均衡技术大多数是用于提高诸如在Web服务器、FTP服务器和其它关键任务服务器上的Internet服务器程序的可用性和可伸缩性。<br>总之，它的目的就通过调度集群，达到最佳化资源使用，最大化吞吐率，最小化响应时间，避免单点过载的问题。<br><strong>内容概述：</strong>本文将从负载均衡技术的分类、技术原理、常见实现算法、常用方案等入手，为您详细讲解负载均衡技术的方方面面。这其中，四层和七层负载均衡技术最为常用，它们也是本文介绍的重点。<br><strong>站长点评：</strong>对于即时通讯网的IM或消息推送应用的开发者来说，本文所介绍的传统负载均衡技术，可能对于IM等即时通讯分布式场景来说，没有办法直接套用。原因是IM这类socket长连接场景，所处的网络通信层级比较低，而且即时通讯相关的技术实现跟具体的业务逻辑紧密相关，因而无法像HTTP短连接这样基于标准化的负载均衡方法来实现。但本文所介绍的负载均衡原理、算法和一些方案实现，仍然可以为IM或消息推送应用的开发者带来一些借鉴和参考意义，值得深 入一读。<br><strong>补充：</strong>即时通讯网的另一篇《<a href="http://www.52im.net/thread-1950-1-1.html" target="_blank" rel="noopener">快速理解高性能HTTP服务端的负载均衡技术原理</a>》，也讲述了负载均衡方面的知识，有兴趣也可以阅读之。</p>
<h2 id="2、相关文章"><a href="#2、相关文章" class="headerlink" title="2、相关文章"></a>2、相关文章</h2><p><strong>深入阅读以下文章，有助于您更好地理解本篇内容：</strong></p>
<ul>
<li>《<a href="http://www.52im.net/thread-1095-1-1.html" target="_blank" rel="noopener">网络编程懒人入门(一)：快速理解网络通信协议（上篇）</a>》</li>
<li>《<a href="http://www.52im.net/thread-1103-1-1.html" target="_blank" rel="noopener">网络编程懒人入门(二)：快速理解网络通信协议（下篇）</a>》</li>
<li>《<a href="http://www.52im.net/thread-1107-1-1.html" target="_blank" rel="noopener">网络编程懒人入门(三)：快速理解TCP协议一篇就够</a>》</li>
<li>《<a href="http://www.52im.net/thread-1811-1-1.html" target="_blank" rel="noopener">腾讯资深架构师干货总结：一文读懂大型分布式系统设计的方方面面</a>》</li>
<li>《<a href="http://www.52im.net/thread-1950-1-1.html" target="_blank" rel="noopener">快速理解高性能HTTP服务端的负载均衡技术原理</a>》</li>
<li>《<a href="http://www.52im.net/thread-2007-1-1.html" target="_blank" rel="noopener">新手入门：零基础理解大型分布式架构的演进历史、技术原理、最佳实践</a>》</li>
<li>《<a href="http://www.52im.net/thread-802-1-1.html" target="_blank" rel="noopener">通俗易懂：基于集群的移动端IM接入层负载均衡方案分享</a>》</li>
<li>《<a href="http://www.52im.net/thread-1351-1-1.html" target="_blank" rel="noopener">IM开发基础知识补课：正确理解前置HTTP SSO单点登陆接口的原理</a>》</li>
</ul>
<h2 id="3、负载均衡分类"><a href="#3、负载均衡分类" class="headerlink" title="3、负载均衡分类"></a>3、负载均衡分类</h2><p><strong>根据OSI模型可将负载均衡分为：</strong></p>
<ul>
<li>1）二层负载均衡（一般是用虚拟mac地址方式，外部对虚拟MAC地址请求，负载均衡接收后分配后端实际的MAC地址响应）；</li>
<li>2）三层负载均衡（一般采用虚拟IP地址方式，外部对虚拟的ip地址请求，负载均衡接收后分配后端实际的IP地址响应）；</li>
<li>3）四层负载均衡（在三次负载均衡的基础上，用 ip+port 接收请求，再转发到对应的机器）；</li>
<li>4）七层负载均衡（根据虚拟的url或是IP，主机名接收请求，再转向相应的处理服务器）。</li>
</ul>
<p>这其中，最常见的是四层和七层负载均衡，也是本文接下来介绍的重点。<br>当客户端发起请求，会经过层层的封装，发给服务器，服务器收到请求后经过层层的解析，获取到对应的内容。<br><strong>下图是一个典型的HTTP请求分层传递原理：</strong><br><img src="http://image.winrains.cn/2019/09/ae56d-133715vjegyexxnofby9bs.jpg" alt="一篇读懂分布式架构下的负载均衡技术：分类、原理、算法、常见方案等_1.jpg"></p>
<h2 id="4、二层负载均衡"><a href="#4、二层负载均衡" class="headerlink" title="4、二层负载均衡"></a>4、二层负载均衡</h2><p>二层负债均衡是基于数据链路层的负债均衡，即让负债均衡服务器和业务服务器绑定同一个虚拟IP（即VIP），客户端直接通过这个VIP进行请求。<br><strong>那么如何区分相同IP下的不同机器呢？</strong>没错，通过MAC物理地址，每台机器的MAC物理地址都不一样，当负载均衡服务器接收到请求之后，通过改写HTTP报文中以太网首部的MAC地址，按照某种算法将请求转发到目标机器上，实现负载均衡。<br>这种方式负载方式虽然控制粒度比较粗，但是优点是负载均衡服务器的压力会比较小，负载均衡服务器只负责请求的进入，不负责请求的响应（响应是有后端业务服务器直接响应给客户端），吞吐量会比较高。<br><img src="http://image.winrains.cn/2019/09/a39e4-133858yh8smcmdt4zmvc9w.jpg" alt="一篇读懂分布式架构下的负载均衡技术：分类、原理、算法、常见方案等_2.jpg"></p>
<h2 id="5、三层负载均衡"><a href="#5、三层负载均衡" class="headerlink" title="5、三层负载均衡"></a>5、三层负载均衡</h2><p>三层负载均衡是基于网络层的负载均衡，通俗的说就是按照不同机器不同IP地址进行转发请求到不同的机器上。<br>这种方式虽然比二层负载多了一层，但从控制的颗粒度上看，并没有比二层负载均衡更有优势，并且，由于请求的进出都要经过负载均衡服务器，会对其造成比较大的压力，性能也比二层负载均衡要差。<br><img src="http://image.winrains.cn/2019/09/b24d4-133924vyukdzkksk9lljbz.jpg" alt="一篇读懂分布式架构下的负载均衡技术：分类、原理、算法、常见方案等_3.jpg"></p>
<h2 id="6、四层负载均衡"><a href="#6、四层负载均衡" class="headerlink" title="6、四层负载均衡"></a>6、四层负载均衡</h2><p><strong>四层的负载均衡就是基于IP+端口的负载均衡：</strong>在三层负载均衡的基础上，通过发布三层的IP地址（VIP），然后加四层的端口号，来决定哪些流量需要做负载均衡，对需要处理的流量进行NAT处理，转发至后台服务器，并记录下这个TCP或者UDP的流量是由哪台服务器处理的，后续这个连接的所有流量都同样转发到同一台服务器处理。<br>对应的负载均衡器称为四层交换机（L4 switch），主要分析IP层及TCP/UDP层，实现四层负载均衡。<br>此种负载均衡器不理解应用协议（如HTTP/FTP/MySQL等等），常见例子有：LVS，F5。</p>
<h2 id="7、七层负载均衡"><a href="#7、七层负载均衡" class="headerlink" title="7、七层负载均衡"></a>7、七层负载均衡</h2><p><strong>七层的负载均衡就是基于虚拟的URL或主机IP的负载均衡：</strong>在四层负载均衡的基础上（没有四层是绝对不可能有七层的），再考虑应用层的特征，比如同一个Web服务器的负载均衡，除了根据VIP加80端口辨别是否需要处理的流量，还可根据七层的URL、浏览器类别、语言来决定是否要进行负载均衡。<br>举个例子，如果你的Web服务器分成两组，一组是中文语言的，一组是英文语言的，那么七层负载均衡就可以当用户来访问你的域名时，自动辨别用户语言，然后选择对应的语言服务器组进行负载均衡处理。<br>对应的负载均衡器称为七层交换机（L7 switch），除了支持四层负载均衡以外，还有分析应用层的信息，如HTTP协议URI或Cookie信息，实现七层负载均衡。此种负载均衡器能理解应用协议，常见例子有： haproxy，MySQL Proxy。</p>
<h2 id="8、四层负载均衡和七层负载均衡的区别"><a href="#8、四层负载均衡和七层负载均衡的区别" class="headerlink" title="8、四层负载均衡和七层负载均衡的区别"></a>8、四层负载均衡和七层负载均衡的区别</h2><h3 id="8-1-技术原理上的区别"><a href="#8-1-技术原理上的区别" class="headerlink" title="8.1 技术原理上的区别"></a>8.1 技术原理上的区别</h3><p><strong>所谓四层负载均衡</strong>，也就是主要通过报文中的目标地址和端口，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器。<br>以常见的TCP为例，负载均衡设备在接收到第一个来自客户端的SYN 请求时，即通过上述方式选择一个最佳的服务器，并对报文中目标IP地址进行修改(改为后端服务器IP），直接转发给该服务器。TCP的连接建立，即三次握手是客户端和服务器直接建立的，负载均衡设备只是起到一个类似路由器的转发动作。在某些部署情况下，为保证服务器回包可以正确返回给负载均衡设备，在转发报文的同时可能还会对报文原来的源地址进行修改。<br><img src="http://image.winrains.cn/2019/09/c874f-135432wqsgspttqsbtbqeq.jpg" alt="一篇读懂分布式架构下的负载均衡技术：分类、原理、算法、常见方案等_9.jpg"><br><strong>所谓七层负载均衡</strong>，也称为“内容交换”，也就是主要通过报文中的真正有意义的应用层内容，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器。<br>以常见的TCP为例，负载均衡设备如果要根据真正的应用层内容再选择服务器，只能先代理最终的服务器和客户端建立连接(三次握手)后，才可能接受到客户端发送的真正应用层内容的报文，然后再根据该报文中的特定字段，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器。负载均衡设备在这种情况下，更类似于一个代理服务器。负载均衡和前端的客户端以及后端的服务器会分别建立TCP连接。所以从这个技术原理上来看，七层负载均衡明显的对负载均衡设备的要求更高，处理七层的能力也必然会低于四层模式的部署方式。</p>
<h3 id="8-2-应用场景的需求"><a href="#8-2-应用场景的需求" class="headerlink" title="8.2 应用场景的需求"></a>8.2 应用场景的需求</h3><p>七层应用负载的好处，是使得整个网络更”智能化”。参考这篇《<a href="https://blog.51cto.com/virtualadc/580832" target="_blank" rel="noopener">利用负载均衡优化和加速HTTP应用</a>》，就可以基本上了解这种方式的优势所在。<br>例如访问一个网站的用户流量，可以通过七层的方式，将对图片类的请求转发到特定的图片服务器并可以使用缓存技术；将对文字类的请求可以转发到特定的文字服务器并可以使用压缩技术。<br>当然这只是七层应用的一个小案例，从技术原理上，这种方式可以对客户端的请求和服务器的响应进行任意意义上的修改，极大的提升了应用系统在网络层的灵活性。很多在后台，例如Nginx或者Apache上部署的功能可以前移到负载均衡设备上，例如客户请求中的Header重写，服务器响应中的关键字过滤或者内容插入等功能。<br>另外一个常常被提到功能就是安全性。网络中最常见的SYN Flood攻击，即黑客控制众多源客户端，使用虚假IP地址对同一目标发送SYN攻击，通常这种攻击会大量发送SYN报文，耗尽服务器上的相关资源，以达到Denial of Service(DoS)的目的。<br>从技术原理上也可以看出，四层模式下这些SYN攻击都会被转发到后端的服务器上；而七层模式下这些SYN攻击自然在负载均衡设备上就截止，不会影响后台服务器的正常运营。另外负载均衡设备可以在七层层面设定多种策略，过滤特定报文，例如SQL Injection等应用层面的特定攻击手段，从应用层面进一步提高系统整体安全。<br>现在的7层负载均衡，主要还是着重于应用HTTP协议，所以其应用范围主要是众多的网站或者内部信息平台等基于B/S开发的系统。 4层负载均衡则对应其他TCP应用，例如IM即时通讯、实时消息推送等socket长连接系统。</p>
<h3 id="8-3-七层应用需要考虑的问题"><a href="#8-3-七层应用需要考虑的问题" class="headerlink" title="8.3 七层应用需要考虑的问题"></a>8.3 七层应用需要考虑的问题</h3><p><strong>七层应用需要考虑的问题：</strong></p>
<ul>
<li><strong>1）是否真的必要：</strong>七层应用的确可以提高流量智能化，同时必不可免的带来设备配置复杂，负载均衡压力增高以及故障排查上的复杂性等问题。在设计系统时需要考虑四层七层同时应用的混杂情况。</li>
<li><strong>2）是否真的可以提高安全性：</strong>例如SYN Flood攻击，七层模式的确将这些流量从服务器屏蔽，但负载均衡设备本身要有强大的抗DDoS能力，否则即使服务器正常而作为中枢调度的负载均衡设备故障也会导致整个应用的崩溃。</li>
<li><strong>3）是否有足够的灵活度：</strong>七层应用的优势是可以让整个应用的流量智能化，但是负载均衡设备需要提供完善的七层功能，满足客户根据不同情况的基于应用的调度。最简单的一个考核就是能否取代后台Nginx或者Apache等服务器上的调度功能。能够提供一个七层应用开发接口的负载均衡设备，可以让客户根据需求任意设定功能，才真正有可能提供强大的灵活性和智能性。</li>
</ul>
<h3 id="8-4-总体对比"><a href="#8-4-总体对比" class="headerlink" title="8.4 总体对比"></a>8.4 总体对比</h3><p><strong>四层负载均衡和七层负载均衡技术的总体对比：</strong></p>
<ul>
<li><strong>1）智能性：</strong>七层负载均衡由于具备OIS七层的所有功能，所以在处理用户需求上能更加灵活，从理论上讲，七层模型能对用户的所有跟服务端的请求进行修改。例如对文件header添加信息，根据不同的文件类型进行分类转发。四层模型仅支持基于网络层的需求转发，不能修改用户请求的内容。</li>
<li><strong>2）安全性：</strong>七层负载均衡由于具有OSI模型的全部功能，能更容易抵御来自网络的攻击；四层模型从原理上讲，会直接将用户的请求转发给后端节点，无法直接抵御网络攻击。</li>
<li><strong>3）复杂度：</strong>四层模型一般比较简单的架构，容易管理，容易定位问题；七层模型架构比较复杂，通常也需要考虑结合四层模型的混用情况，出现问题定位比较复杂。</li>
<li><strong>4）效率比：</strong>四层模型基于更底层的设置，通常效率更高，但应用范围有限；七层模型需要更多的资源损耗，在理论上讲比四层模型有更强的功能，现在的实现更多是基于http应用。</li>
</ul>
<h2 id="9、负载均衡技术的常见具体应用方案"><a href="#9、负载均衡技术的常见具体应用方案" class="headerlink" title="9、负载均衡技术的常见具体应用方案"></a>9、负载均衡技术的常见具体应用方案</h2><p>目前有许多不同的负载均衡技术实现用以满足不同的应用需求，下面从负载均衡所采用的设备对象（软/硬件负载均衡），应用的OSI网络层次（网络层次上的负载均衡），及应用的地理结构（本地/全局负载均衡）等来分类。</p>
<h3 id="9-1-软-硬件负载均衡"><a href="#9-1-软-硬件负载均衡" class="headerlink" title="9.1 软/硬件负载均衡"></a>9.1 软/硬件负载均衡</h3><p><strong>软件负载均衡解决方案：</strong>是指在一台或多台服务器相应的操作系统上安装一个或多个附加软件来实现负载均衡，如DNS Load Balance，CheckPoint Firewall-1 ConnectControl，Keepalive+ipvs等，它的优点是基于特定环境，配置简单，使用灵活，成本低廉，可以满足一般的负载均衡需求。软件解决方案缺点也较多，因为每台服务器上安装额外的软件运行会消耗系统不定量的资源，越是功能强大的模块，消耗得越多，所以当连接请求特别大的时候，软件本身会成为服务器工作成败的一个关键；软件可扩展性并不是很好，受到操作系统的限制；由于操作系统本身的Bug，往往会引起安全问题。<br><strong>硬件负载均衡解决方案：</strong>是直接在服务器和外部网络间安装负载均衡设备，这种设备通常是一个独立于系统的硬件，我们称之为负载均衡器。由于专门的设备完成专门的任务，独立于操作系统，整体性能得到大量提高，加上多样化的负载均衡策略，智能化的流量管理，可达到最佳的负载均衡需求。负载均衡器有多种多样的形式，除了作为独立意义上的负载均衡器外，有些负载均衡器集成在交换设备中，置于服务器与Internet链接之间，有些则以两块网络适配器将这一功能集成到PC中，一块连接到Internet上，一块连接到后端服务器群的内部网络上。<br>软件负载均衡与硬件负载均衡的对比如下。<br><strong>1）软件负载均衡：</strong></p>
<ul>
<li>优点：是需求环境明确，配置简单，操作灵活，成本低廉，效率不高，能满足普通的企业需求；</li>
<li>缺点：依赖于系统，增加资源开销；软件的优劣决定环境的性能；系统的安全，软件的稳定性均会影响到整个环境的安全。</li>
</ul>
<p><strong>2）硬件负载均衡：</strong></p>
<ul>
<li>优点：是独立于系统，整体性能大量提升，在功能、性能上优于软件方式；智能的流量管理，多种策略可选，能达到最佳的负载均衡效果；</li>
<li>缺点：是价格昂贵。</li>
</ul>
<h3 id="9-2-本地-全局负载均衡"><a href="#9-2-本地-全局负载均衡" class="headerlink" title="9.2 本地/全局负载均衡"></a>9.2 本地/全局负载均衡</h3><p>负载均衡从其应用的地理结构上分为本地负载均衡(Local Load Balance)和全局负载均衡(Global Load Balance，也叫地域负载均衡)，本地负载均衡是指对本地的服务器群做负载均衡，全局负载均衡是指对分别放置在不同的地理位置、有不同网络结构的服务器群间作负载均衡。<br>本地负载均衡能有效地解决数据流量过大、网络负荷过重的问题，并且不需花费昂贵开支购置性能卓越的服务器，充分利用现有设备，避免服务器单点故障造成数据流量的损失。其有灵活多样的均衡策略把数据流量合理地分配给服务器群内的服务器共同负担。即使是再给现有服务器扩充升级，也只是简单地增加一个新的服务器到服务群中，而不需改变现有网络结构、停止现有的服务。<br>全局负载均衡主要用于在一个多区域拥有自己服务器的站点，为了使全球用户只以一个IP地址或域名就能访问到离自己最近的服务器，从而获得最快的访问速度，也可用于子公司分散站点分布广的大公司通过Intranet（企业内部互联网）来达到资源统一合理分配的目的。</p>
<h3 id="9-3-网络层次上的负载均衡"><a href="#9-3-网络层次上的负载均衡" class="headerlink" title="9.3 网络层次上的负载均衡"></a>9.3 网络层次上的负载均衡</h3><p>针对网络上负载过重的不同瓶颈所在，从网络的不同层次入手，我们可以采用相应的负载均衡技术来解决现有问题。<br>随着带宽增加，数据流量不断增大，网络核心部分的数据接口将面临瓶颈问题，原有的单一线路将很难满足需求，而且线路的升级又过于昂贵甚至难以实现，这时就可以考虑采用链路聚合（Trunking）技术。<br>链路聚合技术（第二层负载均衡）将多条物理链路当作一条单一的聚合逻辑链路使用，网络数据流量由聚合逻辑链路中所有物理链路共同承担，由此在逻辑上增大了链路的容量，使其能满足带宽增加的需求。<br>现代负载均衡技术通常操作于网络的第四层或第七层。第四层负载均衡将一个Internet上合法注册的IP地址映射为多个内部服务器的IP地址，对每次 TCP连接请求动态使用其中一个内部IP地址，达到负载均衡的目的。在第四层交换机中，此种均衡技术得到广泛的应用，一个目标地址是服务器群VIP（虚拟 IP，Virtual IP address）连接请求的数据包流经交换机，交换机根据源端和目的IP地址、TCP或UDP端口号和一定的负载均衡策略，在服务器IP和VIP间进行映射，选取服务器群中最好的服务器来处理连接请求。<br>第七层负载均衡控制应用层服务的内容，提供了一种对访问流量的高层控制方式，适合对HTTP服务器群的应用。第七层负载均衡技术通过检查流经的HTTP报头，根据报头内的信息来执行负载均衡任务。<br><strong>第七层负载均衡优点表现在如下几个方面：</strong> </p>
<ul>
<li>1）通过对HTTP报头的检查，可以检测出HTTP400、500和600系列的错误信息，因而能透明地将连接请求重新定向到另一台服务器，避免应用层故障；</li>
<li>2）可根据流经的数据类型（如判断数据包是图像文件、压缩文件或多媒体文件格式等），把数据流量引向相应内容的服务器来处理，增加系统性能；</li>
<li>3）能根据连接请求的类型，如是普通文本、图象等静态文档请求，还是asp、cgi等的动态文档请求，把相应的请求引向相应的服务器来处理，提高系统的性能及安全性。</li>
</ul>
<p><strong>第七层负载均衡缺点表现在如下几个方面：</strong> </p>
<ul>
<li>1）第七层负载均衡受到其所支持的协议限制（一般只有HTTP），这样就限制了它应用的广泛性；</li>
<li>2）第七层负载均衡检查HTTP报头会占用大量的系统资源，势必会影响到系统的性能，在大量连接请求的情况下，负载均衡设备自身容易成为网络整体性能的瓶颈。</li>
</ul>
<h2 id="10、常用的负载均衡算法"><a href="#10、常用的负载均衡算法" class="headerlink" title="10、常用的负载均衡算法"></a>10、常用的负载均衡算法</h2><p><strong>常用的负载均衡算法分为两类：</strong></p>
<ul>
<li>1）一种是静态负载均衡；</li>
<li>2）一种是动态负载均衡。</li>
</ul>
<h3 id="10-1-静态均衡算法"><a href="#10-1-静态均衡算法" class="headerlink" title="10.1 静态均衡算法"></a>10.1 静态均衡算法</h3><p><strong><em>【10.1.1】轮询法：\</em></strong><br>将请求按顺序轮流地分配到每个节点上，不关心每个节点实际的连接数和当前的系统负载。</p>
<ul>
<li><strong>优点：</strong>简单高效，易于水平扩展，每个节点满足字面意义上的均衡；</li>
<li><strong>缺点：</strong>没有考虑机器的性能问题，根据木桶最短木板理论，集群性能瓶颈更多的会受性能差的服务器影响。</li>
</ul>
<p><img src="http://image.winrains.cn/2019/09/8034e-141033ti5u5f2ujnnvnpuu.jpg" alt="一篇读懂分布式架构下的负载均衡技术：分类、原理、算法、常见方案等_4.jpg"><br><strong><em>【10.1.2】随机法：\</em></strong><br>将请求随机分配到各个节点。由概率统计理论得知，随着客户端调用服务端的次数增多，其实际效果越来越接近于平均分配，也就是轮询的结果。<br>优缺点和轮询相似。<br><img src="http://image.winrains.cn/2019/09/53489-141041g244y2jm0upxhudz.jpg" alt="一篇读懂分布式架构下的负载均衡技术：分类、原理、算法、常见方案等_5.jpg"><br><strong><em>【10.1.3】源地址哈希法：</em></strong><br>源地址哈希的思想是根据客户端的IP地址，通过哈希函数计算得到一个数值，用该数值对服务器节点数进行取模，得到的结果便是要访问节点序号。采用源地址哈希法进行负载均衡，同一IP地址的客户端，当后端服务器列表不变时，它每次都会落到到同一台服务器进行访问。</p>
<ul>
<li><strong>优点：</strong>相同的IP每次落在同一个节点，可以人为干预客户端请求方向，例如灰度发布；</li>
<li><strong>缺点：</strong>如果某个节点出现故障，会导致这个节点上的客户端无法使用，无法保证高可用。当某一用户成为热点用户，那么会有巨大的流量涌向这个节点，导致冷热分布不均衡，无法有效利用起集群的性能。所以当热点事件出现时，一般会将源地址哈希法切换成轮询法。</li>
</ul>
<p><img src="http://image.winrains.cn/2019/09/a9a0f-141108rq36o6ymv79oa6d9.jpg" alt="一篇读懂分布式架构下的负载均衡技术：分类、原理、算法、常见方案等_6.jpg"><br><strong><em>【10.1.4】加权轮询法：</em></strong><br>不同的后端服务器可能机器的配置和当前系统的负载并不相同，因此它们的抗压能力也不相同。给配置高、负载低的机器配置更高的权重，让其处理更多的请；而配置低、负载高的机器，给其分配较低的权重，降低其系统负载，加权轮询能很好地处理这一问题，并将请求顺序且按照权重分配到后端。<br>加权轮询算法要生成一个服务器序列，该序列中包含n个服务器。n是所有服务器的权重之和。在该序列中，每个服务器的出现的次数，等于其权重值。并且，生成的序列中，服务器的分布应该尽可能的均匀。比如序列{a, a, a, a, a, b, c}中，前五个请求都会分配给服务器a，这就是一种不均匀的分配方法，更好的序列应该是：{a, a, b, a, c, a, a}。</p>
<ul>
<li><strong>优点：</strong>可以将不同机器的性能问题纳入到考量范围，集群性能最优最大化；</li>
<li><strong>缺点：</strong>生产环境复杂多变，服务器抗压能力也无法精确估算，静态算法导致无法实时动态调整节点权重，只能粗糙优化。</li>
</ul>
<p><img src="http://image.winrains.cn/2019/09/68f38-141113uc2jtwlx5nyy1emj.jpg" alt="一篇读懂分布式架构下的负载均衡技术：分类、原理、算法、常见方案等_7.jpg"><br><strong><em>【10.1.5】加权随机法：\</em></strong><br>与加权轮询法一样，加权随机法也根据后端机器的配置，系统的负载分配不同的权重。不同的是，它是按照权重随机请求后端服务器，而非顺序。<br><strong><em>【10.1.6】键值范围法：\</em></strong><br>根据键的范围进行负债，比如0到10万的用户请求走第一个节点服务器，10万到20万的用户请求走第二个节点服务器……以此类推。</p>
<ul>
<li><strong>优点：</strong>容易水平扩展，随着用户量增加，可以增加节点而不影响旧数据；</li>
<li><strong>缺点：</strong>容易负债不均衡，比如新注册的用户活跃度高，旧用户活跃度低，那么压力就全在新增的服务节点上，旧服务节点性能浪费。而且也容易单点故障，无法满足高可用。</li>
</ul>
<p><img src="http://image.winrains.cn/2019/09/1acfa-141122ikky2ale423yka1y.jpg" alt="一篇读懂分布式架构下的负载均衡技术：分类、原理、算法、常见方案等_8.jpg"><br>（<strong>注：</strong>以上所提到的单点故障，都可以用主从方式来解决，从节点监听主节点心跳，当发现主节点死亡，从节点切换成主节点顶替上去。这里可以思考一个问题，怎么设计集群主从可以最大程度上降低成本）</p>
<h3 id="10-2-动态负债均衡算法"><a href="#10-2-动态负债均衡算法" class="headerlink" title="10.2 动态负债均衡算法"></a>10.2 动态负债均衡算法</h3><p><strong><em>【10.2.1】最小连接数法：</em></strong><br>根据每个节点当前的连接情况，动态地选取其中当前积压连接数最少的一个节点处理当前请求，尽可能地提高后端服务的利用效率，将请求合理地分流到每一台服务器。俗称闲的人不能闲着，大家一起动起来。</p>
<ul>
<li><strong>优点：</strong>动态，根据节点状况实时变化；</li>
<li><strong>缺点：</strong>提高了复杂度，每次连接断开需要进行计数；</li>
<li><strong>实现：</strong>将连接数的倒数当权重值。</li>
</ul>
<p><strong><em>【10.2.2】最快响应速度法：</em></strong><br>根据请求的响应时间，来动态调整每个节点的权重，将响应速度快的服务节点分配更多的请求，响应速度慢的服务节点分配更少的请求，俗称能者多劳，扶贫救弱。</p>
<ul>
<li><strong>优点：</strong>动态，实时变化，控制的粒度更细，跟灵敏；</li>
<li><strong>缺点：</strong>复杂度更高，每次需要计算请求的响应速度；</li>
<li><strong>实现：</strong>可以根据响应时间进行打分，计算权重。</li>
</ul>
<p><strong><em>【10.2.3】观察模式法：\</em></strong><br>观察者模式是综合了最小连接数和最快响应度，同时考量这两个指标数，进行一个权重的分配。</p>
<blockquote>
<p>作者：JackJiang</p>
<p>来源：<a href="http://www.52im.net/thread-2494-1-1.html" target="_blank" rel="noopener">http://www.52im.net/thread-2494-1-1.html</a></p>
</blockquote>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" rel="tag"># 负载均衡</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/12/27/RPC%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E3%80%81%E5%8E%9F%E7%90%86%E5%92%8C%E7%94%A8%E9%80%94/" rel="prev" title="RPC基本概念、原理和用途">
      <i class="fa fa-chevron-left"></i> RPC基本概念、原理和用途
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/12/27/%E8%A7%A3%E5%AF%86%E5%B0%8F%E7%B1%B3%E6%8A%A2%E8%B4%AD%E7%B3%BB%E7%BB%9F%E5%8D%83%E4%B8%87%E9%AB%98%E5%B9%B6%E5%8F%91%E6%9E%B6%E6%9E%84%E7%9A%84%E6%BC%94%E8%BF%9B%E5%92%8C%E5%AE%9E%E8%B7%B5/" rel="next" title="解密小米抢购系统千万高并发架构的演进和实践">
      解密小米抢购系统千万高并发架构的演进和实践 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、引言"><span class="nav-number">1.</span> <span class="nav-text">1、引言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、相关文章"><span class="nav-number">2.</span> <span class="nav-text">2、相关文章</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、负载均衡分类"><span class="nav-number">3.</span> <span class="nav-text">3、负载均衡分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、二层负载均衡"><span class="nav-number">4.</span> <span class="nav-text">4、二层负载均衡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、三层负载均衡"><span class="nav-number">5.</span> <span class="nav-text">5、三层负载均衡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、四层负载均衡"><span class="nav-number">6.</span> <span class="nav-text">6、四层负载均衡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、七层负载均衡"><span class="nav-number">7.</span> <span class="nav-text">7、七层负载均衡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8、四层负载均衡和七层负载均衡的区别"><span class="nav-number">8.</span> <span class="nav-text">8、四层负载均衡和七层负载均衡的区别</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-技术原理上的区别"><span class="nav-number">8.1.</span> <span class="nav-text">8.1 技术原理上的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-应用场景的需求"><span class="nav-number">8.2.</span> <span class="nav-text">8.2 应用场景的需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-七层应用需要考虑的问题"><span class="nav-number">8.3.</span> <span class="nav-text">8.3 七层应用需要考虑的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4-总体对比"><span class="nav-number">8.4.</span> <span class="nav-text">8.4 总体对比</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9、负载均衡技术的常见具体应用方案"><span class="nav-number">9.</span> <span class="nav-text">9、负载均衡技术的常见具体应用方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-软-硬件负载均衡"><span class="nav-number">9.1.</span> <span class="nav-text">9.1 软/硬件负载均衡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-本地-全局负载均衡"><span class="nav-number">9.2.</span> <span class="nav-text">9.2 本地/全局负载均衡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-网络层次上的负载均衡"><span class="nav-number">9.3.</span> <span class="nav-text">9.3 网络层次上的负载均衡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10、常用的负载均衡算法"><span class="nav-number">10.</span> <span class="nav-text">10、常用的负载均衡算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-静态均衡算法"><span class="nav-number">10.1.</span> <span class="nav-text">10.1 静态均衡算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-动态负债均衡算法"><span class="nav-number">10.2.</span> <span class="nav-text">10.2 动态负债均衡算法</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">winrains</p>
  <div class="site-description" itemprop="description">淡泊明志</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">469</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">82</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">108</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">winrains</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.6.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
