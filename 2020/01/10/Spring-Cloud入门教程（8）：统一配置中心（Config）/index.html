<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://congsheng.wang').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="对于配置的重要性，我想我不用进行任何强调，大家都可以明白其重要性。在普通单体应用，我们常使用配置文件(application(*).properties(yml))管理应用的所有配置。这些配置文件在单体应用中非常胜任其角色，并没有让我们感觉到有头疼的地方。但随着微服务框架的引入，微服务数量就会在我们产品中不断增加，之前我们重点考虑的是系统的可伸缩、可扩展性好，但随之就是配置管理的问题就会一一暴露出">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Cloud入门教程（8）：统一配置中心（Config）">
<meta property="og:url" content="http:&#x2F;&#x2F;congsheng.wang&#x2F;2020&#x2F;01&#x2F;10&#x2F;Spring-Cloud%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%EF%BC%888%EF%BC%89%EF%BC%9A%E7%BB%9F%E4%B8%80%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%EF%BC%88Config%EF%BC%89&#x2F;index.html">
<meta property="og:site_name" content="congsheng的博客">
<meta property="og:description" content="对于配置的重要性，我想我不用进行任何强调，大家都可以明白其重要性。在普通单体应用，我们常使用配置文件(application(*).properties(yml))管理应用的所有配置。这些配置文件在单体应用中非常胜任其角色，并没有让我们感觉到有头疼的地方。但随着微服务框架的引入，微服务数量就会在我们产品中不断增加，之前我们重点考虑的是系统的可伸缩、可扩展性好，但随之就是配置管理的问题就会一一暴露出">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;20191111200356-c960f.png">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;20191111200357-2abb9.png">
<meta property="og:updated_time" content="2020-01-10T13:37:24.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;20191111200356-c960f.png">

<link rel="canonical" href="http://congsheng.wang/2020/01/10/Spring-Cloud%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%EF%BC%888%EF%BC%89%EF%BC%9A%E7%BB%9F%E4%B8%80%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%EF%BC%88Config%EF%BC%89/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>Spring Cloud入门教程（8）：统一配置中心（Config） | congsheng的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">congsheng的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">欢迎访问：winrains.cn</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">156</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">94</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">984</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2020/01/10/Spring-Cloud%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%EF%BC%888%EF%BC%89%EF%BC%9A%E7%BB%9F%E4%B8%80%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%EF%BC%88Config%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="congsheng.wang">
      <meta itemprop="description" content="trouble is a friend">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="congsheng的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring Cloud入门教程（8）：统一配置中心（Config）
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-10 21:37:24" itemprop="dateCreated datePublished" datetime="2020-01-10T21:37:24+08:00">2020-01-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">Spring技术</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring%E6%8A%80%E6%9C%AF/Spring-Cloud/" itemprop="url" rel="index">
                    <span itemprop="name">Spring Cloud</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>对于配置的重要性，我想我不用进行任何强调，大家都可以明白其重要性。在普通单体应用，我们常使用配置文件(application(*).properties(yml))管理应用的所有配置。这些配置文件在单体应用中非常胜任其角色，并没有让我们感觉到有头疼的地方。但随着微服务框架的引入，微服务数量就会在我们产品中不断增加，之前我们重点考虑的是系统的可伸缩、可扩展性好，但随之就是配置管理的问题就会一一暴露出来。起初微服务器各自管各自的配置，在开发阶段并没什么问题，但到了生产环境管理就会很头疼，如果要大规模更新某项配置，困难就可想而知。</p>
<a id="more"></a>

<p>为此，在分布式系统中，Spring Cloud提供一个Config子项目，该项目核心就是配置中心，通过一个服务端和多个客户端实现配置服务。我们可使用配置服务器集中的管理所有服务的各种环境配置文件。配置服务中心默认采用Git的方式进行存储，因此我们很容易部署修改，并可以对环境配置进行版本管理。<br>Spring Cloud Config具有中心化、版本控制、支持动态更新和语言独立等特性。其特点是:</p>
<ul>
<li>提供服务端和客户端支持(Spring Cloud Config Server和Spring Cloud Config Client);</li>
<li>集中式管理分布式环境下的应用配置;</li>
<li>基于Spring环境，实现了与Spring应用无缝集成;</li>
<li>可用于任何语言开发的程序;</li>
<li>默认实现基于Git仓库(也支持SVN)，从而可以进行配置的版本管理;</li>
</ul>
<p>Spring Cloud Config的结构图如下:</p>
<p><img src="http://image.winrains.cn/2019/11/20191111200356-c960f.png" alt="img"></p>
<p>Config-结构图</p>
<p>从图中可以看出Spring Cloud Config有两个角色(类似Eureka): Server和Client。Spring Cloud Config Server作为配置中心的服务端承担如下作用:</p>
<ul>
<li><ul>
<li>拉取配置时更新Git仓库副本，保证是配置为最新;</li>
</ul>
</li>
<li><p>支持从yml、json、properties等文件加载配置;</p>
</li>
<li><p>配合Eureke可实现服务发现，配合Cloud Bus(这个后面我们在详细说明)可实现配置推送更新;</p>
</li>
<li><p>默认配置存储基于Git仓库(可以切换为SVN)，从而支持配置的版本管理.</p>
</li>
</ul>
<p>而对于，Spring Cloud Config Client则非常方便，只需要在启动配置文件中增加使用Config Server上哪个配置文件即可。</p>
<h2 id="1-示例代码"><a href="#1-示例代码" class="headerlink" title="1. 示例代码"></a>1. 示例代码</h2><h3 id="1-1-构建Config-Server"><a href="#1-1-构建Config-Server" class="headerlink" title="1.1 构建Config-Server"></a>1.1 构建Config-Server</h3><p><strong>编写pom.xml文件</strong><br><code>Config-Server</code>是一个标准的Spring Boot应用，所以<code>pom.xml</code>也是继承之前的Parent：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>twostepsfromjava.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>twostepsfromjava-cloud-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../parent<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Cloud Sample Projects: Config Server<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span></pre></td></tr></table></figure>

<p><strong>编写启动类</strong></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * TwoStepsFromJava Cloud -- Config Server</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> *</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * @author CD826(CD826Dong@gmail.com)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * @since 1.0.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@SpringBootApplication</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@EnableConfigServer</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">public class Application &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">static</span> <span class="selector-tag">void</span> <span class="selector-tag">main</span>(String[] args) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        <span class="selector-tag">SpringApplication</span><span class="selector-class">.run</span>(Application.class, args);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>这里最重要的就是增加<code>@EnableConfigServer</code>，其它与之前的应用一致。<br>编写配置文件</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">server.port=<span class="number">8280</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.application</span>.name=config-server</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.server</span><span class="selector-class">.git</span>.uri=https:<span class="comment">//github.com/cd826/SpringcloudSamplesConfig</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.server</span><span class="selector-class">.git</span>.username=your git username</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.server</span><span class="selector-class">.git</span>.password=your git password</span></pre></td></tr></table></figure>

<p>这里最重要的是需要配置Git仓库的地址及登录用户名和口令。<br><strong>创建测试配置文件</strong><br>我们在<strong>SpringcloudSamplesConfig</strong>仓库中增加量个配置文件。<br><code>mallWeb.properties</code>，文件内容如下:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">foo</span> = bar</span></pre></td></tr></table></figure>

<p><code>mallWeb-dev.properties</code>，文件内容如下:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">bar</span> = cd826</span></pre></td></tr></table></figure>

<blockquote>
<p>注意：这里编写文件后记得提交，否则会测试失败。</p>
</blockquote>
<p><strong>启动测试</strong><br>启动<code>config-server</code>. 在终端中我们输入以下命令(或者使用postman):</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">curl <span class="string">localhost:</span><span class="number">8280</span><span class="regexp">/mallWeb/</span>dev</span></pre></td></tr></table></figure>

<p>在终端中会输出以下内容:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"name"</span>:<span class="string">"mallWeb"</span>,<span class="attr">"profiles"</span>:[<span class="string">"dev"</span>],<span class="attr">"label"</span>:<span class="literal">null</span>,<span class="attr">"version"</span>:<span class="literal">null</span>,<span class="attr">"state"</span>:<span class="literal">null</span>,<span class="attr">"propertySources"</span>:[</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    &#123;<span class="attr">"name"</span>:<span class="string">"https://github.com/cd826/SpringcloudSamplesConfig/mallWeb-dev.properties"</span>,<span class="attr">"source"</span>:&#123;<span class="attr">"bar"</span>:<span class="string">"cd826"</span>&#125;&#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    &#123;<span class="attr">"name"</span>:<span class="string">"https://github.com/cd826/SpringcloudSamplesConfig/mallWeb.properties"</span>,<span class="attr">"source"</span>:&#123;<span class="attr">"foo"</span>:<span class="string">"bar"</span>&#125;&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">]&#125;</span></pre></td></tr></table></figure>

<p>这里可以看到，我们提交到Git中的配置文件已经能够被<code>config-server</code>正确的读取到。<br><strong>config-server默认配置</strong><br>当我们查看源码会发现在<strong>spring-cloud-config-server.jar</strong>包中有一个默认配置文件<code>configserver.yml</code>配置文件，也就是说当我们设置<code>spring.application.name=configserver</code>时，就会默认加载该配置文件，该配置文件内容如下:</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">info</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="attribute">component</span>: Config Server</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">spring</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  <span class="attribute">application</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">name</span>: configserver</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  <span class="attribute">jmx</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">default_domain</span>: cloud.config.server</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  <span class="attribute">cloud</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">config</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">      <span class="attribute">server</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">git</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">          <span class="attribute">uri</span>: <span class="attribute">https</span>:<span class="comment">//github.com/spring-cloud-samples/config-repo</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">          <span class="attribute">repos</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">            - <span class="attribute">patterns</span>: multi-repo-demo-*</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">              <span class="attribute">uri</span>: <span class="attribute">https</span>:<span class="comment">//github.com/spring-cloud-samples/config-repo</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">server</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">  <span class="attribute">port</span>: <span class="number">8888</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">management</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">  <span class="attribute">context_path</span>: /admin</span></pre></td></tr></table></figure>

<p>默认使用<code>8888</code>端口，并且从<code>https://github.com/spring-cloud-samples/config-repo</code>这个Git仓库中查找配置文件。<br>因为，在上面的示例中我们重新定义了应用名称和服务端口。</p>
<h3 id="1-2-构建config-client"><a href="#1-2-构建config-client" class="headerlink" title="1.2 构建config-client"></a>1.2 构建config-client</h3><p><strong>config-client</strong>可以是任何一个基于Spring boot的应用，这里为了讲解方便，我们构建一个非常简单的web工程。<br><strong>编写pom.xml文件</strong><br>我们的<code>config-client</code>项目需要引入对<code>spring-cloud-starter-config</code>的依赖，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>twostepsfromjava.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>twostepsfromjava-cloud-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../parent<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>config-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Cloud Sample Projects: Config Client<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span></pre></td></tr></table></figure>

<p><strong>编写启动类</strong><br>一个标准的Spring Boot启动类:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * TwoStepsFromJava Cloud -- Config Client Project</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> *</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * <span class="doctag">@author</span> CD826(CD826Dong@gmail.com)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        SpringApplication.run(Application<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p><strong>编写测试Controller</strong><br>这个测试Controller主要就是验证我们可以从Git仓库中获取配置内容。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * Config Client Test Controller</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> *</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * <span class="doctag">@author</span> CD826(CD826Dong<span class="doctag">@gmail</span>.com)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(<span class="meta-string">"/cfg"</span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigController</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Value(<span class="meta-string">"<span class="subst">$&#123;foo&#125;</span>"</span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    String foo;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Value(<span class="meta-string">"<span class="subst">$&#123;bar&#125;</span>"</span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    String bar;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    <span class="meta">@RequestMapping(value = <span class="meta-string">"/foo"</span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> String foo()&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">return</span> foo + <span class="string">"——"</span> + bar;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p><strong>编写配置文件</strong><br>这里编写的配置文件名称为:<code>bootstrap.properties</code>，内容如下:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="number">8080</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=mallWeb</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.profile</span>=dev</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.uri</span>= http://localhost:<span class="number">8280</span>/</span></pre></td></tr></table></figure>

<p>定义了微服务的名称和profile以及配置服务器的地址。</p>
<blockquote>
<p>注意: 这些配置不能够配置在<code>application.properties</code>文件中，因为在Spring Boot启动时有引导上下文和应用上下文的概念，只有将配置服务器信息定义在引导上下文中，才能够从配置服务器中获取到配置信息。否则，服务启动时会报找不到foo变量定义的错误。</p>
</blockquote>
<h3 id="1-3-启动测试"><a href="#1-3-启动测试" class="headerlink" title="1.3 启动测试"></a>1.3 启动测试</h3><p>启动后我们可以访问：<a href="http://localhost:8080/cfg/foo，可以看到如下界面：" target="_blank" rel="noopener">http://localhost:8080/cfg/foo，可以看到如下界面：</a></p>
<p><img src="http://image.winrains.cn/2019/11/20191111200357-2abb9.png" alt="img"></p>
<p>Config-010</p>
<p>说明，我们的<strong>config-client</strong>已经成功从<strong>config-server</strong>上获取到配置的数据了。</p>
<h3 id="1-4-Spring项目配置加载顺序"><a href="#1-4-Spring项目配置加载顺序" class="headerlink" title="1.4 Spring项目配置加载顺序"></a>1.4 Spring项目配置加载顺序</h3><ul>
<li>这里是列表文本命令行参数</li>
<li>SPRING_APPLICATION_JSON 参数</li>
<li>从java:comp/env 加载 JNDI 属性</li>
<li>Java系统属性 （System.getProperties()）</li>
<li>操作系统环境变量</li>
<li>如果有使用 random.* 属性配置，则使用 RandomValuePropertySource 产生</li>
<li>外部特定应用配置文件 例如：application-{profile}.properties 或者 YAML variants</li>
<li>内部特定应用配置文件 例如：application-{profile}.properties 或者 YAML variants</li>
<li>外部应用配置文件 例如：application.properties 或者 YAML variants</li>
<li>内部应用配置文件 例如：application.properties 或者 YAML variants</li>
<li>加载@Configuration类的 @PropertySource 或者 @ConfigurationProperties 指向的配置文件</li>
<li>默认配置，通过SpringApplication.setDefaultProperties 设置</li>
</ul>
<h2 id="2-配置规则详解"><a href="#2-配置规则详解" class="headerlink" title="2. 配置规则详解"></a>2. 配置规则详解</h2><p>下面我们来看一看Config Client从Config Server中获取配置数据的流程:</p>
<ul>
<li><ol>
<li><strong>Config Client</strong>启动时，根据<code>bootstrap.properties</code>中配置的应用名称(application)、环境名(profile)和分支名(label)，向<strong>Config Server</strong>请求获取配置数据;</li>
</ol>
</li>
<li><ol>
<li><strong>Config Server</strong>根据<strong>Config Client</strong>的请求及配置，从Git仓库(这里以Git为例)中查找符合的配置文件;</li>
</ol>
</li>
<li><ol>
<li><strong>Config Server</strong>将匹配到的Git仓库拉取到本地，并建立本地缓存;</li>
</ol>
</li>
<li><ol>
<li><strong>Config Server</strong>创建Spring的<code>ApplicationContext</code>实例，并根据拉取的配置文件，填充配置信息，然后将该配置信息返回给<strong>Config Client</strong>;</li>
</ol>
</li>
<li><ol>
<li><strong>Config Client</strong>获取到<strong>Config Server</strong>返回的配置数据后，将这些配置数据加载到自己的上下文中。同时，因为这些配置数据的优先级高于本地Jar包中的配置，因此将不再加载本地的配置。</li>
</ol>
</li>
</ul>
<p>那么，<strong>Config Server</strong>又是如何与Git仓库中的配置文件进行匹配的呢？通常，我们会为一个项目建立类似如下的配置文件:</p>
<ul>
<li><strong>mallweb.properties</strong>: 基础配置文件;</li>
<li><strong>mallweb-dev.properties</strong>: 开发使用的配置文件;</li>
<li><strong>mallweb-test.properties</strong>: 测试使用的配置文件;</li>
<li><strong>mallweb-prod.properties</strong>: 生产环境使用的配置文件;</li>
</ul>
<p>当我们访问<strong>Config Server</strong>的端点时，就会按照如下映射关系来匹配相应的配置文件：</p>
<ul>
<li><ol>
<li>/{application}/{profile}[/{label}]</li>
</ol>
</li>
<li><ol>
<li>/{application}-{profile}.yml</li>
</ol>
</li>
<li><ol>
<li>/{label}/{application}-{profile}.yml</li>
</ol>
</li>
<li><ol>
<li>/{application}-{profile}.properties</li>
</ol>
</li>
<li><ol>
<li>/{label}/{application}-{profile}.properties</li>
</ol>
</li>
</ul>
<p>上面的Url将会映射为格式为:{application}-{profile}.properties(yml)的配置文件。另外，<strong>label</strong>则对应Git上分支名称，是一个可选参数，如果没有则为默认的<strong>master</strong>分支。<br>而<strong>Config-Client</strong>的<code>bootstrap.properties</code>配置对应如下:</p>
<ul>
<li>spring.application.name &lt;==&gt; application;</li>
<li>spring.cloud.config.profile &lt;==&gt; profile;</li>
<li>spring.cloud.config.label &lt;==&gt; label.</li>
</ul>
<h3 id="2-1-Git仓库配置"><a href="#2-1-Git仓库配置" class="headerlink" title="2.1 Git仓库配置"></a>2.1 Git仓库配置</h3><p><strong>Config Server</strong>默认使用的就是Git，所以配置也非常简单，如上面的配置(application.properties):</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.server</span><span class="selector-class">.git</span>.uri=http:<span class="comment">//</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.server</span><span class="selector-class">.git</span>.username=username</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.server</span><span class="selector-class">.git</span>.password=password</span></pre></td></tr></table></figure>

<p>那么客户端在请求时服务端就会到该仓库中进行查找。</p>
<h4 id="2-1-1-使用占位符"><a href="#2-1-1-使用占位符" class="headerlink" title="2.1.1 使用占位符"></a>2.1.1 使用占位符</h4><p>在服务端配置中我们也可以使用<strong>{application}</strong>、<strong>{profile}</strong> 和 <strong>{label}</strong>占位符，如下:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.server</span><span class="selector-class">.git</span>.uri=http:<span class="comment">//github.com/cd826/&#123;application&#125;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.server</span><span class="selector-class">.git</span>.username=username</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.server</span><span class="selector-class">.git</span>.password=password</span></pre></td></tr></table></figure>

<p>这样，我们就可以为每一个应用客户端创建一个单独的仓库。</p>
<blockquote>
<p>这里需要注意的是，如果Git的分支或标签中包含”/“时，在{label}参数中需要使用”(_)”替代，这个主要是避免与Http URL转义符处理的冲突。</p>
</blockquote>
<h4 id="2-1-2-使用模式匹配"><a href="#2-1-2-使用模式匹配" class="headerlink" title="2.1.2 使用模式匹配"></a>2.1.2 使用模式匹配</h4><p>我们也可以使用<strong>{application}</strong>/<strong>{profile}</strong>进行模式匹配，以便获取到相应的配置文件。配置示例如下:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">spring.cloud.<span class="built_in">config</span>.server.git.uri=https://github.com/spring-cloud-samples/<span class="built_in">config</span>-repo</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">spring.cloud.<span class="built_in">config</span>.server.git.repos.simple=https://github.com/simple/<span class="built_in">config</span>-repo</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">spring.cloud.<span class="built_in">config</span>.server.git.repos.special.pattern=special*/dev*,*special*/dev*</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">spring.cloud.<span class="built_in">config</span>.server.git.repos.special.uri=https://github.com/special/<span class="built_in">config</span>-repo</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">spring.cloud.<span class="built_in">config</span>.server.git.repos.<span class="keyword">local</span>.pattern=<span class="keyword">local</span>*</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">spring.cloud.<span class="built_in">config</span>.server.git.repos.<span class="keyword">local</span>.uri=file:/home/configsvc/<span class="built_in">config</span>-repo</span></pre></td></tr></table></figure>

<p>如果模式中需要配置多个值，那么可以使用逗号分隔。<br>如果<strong>{application}</strong>/<strong>{profile}</strong>没有匹配到任何资源，则使用<code>spring.cloud.config.server.git.uri</code>配置的默认URI。<br>当我们使用yml类型的文件进行配置时，如果模式属性是一个YAML数组，也可以使用YAML数组格式来定义。这样可以设置成多个配个配置文件，如:</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">spring</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="attribute">cloud</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">config</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">      <span class="attribute">server</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">git</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">          <span class="attribute">uri</span>: <span class="attribute">https</span>:<span class="comment">//github.com/spring-cloud-samples/config-repo</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">          <span class="attribute">repos</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">            <span class="attribute">development</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">              <span class="attribute">pattern</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">                - */development</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">                - */staging</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">              <span class="attribute">uri</span>: <span class="attribute">https</span>:<span class="comment">//github.com/development/config-repo</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">            <span class="attribute">staging</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">              <span class="attribute">pattern</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">                - */qa</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">                - */production</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">              <span class="attribute">uri</span>: <span class="attribute">https</span>:<span class="comment">//github.com/staging/config-repo</span></span></pre></td></tr></table></figure>

<h4 id="2-1-3-搜索目录"><a href="#2-1-3-搜索目录" class="headerlink" title="2.1.3 搜索目录"></a>2.1.3 搜索目录</h4><p>当我们把配置文件存放在Git仓库中子目录中时，可以通过设置<code>serch-path</code>来指定该目录。同样，<code>serch-path</code>也支持上面的占位符。示例如下:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.server</span><span class="selector-class">.git</span>.uri=https:<span class="comment">//github.com/spring-cloud-samples/config-repo</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.server</span><span class="selector-class">.git</span>.searchPaths=foo,bar*</span></pre></td></tr></table></figure>

<p>这样系统就会自动搜索foo的子目录，以及以bar开头的文件夹中的子目录。</p>
<h4 id="2-1-4-SSH配置"><a href="#2-1-4-SSH配置" class="headerlink" title="2.1.4 SSH配置"></a>2.1.4 SSH配置</h4><p>如果你不想使用HTTPS和用户认证，也可以直接使用SSH，这时候我们只需要将ssh需要的keys存储在<code>～/.ssh</code>目录即可，并将所配置的uri指向SSH地址即可，如：<code>git@github.com:cd826/SpringcloudSamplesConfig</code>。<br>如果你清楚的知道你的<code>~/.git</code>目录，那么你可以使用<code>git config --global</code>来配置。否则可以使用全局配置，比如：<code>git config --global http.sslVerify false</code>。</p>
<h4 id="2-1-4-代理"><a href="#2-1-4-代理" class="headerlink" title="2.1.4 代理"></a>2.1.4 代理</h4><p>Config-Server会使用JGit访问配置库，因此我们可以在<code>~/.git/config</code>下配置HTTPS所使用的代理，也可以使用JVM系统属性<code>-Dhttps.proxyHost</code>和<code>-Dhttps.proxyPort</code>来配置。</p>
<h4 id="2-1-5-本地缓存"><a href="#2-1-5-本地缓存" class="headerlink" title="2.1.5 本地缓存"></a>2.1.5 本地缓存</h4><p>当Config-Server从Git(或SVN)中获取了配置信息后，将会在本地的文件系统中存储一份。默认将存储在系统临时目录下，并且以<code>config-repo-</code>作为开头，在Linux系统中默认存储的目录为<code>/tmp/config-repo-</code>。Config-Server将配置信息存储在本地可以有效的防止当Git仓库出现故障而无法访问的问题，当Config-Server无法访问到Git仓库时就会读取之前存储在本地文件中的配置，然后将这些配置信息返回给Config-Client。比如，当我们断开网络进行测试，当我们启动Config-Server时会在控制台中看到以下输出：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="number">17</span>:<span class="number">18</span>:<span class="number">01</span> <span class="number">285</span> [http-nio<span class="number">-8280</span>-exec<span class="number">-1</span>] WARN  o.s.c.c.s.e.MultipleJGitEnvironmentRepository - Could <span class="keyword">not</span> fetch remote <span class="keyword">for</span> master remote: https:<span class="comment">//github.com/cd826/SpringcloudSamplesConfig</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="number">17</span>:<span class="number">18</span>:<span class="number">01</span> <span class="number">660</span> [http-nio<span class="number">-8280</span>-exec<span class="number">-1</span>] INFO  o.s.c.a.AnnotationConfigApplicationContext - Refreshing</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="number">17</span>:<span class="number">18</span>:<span class="number">01</span> <span class="number">710</span> [http-nio<span class="number">-8280</span>-exec<span class="number">-1</span>] INFO  o.s.b.f.a.AutowiredAnnotationBeanPostProcessor - JSR<span class="number">-330</span> <span class="string">'javax.inject.Inject'</span> annotation found <span class="keyword">and</span> supported <span class="keyword">for</span> <span class="built_in">auto</span>wiring</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="number">17</span>:<span class="number">18</span>:<span class="number">01</span> <span class="number">782</span> [http-nio<span class="number">-8280</span>-exec<span class="number">-1</span>] INFO  o.s.c.c.s.e.NativeEnvironmentRepository - Adding <span class="keyword">property</span> source: file:/Users/cd826/MyWork/springcloud-sample-projects/config/config-server/tmp/mallWeb-dev.properties</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="number">17</span>:<span class="number">18</span>:<span class="number">01</span> <span class="number">782</span> [http-nio<span class="number">-8280</span>-exec<span class="number">-1</span>] INFO  o.s.c.c.s.e.NativeEnvironmentRepository - Adding <span class="keyword">property</span> source: file:/Users/cd826/MyWork/springcloud-sample-projects/config/config-server/tmp/mallWeb.properties</span></pre></td></tr></table></figure>

<p>Spring Cloud 官方文档建议我们在Config-Server中指定本地文件路径，以避免出现不可预知的错误。可以使用下面的属性配置来指定本地文件路径:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">## Git仓库</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.server.git.basedir</span>=tmp/</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">## SVN仓库</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.server.svn.basedir</span>=tmp/</span></pre></td></tr></table></figure>

<h3 id="2-2-SVN配置"><a href="#2-2-SVN配置" class="headerlink" title="2.2 SVN配置"></a>2.2 SVN配置</h3><p>如果你的项目中使用的是SVN而不是Git，那么只需要在Config-Server中进行如下修改就可以支持SVN仓库。</p>
<h4 id="2-2-1-修改pom-xml"><a href="#2-2-1-修改pom-xml" class="headerlink" title="2.2.1 修改pom.xml"></a>2.2.1 修改pom.xml</h4><p>在pom文件中增加以下依赖:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.tmatesoft.svnkit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>svnkit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr></table></figure>

<h4 id="2-2-2-修改appliaction-properties"><a href="#2-2-2-修改appliaction-properties" class="headerlink" title="2.2.2 修改appliaction.properties"></a>2.2.2 修改appliaction.properties</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.server</span><span class="selector-class">.svn</span>.uri=&#123;your svn server&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.server</span><span class="selector-class">.svn</span>.username=username</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.server</span><span class="selector-class">.svn</span>.password=password</span></pre></td></tr></table></figure>

<h3 id="2-3-文件系统"><a href="#2-3-文件系统" class="headerlink" title="2.3 文件系统"></a>2.3 文件系统</h3><p>如果你的Config-Server中不想使用Git或SVN，那么我们也可以直接从当前classpath或文件系统中加载相应的配置文件，只需在配置文件中设置如下：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.profiles.active</span>=native</span></pre></td></tr></table></figure>

<p>注意Config-Server默认会从classpath下加载，我们可以使用<code>spring.cloud.config.server.native.searchLocations</code>属性来设置配置文件的目录。对于文件路径，我们的配置必须以<code>file:</code>开头，如果是Windows系统对于绝对路径我们还得对/进行转义，比如，在Windows下我们需要配置如下：<code>file:///${user.home}/config-repo</code>。<br>此外，当我们使用文件系统作为配置文件仓库时，<code>spring.cloud.config.server.native.searchLocations</code>的配置也是支持{application} 、{profile} 和 {label} 占位符的。</p>
<blockquote>
<p>Spring Cloud 官方还是推荐在测试和开发的时候可以使用文件系统，但是在正式环境中尽量还是使用Git或者SVN。</p>
</blockquote>
<blockquote>
<p>另，Spring Cloud Config中还支持另外一种配置文件方式：Vault Server，这个后面有空我们再探讨。</p>
</blockquote>
<h2 id="3-安全保护"><a href="#3-安全保护" class="headerlink" title="3. 安全保护"></a>3. 安全保护</h2><h3 id="3-1-Config-Server访问安全"><a href="#3-1-Config-Server访问安全" class="headerlink" title="3.1 Config-Server访问安全"></a>3.1 Config-Server访问安全</h3><p>对于我们存储在配置中心的一些配置内容，总会有一些是敏感信息，比如数据库连接的用户名和密码，你总不能直接裸奔吧，所以我们还是需要对Config-Server做一些安全控制。当然，对于Config-Server的安全控制有很多种，比如：物理网络限制、OAuth2授权等。但是，在这里因为我们使用的是SpringBoot，所以使用SpringSecurity会更容易也更简单。这时候，我们只需要在Config-Server中增加如下依赖:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr></table></figure>

<p>此时，当我们启动Config-Server时，SpringSecurity会默认为我们生产一个访问密码，这种方式常常不是我们需要的，所以一般我们还需要在配置文件中配置用户名和密码，比如：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">security</span>.<span class="keyword">user</span>.name=cd826</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">security</span>.<span class="keyword">user</span>.<span class="keyword">password</span>=pwd</span></pre></td></tr></table></figure>

<p>这样，当我们需要访问Config-Server时就会弹出用户认证对话框。此时，对于Config-Client我们需要在配置文件中增加用户和访问口令的配置，如下：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.username</span>=cd826</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.password</span>=pwd</span></pre></td></tr></table></figure>

<h3 id="3-2-加密与解密"><a href="#3-2-加密与解密" class="headerlink" title="3.2 加密与解密"></a>3.2 加密与解密</h3><p>访问安全是对整体的控制，多数情况下我们还需要对敏感内容加密后存储，比如之前所说的数据库访问的用户名称和登录口令。很幸运，Spring Cloud Config为我们提供相应的支持。<br>Spring Cloud Config提供了两种加解密方式: 1)对称加密; 2)非对称加密。在描述如何使用之前，我们先看看一些使用前提。</p>
<h4 id="3-2-1-安装JCE-Java-Cryptography-Extension"><a href="#3-2-1-安装JCE-Java-Cryptography-Extension" class="headerlink" title="3.2.1 安装JCE(Java Cryptography Extension)"></a>3.2.1 安装JCE(Java Cryptography Extension)</h4><p>Spring Cloud Config所提供的加解密依赖JCE，因为，JDK中没有默认提供，所以我们需要先安装JCE。安装方法也比较简单，就是下载相应的Jar包，然后把这些包替换<code>$JDK_HOME/jar/lib/security</code>相应的文件，对于JDK8下载地址为:<a href="http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html" target="_blank" rel="noopener">JCE for JDK8</a>.</p>
<h4 id="3-2-2-加解密端点"><a href="#3-2-2-加解密端点" class="headerlink" title="3.2.2 加解密端点"></a>3.2.2 加解密端点</h4><p>另外，Spring Cloud Config还提供了两个端点进行加密和解密，如下：</p>
<ul>
<li><strong>/encrypt</strong>: 加密端点，使用格式如下: <code>curl $CONFIG_SERVER/encrypt -d 所要加密的内容</code></li>
<li><strong>/decrypt</strong>: 解密端点，使用格式如下: <code>curl $CONFIG_SERVER/decrypt -d 所要解密的内容</code></li>
</ul>
<blockquote>
<p>注意：当你测试中所加解密中包含特殊字符时，需要进行URL编码，这时候你需要使用<code>--data-urlencode</code>而不是<code>-d</code>.</p>
</blockquote>
<h4 id="3-2-3-对称加密"><a href="#3-2-3-对称加密" class="headerlink" title="3.2.3 对称加密"></a>3.2.3 对称加密</h4><p>对称加解密的配置非常简单。我们只需要在配置文件中增加加解密所使用的密钥即可，如:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">encrypt.key</span>=cd826_key</span></pre></td></tr></table></figure>

<p>配置好之后，你可以启动Config-Server，并使用上面所说的端点进行加解密测试。<br>对于，配置文件我们需要为加密的内容增加一个<code>{cipher}</code>前导符。如：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.username</span>=dbuser</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.password</span>=&#123;cipher&#125;FKSAJDFGYOS8F7GLHAKERGFHLSAJ</span></pre></td></tr></table></figure>

<p>但是，如果你使用的配置文件是yml格式，那么需要使用单引号把加密内容引起来，如下：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">spring</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="attribute">datasource</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">username</span>:dbuser</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        <span class="attribute">password</span>:<span class="string">'&#123;cipher&#125;FKSAJDFGYOS8F7GLHAKERGFHLSAJ'</span></span></pre></td></tr></table></figure>

<h4 id="3-2-4-非对称加密"><a href="#3-2-4-非对称加密" class="headerlink" title="3.2.4 非对称加密"></a>3.2.4 非对称加密</h4><p>非对称加密相对于对称加密来说复杂了一些，首先我们需要借助Java的keytool生成密钥对，然后创建Key Store并复制到服务器目录下。对于keytool的使用可以参考这里:<a href="补充链接">《Spring Cloud入门教程(番外篇四): Keytool证书工具》</a>。</p>
<ol>
<li>使用keytool生成Key Store，命令如下:</li>
</ol>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>keytool -genkeypair -<span class="keyword">alias</span> tsfjckey -keyalg RSA \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  -dname <span class="string">"CN=Mall Web,OU=TwoStepsFromJava,O=Organization,L=city,S=province,C=china"</span> \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  -keypass javatwostepsfrom -keystore server.jks -storepass twostepsfromjava</span></pre></td></tr></table></figure>

<ol>
<li>将所生成<code>server.jks</code>拷贝到项目的<code>resources</code>目录下(Config-Server)。</li>
<li>修改配置文件:</li>
</ol>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">encrypt.key-store.location</span>=server.jks</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attr">encrypt.key-store.alias</span>=tsfjckey</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="attr">encrypt.key-store.password</span>=twostepsfromjava</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="attr">encrypt.key-store.secret</span>=javatwostepsfrom</span></pre></td></tr></table></figure>

<p>非对称加密相对于对称加密来说配置也复杂，但安全性也会高很多。</p>
<h4 id="3-2-5-使用多个加密Key"><a href="#3-2-5-使用多个加密Key" class="headerlink" title="3.2.5 使用多个加密Key"></a>3.2.5 使用多个加密Key</h4><p>也许，我们需要对不同的敏感信息使用不同的加密key，这时候我们的配置文件只需要按如下进行编写:</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="xml">foo.bar=</span><span class="template-variable">&#123;cipher&#125;</span><span class="template-variable">&#123;key:testkey&#125;</span><span class="xml">...</span></span></pre></td></tr></table></figure>

<p>Config-Server在解密的时候就会尝试从配置文件中获取<code>testkey</code>的做为密钥。</p>
<h2 id="4-高可用配置"><a href="#4-高可用配置" class="headerlink" title="4. 高可用配置"></a>4. 高可用配置</h2><h3 id="4-1-整合Eureka"><a href="#4-1-整合Eureka" class="headerlink" title="4.1 整合Eureka"></a>4.1 整合Eureka</h3><p>看到这里，可能有些童鞋已经发现，我们在Config-Client中配置<code>config.uri</code>时使用的具体的地址，那么是否可以使用之前的Eureka呢？答案是肯定，我们可以把Config-Server和其它微服务一样作为一个服务基本单元。我们只需要进行如下修改即可。</p>
<h4 id="4-1-1-Config-Server改造"><a href="#4-1-1-Config-Server改造" class="headerlink" title="4.1.1 Config-Server改造"></a>4.1.1 Config-Server改造</h4><p>在pom.xml中增加如下依赖:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr></table></figure>

<p>在配置文件中配置我们服务的名称，及之前我们所编写Eureka服务器的地址:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=config-server</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka.client.service-url.defaultZone</span>=http://localhost:<span class="number">8260</span>/eureka</span></pre></td></tr></table></figure>

<p>启动类:</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * TwoStepsFromJava Cloud -- Config Server</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> *</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * @author CD826(CD826Dong@gmail.com)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * @since 1.0.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@SpringBootApplication</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@EnableConfigServer</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@EnableDiscoveryClient</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">public class Application &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">static</span> <span class="selector-tag">void</span> <span class="selector-tag">main</span>(String[] args) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        <span class="selector-tag">SpringApplication</span><span class="selector-class">.run</span>(Application.class, args);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>增加<code>@EnableDiscoveryClient</code>注解。<br>Ok，到这里为止，Config-Server修改已经完成。如果我们启动Config-Server就会在Eureka服务器上看到相应的服务注册。</p>
<h4 id="4-1-2-Config-Client改造"><a href="#4-1-2-Config-Client改造" class="headerlink" title="4.1.2 Config-Client改造"></a>4.1.2 Config-Client改造</h4><p>在pom.xml中增加如下依赖:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr></table></figure>

<p>配置文件修改，注意这里的配置文件为:<code>bootstrap.properties</code>:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.application</span>.name=mallWeb</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span>.profile=dev</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">eureka<span class="selector-class">.client</span><span class="selector-class">.service-url</span>.defaultZone=http:<span class="comment">//localhost:8260/eureka</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.discovery</span>.enabled=true</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.discovery</span>.service-id=config-server</span></pre></td></tr></table></figure>

<p>修改启动类:</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * TwoStepsFromJava Cloud -- Config Client Project</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> *</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * @author CD826(CD826Dong@gmail.com)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * @since 1.0.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@EnableDiscoveryClient</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@SpringBootApplication</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">public class Application &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">static</span> <span class="selector-tag">void</span> <span class="selector-tag">main</span>(String[] args) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        <span class="selector-tag">SpringApplication</span><span class="selector-class">.run</span>(Application.class, args);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>这样就完成了从Eureka中获取Config-Server的服务信息。<br>这里最重要的就是在配置中增加: <code>spring.cloud.config.discovery.enabled=true</code>，并将原来所配置的<code>spring.cloud.config.uri</code>，修改为<code>spring.cloud.config.discovery.service-id</code>。</p>
<h3 id="4-2-快速失败与响应"><a href="#4-2-快速失败与响应" class="headerlink" title="4.2 快速失败与响应"></a>4.2 快速失败与响应</h3><h4 id="4-2-1-开启Config-Server启动加载"><a href="#4-2-1-开启Config-Server启动加载" class="headerlink" title="4.2.1 开启Config-Server启动加载"></a>4.2.1 开启Config-Server启动加载</h4><p>默认情况下，只有当客户端请求时服务端才会从配置的Git仓库中进行加载，我们可以通过设置<code>clone-on-start</code>，让服务端在启动时就会加载。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.server.git.uri</span>=https://git/common/config-repo.git</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.server.git.repos.team-a.pattern</span>=team-a-*</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.server.git.repos.team-a.clone-on-start</span>=<span class="literal">true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.server.git.repos.team-a.uri</span>=http://git/team-a/config-repo.git</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.server.git.repos.team-b.pattern</span>=team-b-*</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.server.git.repos.team-b.clone-on-start</span>=<span class="literal">false</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.server.git.repos.team-b.uri</span>=http://git/team-b/config-repo.git</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.server.git.repos.team-c.pattern</span>=team-c-*</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.server.git.repos.team-c.uri</span>=http://git/team-a/config-repo.git</span></pre></td></tr></table></figure>

<p>上面的配置，对于<code>team-a</code>的则在<strong>Config-Server</strong>启动时就会加载相应的配置，而对于其它则不会。当然，我们可以通过设置<code>spring.cloud.config.server.git.clone-on-start</code>的值来进行全局配置。</p>
<h4 id="4-2-2-开启Config-Client快速失败"><a href="#4-2-2-开启Config-Client快速失败" class="headerlink" title="4.2.2 开启Config-Client快速失败"></a>4.2.2 开启Config-Client快速失败</h4><p>在一些情况下，我们希望启动一个服务时无法连接到服务端能够快速返回失败，那么可以通过下面的配置来设置:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.fail-fast</span>=<span class="literal">true</span></span></pre></td></tr></table></figure>

<h4 id="4-2-3-设置Config-Client重试"><a href="#4-2-3-设置Config-Client重试" class="headerlink" title="4.2.3 设置Config-Client重试"></a>4.2.3 设置Config-Client重试</h4><p>如果在启动时Config-Server碰巧不可以使用，你还想后面再进行重试，那么我们开始开启Config-Client的重试机制。首先，我们需要配置：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.config.fail-fast</span>=<span class="literal">true</span></span></pre></td></tr></table></figure>

<p>然后，我们需要在我们的的依赖中增加：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.retry<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-retry<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr></table></figure>

<p>这样，我们就可以为Config-Client开启了重试机制，当启动连接Config-Server失败时，Config-Client会继续尝试连接Config-Server，默认会尝试连接6次，时间间隔初始为1000毫秒，后面每次尝试连接会按照1.1倍数增加尝试连接时间的间隔，如果最后还不能够连接到Config-Server才会返回错误。我们可以通过在配置文件中复写<code>spring.cloud.config.retry.*</code>来进行相关配置。</p>
<blockquote>
<p>如果你想全权控制重试机制，可以实现一个类型为:<code>RetryOperationsInterceptor</code>的类，并把bean的id设置为:<code>configServerRetryInterceptor</code>。</p>
</blockquote>
<h3 id="4-3-动态刷新配置"><a href="#4-3-动态刷新配置" class="headerlink" title="4.3 动态刷新配置"></a>4.3 动态刷新配置</h3><p>Config-Client中提供了一个<code>refresh</code>端点来实现配置文件的刷新。要想使用该功能，我们需要在Config-Client的pom.xml文件中增加以下依赖:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr></table></figure>

<p>这样，当修改配置文件并提交到Git仓库后，就可以使用:<a href="http://localhost:8080/refresh刷新本地的配置数据。" target="_blank" rel="noopener">http://localhost:8080/refresh刷新本地的配置数据。</a></p>
<blockquote>
<p>但是，最好的方式还是和Spring Cloud Bus进行整合，这样才能实现配置的自动分发，而不是需要手工去刷新配置。</p>
</blockquote>
<blockquote>
<p>作者：CD826</p>
<p>来源：<a href="https://www.jianshu.com/p/997600098e6c" target="_blank" rel="noopener">https://www.jianshu.com/p/997600098e6c</a></p>
</blockquote>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/10/Spring-Cloud%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%EF%BC%887%EF%BC%89%EF%BC%9A%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%EF%BC%88Sleuth%EF%BC%89/" rel="prev" title="Spring Cloud入门教程（7）：分布式链路跟踪（Sleuth）">
      <i class="fa fa-chevron-left"></i> Spring Cloud入门教程（7）：分布式链路跟踪（Sleuth）
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/01/10/Spring-Cloud%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%EF%BC%889%EF%BC%89%EF%BC%9A%E5%9F%BA%E4%BA%8E%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/" rel="next" title="Spring Cloud入门教程（9）：基于消息驱动开发">
      Spring Cloud入门教程（9）：基于消息驱动开发 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-示例代码"><span class="nav-number">1.</span> <span class="nav-text">1. 示例代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-构建Config-Server"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 构建Config-Server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-构建config-client"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 构建config-client</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-启动测试"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 启动测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-Spring项目配置加载顺序"><span class="nav-number">1.4.</span> <span class="nav-text">1.4 Spring项目配置加载顺序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-配置规则详解"><span class="nav-number">2.</span> <span class="nav-text">2. 配置规则详解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-Git仓库配置"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 Git仓库配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-使用占位符"><span class="nav-number">2.1.1.</span> <span class="nav-text">2.1.1 使用占位符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-使用模式匹配"><span class="nav-number">2.1.2.</span> <span class="nav-text">2.1.2 使用模式匹配</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-3-搜索目录"><span class="nav-number">2.1.3.</span> <span class="nav-text">2.1.3 搜索目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-4-SSH配置"><span class="nav-number">2.1.4.</span> <span class="nav-text">2.1.4 SSH配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-4-代理"><span class="nav-number">2.1.5.</span> <span class="nav-text">2.1.4 代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-5-本地缓存"><span class="nav-number">2.1.6.</span> <span class="nav-text">2.1.5 本地缓存</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-SVN配置"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 SVN配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-修改pom-xml"><span class="nav-number">2.2.1.</span> <span class="nav-text">2.2.1 修改pom.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-修改appliaction-properties"><span class="nav-number">2.2.2.</span> <span class="nav-text">2.2.2 修改appliaction.properties</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-文件系统"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 文件系统</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-安全保护"><span class="nav-number">3.</span> <span class="nav-text">3. 安全保护</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-Config-Server访问安全"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 Config-Server访问安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-加密与解密"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 加密与解密</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-安装JCE-Java-Cryptography-Extension"><span class="nav-number">3.2.1.</span> <span class="nav-text">3.2.1 安装JCE(Java Cryptography Extension)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-加解密端点"><span class="nav-number">3.2.2.</span> <span class="nav-text">3.2.2 加解密端点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-对称加密"><span class="nav-number">3.2.3.</span> <span class="nav-text">3.2.3 对称加密</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-非对称加密"><span class="nav-number">3.2.4.</span> <span class="nav-text">3.2.4 非对称加密</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-5-使用多个加密Key"><span class="nav-number">3.2.5.</span> <span class="nav-text">3.2.5 使用多个加密Key</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-高可用配置"><span class="nav-number">4.</span> <span class="nav-text">4. 高可用配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-整合Eureka"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 整合Eureka</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-Config-Server改造"><span class="nav-number">4.1.1.</span> <span class="nav-text">4.1.1 Config-Server改造</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-Config-Client改造"><span class="nav-number">4.1.2.</span> <span class="nav-text">4.1.2 Config-Client改造</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-快速失败与响应"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 快速失败与响应</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-开启Config-Server启动加载"><span class="nav-number">4.2.1.</span> <span class="nav-text">4.2.1 开启Config-Server启动加载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-开启Config-Client快速失败"><span class="nav-number">4.2.2.</span> <span class="nav-text">4.2.2 开启Config-Client快速失败</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-设置Config-Client重试"><span class="nav-number">4.2.3.</span> <span class="nav-text">4.2.3 设置Config-Client重试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-动态刷新配置"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 动态刷新配置</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">congsheng.wang</p>
  <div class="site-description" itemprop="description">trouble is a friend</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">984</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">94</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">156</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">congsheng.wang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.6.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
