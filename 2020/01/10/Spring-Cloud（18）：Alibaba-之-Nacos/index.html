<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://congsheng.wang').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="上个月最后一天的凌晨，Spring Cloud Alibaba 正式入驻了 Spring Cloud 官方孵化器，并在 maven 中央库发布了第一个版本。目前 Spring Cloud Alibaba 还只能算是预览版吧，里边的坑肯定不少，不过我还是决定试试，看看 Alibaba 到底靠谱不靠谱。 Nacos for Spring Cloud">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Cloud（18）：Alibaba 之 Nacos">
<meta property="og:url" content="http:&#x2F;&#x2F;congsheng.wang&#x2F;2020&#x2F;01&#x2F;10&#x2F;Spring-Cloud%EF%BC%8818%EF%BC%89%EF%BC%9AAlibaba-%E4%B9%8B-Nacos&#x2F;index.html">
<meta property="og:site_name" content="个人博客">
<meta property="og:description" content="上个月最后一天的凌晨，Spring Cloud Alibaba 正式入驻了 Spring Cloud 官方孵化器，并在 maven 中央库发布了第一个版本。目前 Spring Cloud Alibaba 还只能算是预览版吧，里边的坑肯定不少，不过我还是决定试试，看看 Alibaba 到底靠谱不靠谱。 Nacos for Spring Cloud">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;5f7c3-nacos-for-spring-cloud.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;73691-nacos-Arch.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;9aef5-nacos-console.png">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;e8426-nacos-console-config-demo.gif">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;d21da-nacos-config-history.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;79acf-nacos-config-listener-query.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;471b8-nacos-service-list.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;5a975-nacos-service-detail.jpg">
<meta property="og:updated_time" content="2020-01-10T14:11:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;5f7c3-nacos-for-spring-cloud.jpg">

<link rel="canonical" href="http://congsheng.wang/2020/01/10/Spring-Cloud%EF%BC%8818%EF%BC%89%EF%BC%9AAlibaba-%E4%B9%8B-Nacos/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>Spring Cloud（18）：Alibaba 之 Nacos | 个人博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">congsheng的博客</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">156</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">94</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">984</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2020/01/10/Spring-Cloud%EF%BC%8818%EF%BC%89%EF%BC%9AAlibaba-%E4%B9%8B-Nacos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="congsheng.wang">
      <meta itemprop="description" content="trouble is a friend">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring Cloud（18）：Alibaba 之 Nacos
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-10 22:11:56" itemprop="dateCreated datePublished" datetime="2020-01-10T22:11:56+08:00">2020-01-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">Spring技术</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring%E6%8A%80%E6%9C%AF/Spring-Cloud/" itemprop="url" rel="index">
                    <span itemprop="name">Spring Cloud</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>上个月最后一天的凌晨，Spring Cloud Alibaba 正式入驻了 Spring Cloud 官方孵化器，并在 maven 中央库发布了第一个版本。<br>目前 Spring Cloud Alibaba 还只能算是预览版吧，里边的坑肯定不少，不过我还是决定试试，看看 Alibaba 到底靠谱不靠谱。<br><a href="http://image.winrains.cn/2019/11/5f7c3-nacos-for-spring-cloud.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/5f7c3-nacos-for-spring-cloud.jpg" alt="Nacos for Spring Cloud"></a></p>
<p><a href="http://image.winrains.cn/2019/11/5f7c3-nacos-for-spring-cloud.jpg" target="_blank" rel="noopener">Nacos for Spring Cloud</a></p>
<a id="more"></a>

<h1 id="Spring-Cloud-Alibaba"><a href="#Spring-Cloud-Alibaba" class="headerlink" title="Spring Cloud Alibaba"></a>Spring Cloud Alibaba</h1><p>目前 Spring Cloud Alibaba 项目还处于 <a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener">Spring Cloud 官方孵化器</a>中，打开它 Github 的就能看到 “亲切” 的<a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba/blob/master/README-zh.md" target="_blank" rel="noopener">中文文档</a>。<br>它目前只有三个组件：</p>
<ul>
<li>Sentinel：把流量作为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性。</li>
<li>Nacos：一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</li>
<li>AliCloud OSS: 阿里云对象存储服务（Object Storage Service，简称 OSS），是阿里云提供的海量、安全、低成本、高可靠的云存储服务。您可以在任何应用、任何时间、任何地点存储和访问任意类型的数据。</li>
</ul>
<p>看官方路线图上讲后边还会增加</p>
<ul>
<li>Dubbo：Apache Dubbo™ (incubating) 是一款高性能 Java RPC 框架。</li>
<li>RocketMQ：Apache RocketMQ™ 基于 Java 的高性能、高吞吐量的分布式消息和流计算平台。</li>
<li>Schedulerx：阿里中间件团队开发的一款分布式任务调度产品，支持周期性的任务与固定时间点触发任务。</li>
<li>AliCloud SLS：针对日志类数据的一站式服务，在阿里巴巴集团经历大量大数据场景锤炼而成。您无需开发就能快捷完成日志数据采集、消费、投递以及查询分析等功能，提升运维、运营效率，建立 DT 时代海量日志处理能力。</li>
</ul>
<p>从数量上来看，Alibaba 的组件数量和目前 Netflix 的相比少了一多半，但是仔细看看各组件的功能描述，也就明白了。在没真正上手之前，我个人先大胆猜测一下：</p>
<ul>
<li>Nacos = Eureka/Consule + Config + Admin</li>
<li>Sentinel = Hystrix + Dashboard + Turbine</li>
<li>Dubbo = Ribbon + Feign</li>
<li>RocketMQ = RabbitMQ</li>
<li>Schedulerx = Quartz</li>
<li>AliCloud OSS、AliCloud SLS 这三个应该是独有的</li>
<li>链路跟踪（Sleuth、Zipkin）不知道会不会在 Sentinel 里</li>
</ul>
<p>以上只是猜测，待我从坑里爬出来之后再回来更新。也欢迎大家一起交流探讨～<br>这里我就先试试 Nacos。</p>
<h1 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h1><p><a href="http://image.winrains.cn/2019/11/73691-nacos-Arch.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/73691-nacos-Arch.jpg" alt="nacos arch"></a></p>
<p><a href="http://image.winrains.cn/2019/11/73691-nacos-Arch.jpg" target="_blank" rel="noopener">nacos arch</a></p>
<p>这是 Nacos 的架构图，可以看到它确实是融合了服务注册发现中心、配置中心、服务管理等功能，和我之前猜想的它是 Eureka/Consule + Config + Admin 的合体差不多。<br>另外通过官方文档发现，Nacos 除了可以和 Spring Cloud 集成，还可以和 Spring、SpringBoot 进行集成。<br>不过我们只关注于 Spring Cloud，别的就略过了，直接上手吧～<br>工程的目录结构如下：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">alibaba</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">├── nacos-config</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">│   ├── pom.xml</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">│   └── src</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">├── nacos-consumer</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">│   ├── pom.xml</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">│   └── src</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">├── nacos-provider</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">│   ├── pom.xml</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">│   └── src</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">└── pom.xml</span></pre></td></tr></table></figure>

<p>首先引入 Spring Cloud Alibaba 的 BOM</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Finchley.SR2<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">spring-cloud-alibaba.version</span>&gt;</span>0.2.0.RELEASE<span class="tag">&lt;/<span class="name">spring-cloud-alibaba.version</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring-cloud-alibaba.version&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring-cloud.version&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span></span></pre></td></tr></table></figure>

<p>这里版本号有坑，文档上说和 Spring Boot 2.0.x 版本兼容，但是实测 2.0.6.RELEASE 报错</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">java.lang.<span class="string">NoClassDefFoundError:</span> org<span class="regexp">/springframework/</span>core<span class="regexp">/env/</span>EnvironmentCapable</span></pre></td></tr></table></figure>

<h2 id="Nacos-Server"><a href="#Nacos-Server" class="headerlink" title="Nacos Server"></a>Nacos Server</h2><p><strong>在使用 Nacos 之前，需要先下载 Nacos 并启动 Nacos Server。</strong><br>Nacos Server 有两种运行模式：</p>
<ul>
<li>standalone</li>
<li>cluster</li>
</ul>
<p>不论哪种方式吧，都需要先去 <a href="https://github.com/alibaba/nacos/releases" target="_blank" rel="noopener">https://github.com/alibaba/nacos/releases</a> 下载最新的 release 包，然后解压，以 nacos-server-0.4.0.zip 为例</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">unzip</span> <span class="selector-tag">nacos-server-0</span><span class="selector-class">.4</span><span class="selector-class">.0</span><span class="selector-class">.zip</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">cd</span> <span class="selector-tag">nacos</span></span></pre></td></tr></table></figure>

<h3 id="standalone-模式"><a href="#standalone-模式" class="headerlink" title="standalone 模式"></a>standalone 模式</h3><p>此模式一般用于 demo 和测试，不用改任何配置，直接敲以下命令执行</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">sh </span><span class="keyword">bin/startup.sh </span>-m standalone</span></pre></td></tr></table></figure>

<p>Windows 的话就是</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmd</span><span class="bash"> bin/startup.cmd -m standalone</span></span></pre></td></tr></table></figure>

<p>然后从 <a href="http://localhost:8848/nacos/index.html" target="_blank" rel="noopener">http://localhost:8848/nacos/index.html</a> 进入控制台就能看到如下界面了<br><a href="http://image.winrains.cn/2019/11/9aef5-nacos-console.png" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/9aef5-nacos-console.png" alt="Nacos Console"></a></p>
<p><a href="http://image.winrains.cn/2019/11/9aef5-nacos-console.png" target="_blank" rel="noopener">Nacos Console</a></p>
<h3 id="cluster-模式"><a href="#cluster-模式" class="headerlink" title="cluster 模式"></a>cluster 模式</h3><p>集群模式需要依赖 MySQL，然后改两个配置文件：</p>
<ul>
<li>conf/cluster.conf</li>
<li>conf/application.properties</li>
</ul>
<p>具体怎么改，在这里就先不展开了。我们先用 standalone 模式撸起来，享受 coding 的快感，然后再慢慢转到 cluster 上边。</p>
<h2 id="配置管理"><a href="#配置管理" class="headerlink" title="配置管理"></a>配置管理</h2><p>1.在 nacos/pom.xml 里添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span></pre></td></tr></table></figure>

<p>2.启动类不用修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NacosApplication</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        SpringApplication.run(NacosApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>3.修改 bootstrap.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">application:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">name:</span> <span class="string">nacos</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">cloud:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">nacos:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">      <span class="attr">config:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span></pre></td></tr></table></figure>

<p>注意：必须是写在 bootstrap.yml 中，配置在 application.yml 中不行，启动报错</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">java<span class="built_in">.lang</span>.IllegalArgumentException: Could<span class="built_in"> not</span> resolve placeholder <span class="string">'spring.application.name'</span> <span class="keyword">in</span> <span class="keyword">value</span> <span class="string">"$&#123;spring.application.name&#125;"</span></span></pre></td></tr></table></figure>

<p>至于 bootstrap.yml 和 application.yml 的区别，之前讲过这里就不赘述了。<br>4.添加一个 Endpoint 便于观察</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@RestController</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@RequestMapping</span>(<span class="string">"/config"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@RefreshScope</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">public class ConfigController &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="variable">@Value</span>(<span class="string">"$&#123;useLocalCache:false&#125;"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    private boolean useLocalCache;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="variable">@RequestMapping</span>(<span class="string">"/get"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    public boolean get() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">useLocalCache</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>注意一定要加 <code>@RefreshScope</code> 注解<br>5.小心！此处有坑！<br><strong>这时候先别急着启动 NacosConfigApplication 的，需要需要通过调用 <a href="https://nacos.io/zh-cn/docs/open-API.html" target="_blank" rel="noopener">Nacos Open API</a> 往 Nacos Server 里发布一个配置。</strong>dataId 为 <code>nacos.properties</code>，内容为 <code>useLocalCache=true</code></p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">curl -X <span class="string">"POST"</span> <span class="string">"http://127.0.0.1:8848/nacos/v1/cs/configs"</span> <span class="string">\</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">     -H <span class="string">'Content-Type: application/x-www-form-urlencoded; charset=utf-8'</span> <span class="string">\</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">     --data-urlencode <span class="string">"dataId=nacos.properties"</span> <span class="string">\</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">     --data-urlencode <span class="string">"group=DEFAULT_GROUP"</span> <span class="string">\</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">     --data-urlencode <span class="string">"content=useLocalCache=true"</span></span></pre></td></tr></table></figure>

<p>这里涉及一个 dataId 的概念</p>
<blockquote>
<p><code>dataId</code> 的完整格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="variable">$&#123;prefix&#125;</span>-<span class="variable">$&#123;spring.profile.active&#125;</span>.<span class="variable">$&#123;file-extension&#125;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span></span></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ul>
<li><code>prefix</code> 默认为 <code>spring.application.name</code> 的值，也可以通过配置项 <code>spring.cloud.nacos.config.prefix</code> 来配置。</li>
<li><code>spring.profile.active</code> 即为当前环境对应的 profile，详情可以参考 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html#boot-features-profiles" target="_blank" rel="noopener">Spring Boot 文档</a>。 <strong>注意：当 \</strong><code>spring.profile.active</code> ** 为空时，对应的连接符**  <strong>-</strong>  <strong>也将不存在，dataId 的拼接格式变成</strong> <code>${prefix}</code>.<code>${file-extension}</code></li>
<li><code>file-exetension</code> 为配置内容的数据格式，可以通过配置项 <code>spring.cloud.nacos.config.file-extension</code> 来配置。目前只支持 <code>properties</code> 和 <code>yaml</code> 类型。</li>
</ul>
</blockquote>
<p>6.然后启动 NacosConfigApplication，从启动日志里能看到</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">Located property source: CompositePropertySource &#123;<span class="attribute">name</span>=<span class="string">'NACOS'</span>, propertySources=[NacosPropertySource &#123;<span class="attribute">name</span>=<span class="string">'nacos.properties'</span>&#125;]&#125;</span></pre></td></tr></table></figure>

<p>如果 <code>propertySources</code> 里边是空的，那抱歉，你掉到坑里边了。 如果你能看到之前发布的 dataId，那恭喜，请求 <a href="http://localhost:8080/config/get" target="_blank" rel="noopener">http://localhost:8080/config/get</a> 就可以看到返回内容 <code>true</code> 了。<br>7.再次调用 Nacos Open API 修改内容为 <code>useLocalCache=false</code><br>8.再次访问 <a href="http://localhost:8080/config/get" target="_blank" rel="noopener">http://localhost:8080/config/get</a> ，此时返回内容为 <code>false</code>，说明程序中的 <code>useLocalCache</code> 值已经被动态更新了。<br>当然，以上手动调用 Nacos Open API 的方式也可以通过 Nacos Console 的可视化界面来操作<br><a href="http://image.winrains.cn/2019/11/e8426-nacos-console-config-demo.gif" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/e8426-nacos-console-config-demo.gif" alt="Nacos Console Config"></a></p>
<p><a href="http://image.winrains.cn/2019/11/e8426-nacos-console-config-demo.gif" target="_blank" rel="noopener">Nacos Console Config</a></p>
<p>另外我们可以查询配置的历史记录并能快速回滚<br><a href="http://image.winrains.cn/2019/11/d21da-nacos-config-history.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/d21da-nacos-config-history.jpg" alt="Nacos Config History"></a></p>
<p><a href="http://image.winrains.cn/2019/11/d21da-nacos-config-history.jpg" target="_blank" rel="noopener">Nacos Config History</a></p>
<p>还能查询到某个配置当前的被监听状态（这里的分页有些 bug）<br><a href="http://image.winrains.cn/2019/11/79acf-nacos-config-listener-query.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/79acf-nacos-config-listener-query.jpg" alt="Nacos 监听查询"></a></p>
<p><a href="http://image.winrains.cn/2019/11/79acf-nacos-config-listener-query.jpg" target="_blank" rel="noopener">Nacos 监听查询</a></p>
<h3 id="数据源"><a href="#数据源" class="headerlink" title="数据源"></a>数据源</h3><p>经过了上边的一些简单操作，我们已经可以正常使用 Nacos 配置中心了。<br>但是不知道你有没有想过：配置数据是存在哪里呢？<br>我们没有对 Nacos Server 做任何配置，那么数据只有两个位置可以存储：</p>
<ul>
<li>内存</li>
<li>本地数据库</li>
</ul>
<p>如果我们现在重启刚刚在运行的 Nacos Server，会发现刚才加的 nacos.properties 配置还在，说明不是内存存储的。<br>这时候我们打开 <code>NACOS_PATH/data</code>，会发现里边有个 <code>derby-data</code> 目录，<a href="https://db.apache.org/derby/" target="_blank" rel="noopener">Derby</a> 是 Java 编写的数据库，属于 Apache 的一个开源项目。我们的配置数据现在就存储在这个库中。<br>Derby 我并不是很熟悉，那能不能将数据源改为我们熟悉的 MySQL 呢？当然可以了。</p>
<blockquote>
<p>注意：不支持 MySQL 8.0 版本</p>
</blockquote>
<p>这里我以本地运行的 MySQL 为例：<br>1.创建一个名为 <code>nacos_config</code> 的 database<br>2.将 <code>NACOS_PATH/conf/nacos-mysql.sql</code> 中的表结构导入刚才创建的库中，这几张表的用途就自己研究吧<br>3.修改 <code>NACOS_PATH/conf/application.properties</code>，加入 MySQL 配置</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">db.num</span>=<span class="number">1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attr">db.url.0</span>=jdbc:mysql://localhost:<span class="number">3306</span>/nacos_config?characterEncoding=utf8&amp;connectTimeout=<span class="number">1000</span>&amp;socketTimeout=<span class="number">3000</span>&amp;autoReconnect=<span class="literal">true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="attr">db.user</span>=root</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="attr">db.password</span>=root</span></pre></td></tr></table></figure>

<p>4.创建 <code>cluster.conf</code>，填入要运行 Nacos Server 机器的 ip</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="number">192.168.100.155</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="number">192.168.100.156</span></span></pre></td></tr></table></figure>

<p>我就是运行个 demo，没有多余机器来组建集群怎么办呢？<br>其实不用虚拟机，直接只填一个本地地址也是可以的<strong>（仅限于配置管理，服务发现不行）</strong>。<br><strong>这里有两个坑：</strong></p>
<ul>
<li>Nacos Server 的数据源是用 Derby 还是 MySQL 完全是由其运行模式决定的：<ul>
<li>standalone 的话仅会使用 Derby，即使在 application.properties 里边配置 MySQL 也照样无视；</li>
<li>cluster 模式会自动使用 MySQL，这时候如果没有 MySQL 的配置，是会报错的。</li>
</ul>
</li>
<li>官方提供的 cluster.conf 示例如下</li>
</ul>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">#it is ip</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">#example</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="number">10.10.109.214</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="number">11.16.128.34</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="number">11.16.128.36</span></span></pre></td></tr></table></figure>

<p>从习惯来看，这个<code>#</code>号后边的应该就是注释的，但是抱歉哦，必须删掉，否则下面的异常就扑面而来</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Caused</span> <span class="selector-tag">by</span>: <span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.NumberFormatException</span>: <span class="selector-tag">For</span> <span class="selector-tag">input</span> <span class="selector-tag">string</span>: "<span class="selector-tag">it</span> <span class="selector-tag">is</span> <span class="selector-tag">ip</span><span class="selector-pseudo">:0"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="selector-tag">at</span> <span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.NumberFormatException</span><span class="selector-class">.forInputString</span>(<span class="selector-tag">NumberFormatException</span><span class="selector-class">.java</span><span class="selector-pseudo">:65)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  <span class="selector-tag">at</span> <span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.Long</span><span class="selector-class">.parseLong</span>(<span class="selector-tag">Long</span><span class="selector-class">.java</span><span class="selector-pseudo">:589)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  <span class="selector-tag">at</span> <span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.Long</span><span class="selector-class">.parseLong</span>(<span class="selector-tag">Long</span><span class="selector-class">.java</span><span class="selector-pseudo">:631)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  <span class="selector-tag">at</span> <span class="selector-tag">com</span><span class="selector-class">.alibaba</span><span class="selector-class">.nacos</span><span class="selector-class">.naming</span><span class="selector-class">.core</span><span class="selector-class">.DistroMapper</span><span class="selector-class">.onServerStatusUpdate</span>(<span class="selector-tag">DistroMapper</span><span class="selector-class">.java</span><span class="selector-pseudo">:125)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  <span class="selector-tag">at</span> <span class="selector-tag">com</span><span class="selector-class">.alibaba</span><span class="selector-class">.nacos</span><span class="selector-class">.naming</span><span class="selector-class">.core</span><span class="selector-class">.DistroMapper</span><span class="selector-class">.init</span>(<span class="selector-tag">DistroMapper</span><span class="selector-class">.java</span><span class="selector-pseudo">:100)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  <span class="selector-tag">at</span> <span class="selector-tag">com</span><span class="selector-class">.alibaba</span><span class="selector-class">.nacos</span><span class="selector-class">.naming</span><span class="selector-class">.core</span><span class="selector-class">.DistroMapper</span>.&lt;<span class="selector-tag">clinit</span>&gt;(<span class="selector-tag">DistroMapper</span><span class="selector-class">.java</span><span class="selector-pseudo">:65)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  ... 79 <span class="selector-tag">common</span> <span class="selector-tag">frames</span> <span class="selector-tag">omitted</span></span></pre></td></tr></table></figure>

<p>以上配置结束后，运行 Nacos Server 就能看到效果了。<br>除了 MySQL 的数据表发生了变化，我们会发现 <code>NACOS_PATH/data</code> 下的目录结构也发生了变化，多了 <code>config-data/DEFAULT_GROUP/nacos_config</code> 这么一个文件，里边的内容就是我们的配置</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">useLocalCache</span>=<span class="literal">true</span></span></pre></td></tr></table></figure>

<p>这是容错呢？还是缓存呢？只有等看过源码才知道了。</p>
<h2 id="服务发现"><a href="#服务发现" class="headerlink" title="服务发现"></a>服务发现</h2><p>服务注册中心和服务发现的服务端都是由 Nacos Server 来提供的，我们只需要提供 Service 向其注册就好了。<br>首先我们先将 Nacos Server 由伪分布式改为 standalone 模式，原因后边再说吧。<br>这里模拟提供两个 service：provider 和 consumer</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">alibaba</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">├── nacos-provider</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">│   ├── pom.xml</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">│   └── src</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">└── nacos-consumer</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">│   ├── pom.xml</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">│   └── src</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">└── pom.xml</span></pre></td></tr></table></figure>

<p>1.首先在 provider 和 consumer 的 pom 添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr></table></figure>

<p>2.在两者的 bootstrap.yml 中添加配置<br>provider</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">application:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">name:</span> <span class="string">nacos-provider</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">cloud:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">nacos:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">      <span class="attr">discovery:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">port:</span> <span class="number">18080</span></span></pre></td></tr></table></figure>

<p>consumer</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">application:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">name:</span> <span class="string">nacos-consumer</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">cloud:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">nacos:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">      <span class="attr">discovery:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">port:</span> <span class="number">18081</span></span></pre></td></tr></table></figure>

<p>3.使用 Spring Cloud 的原生注解 <code>@EnableDiscoveryClient</code> 开启服务发现</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@SpringBootApplication</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@EnableDiscoveryClient</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">public class NacosProviderApplication &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">static</span> <span class="selector-tag">void</span> <span class="selector-tag">main</span>(String[] args) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        <span class="selector-tag">SpringApplication</span><span class="selector-class">.run</span>(NacosProviderApplication.class, args);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>4.提供 Endpoint 以供访问</p>
<p>1.Provider</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(<span class="meta-string">"/echo"</span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoController</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="meta">@RequestMapping(value = <span class="meta-string">"/&#123;string&#125;"</span>, method = RequestMethod.GET)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> String echo(<span class="meta">@PathVariable</span> String string) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">return</span> <span class="string">"Hello Nacos Discovery "</span> + string;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>2.Consumer</p>
<p>在 NacosConsumerApplication 中集成 <code>RestTemplate</code> 和 <a href="https://cloud.spring.io/spring-cloud-netflix/multi/multi_spring-cloud-ribbon.html" target="_blank" rel="noopener">Ribbon</a></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@LoadBalanced</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@Bean</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">public RestTemplate restTemplate() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  <span class="selector-tag">return</span> <span class="selector-tag">new</span> <span class="selector-tag">RestTemplate</span>();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>提供 Controller</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(<span class="meta-string">"/echo"</span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Autowired</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> TestController(RestTemplate restTemplate) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">this</span>.restTemplate = restTemplate;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="meta">@RequestMapping(value = <span class="meta-string">"/&#123;str&#125;"</span>, method = RequestMethod.GET)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> String echo(<span class="meta">@PathVariable</span> String str) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(<span class="string">"http://nacos-provider/echo/"</span> + str, String<span class="class">.<span class="keyword">class</span>);</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>5.分别启动 <code>NacosProviderApplication</code> 和 <code>NacosConsumerApplication</code> ，调用 <a href="http://localhost:18080/echo/windmt" target="_blank" rel="noopener">http://localhost:18080/echo/windmt</a> 和 <a href="http://localhost:18081/echo/windmt" target="_blank" rel="noopener">http://localhost:18081/echo/windmt</a> ，返回内容均为 <code>Hello Nacos Discovery windmt</code>，说明服务发现成功了。<br>这时候查看 Nacos Console 也能看到已注册的服务列表及其详情<br><a href="http://image.winrains.cn/2019/11/471b8-nacos-service-list.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/471b8-nacos-service-list.jpg" alt="Nacos 服务列表"></a></p>
<p><a href="http://image.winrains.cn/2019/11/471b8-nacos-service-list.jpg" target="_blank" rel="noopener">Nacos 服务列表</a></p>
<p><a href="http://image.winrains.cn/2019/11/5a975-nacos-service-detail.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/5a975-nacos-service-detail.jpg" alt="Nacos 服务详情"></a></p>
<p><a href="http://image.winrains.cn/2019/11/5a975-nacos-service-detail.jpg" target="_blank" rel="noopener">Nacos 服务详情</a></p>
<p>现在来讲一下为什么前边要将 Nacos Server 由伪分布式再改为 standalone 模式。<br>单个节点的 Nacos Server 伪分布式在配置管理运行的好好的，但是到了服务发现，它就失效了。<br>通过 log 可以发现一些端倪，单节点的在选主的时候，无法正确选出 leader</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">==&gt; logs/naming-raft.log &lt;==</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span><span class="number">-11</span><span class="number">-13</span> <span class="number">16</span>:<span class="number">38</span>:<span class="number">56</span>,<span class="number">424</span> INFO leader timeout, start voting,leader: <span class="literal">null</span>, term: <span class="number">1</span></span></pre></td></tr></table></figure>

<p>从而导致 Client 无法正常注册</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">java<span class="selector-class">.lang</span><span class="selector-class">.IllegalStateException</span>: failed to req API:/nacos/v1/ns/instance after all servers([<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8848</span>]) tried</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    at com<span class="selector-class">.alibaba</span><span class="selector-class">.nacos</span><span class="selector-class">.client</span><span class="selector-class">.naming</span><span class="selector-class">.net</span><span class="selector-class">.NamingProxy</span>.reqAPI(NamingProxy<span class="selector-class">.java</span>:<span class="number">339</span>) ~[nacos-client-<span class="number">0.3</span>.<span class="number">0</span><span class="selector-class">.jar</span>:na]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    at com<span class="selector-class">.alibaba</span><span class="selector-class">.nacos</span><span class="selector-class">.client</span><span class="selector-class">.naming</span><span class="selector-class">.net</span><span class="selector-class">.NamingProxy</span>.reqAPI(NamingProxy<span class="selector-class">.java</span>:<span class="number">272</span>) ~[nacos-client-<span class="number">0.3</span>.<span class="number">0</span><span class="selector-class">.jar</span>:na]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    at com<span class="selector-class">.alibaba</span><span class="selector-class">.nacos</span><span class="selector-class">.client</span><span class="selector-class">.naming</span><span class="selector-class">.net</span><span class="selector-class">.NamingProxy</span>.registerService(NamingProxy<span class="selector-class">.java</span>:<span class="number">171</span>) ~[nacos-client-<span class="number">0.3</span>.<span class="number">0</span><span class="selector-class">.jar</span>:na]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    at com<span class="selector-class">.alibaba</span><span class="selector-class">.nacos</span><span class="selector-class">.client</span><span class="selector-class">.naming</span><span class="selector-class">.NacosNamingService</span>.registerInstance(NacosNamingService<span class="selector-class">.java</span>:<span class="number">161</span>) ~[nacos-client-<span class="number">0.3</span>.<span class="number">0</span><span class="selector-class">.jar</span>:na]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    ... ...</span></pre></td></tr></table></figure>

<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>当今年年初 Dubbo 进入 Apache 孵化器的时候，就有预感阿里要与 Spring Cloud 结缘。只是没想到这么快。<br>如今 Spring Cloud Alibaba 已经进入了 Spring Cloud 官方孵化器，相信等不了多久也就能正式发布了。虽然大家在生产环境必然还不会这么快速地接入，但是总归是多了一种选择。<br>而 Nacos 作为微服务核心的服务注册与发现中心，让大家在 Eureka 和 Consule 之外有了新的选择，开箱即用，上手简洁，暂时也没发现有太大的坑。但将配置中心融合也融合进来是好是坏，这个我先按下不表。<br>总而言之，Spring Cloud Alibaba 的入驻对于 Spring Cloud 生态总归是好的～<br>本文示例代码：<a href="https://github.com/zhaoyibo/spring-cloud-study/tree/master/alibaba" target="_blank" rel="noopener">https://github.com/zhaoyibo/spring-cloud-study/tree/master/alibaba</a></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener">GitHub - spring-cloud-incubator/spring-cloud-alibaba</a><br><a href="https://github.com/alibaba/Nacos" target="_blank" rel="noopener">GitHub - alibaba/nacos)</a><br><a href="https://nacos.io/en-us/docs/quick-start-spring-cloud.html" target="_blank" rel="noopener">Nacos Documentation</a></p>
<blockquote>
<p>作者：windmt</p>
<p>来源：<a href="https://windmt.com/2018/11/09/intro-to-spring-cloud-alibaba-nacos/" target="_blank" rel="noopener">https://windmt.com/2018/11/09/intro-to-spring-cloud-alibaba-nacos/</a></p>
</blockquote>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/10/Spring-Cloud%EF%BC%8817%EF%BC%89%EF%BC%9ASpring-Boot-Admin-2-0/" rel="prev" title="Spring Cloud（17）：Spring Boot Admin 2.0">
      <i class="fa fa-chevron-left"></i> Spring Cloud（17）：Spring Boot Admin 2.0
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/01/10/Spring-Cloud%EF%BC%8819%EF%BC%89%EF%BC%9ASpring-Cloud-Gateway%EF%BC%88%E8%AF%BB%E5%8F%96%E3%80%81%E4%BF%AE%E6%94%B9-Request-Body%EF%BC%89/" rel="next" title="Spring Cloud（19）：Spring Cloud Gateway（读取、修改 Request Body）">
      Spring Cloud（19）：Spring Cloud Gateway（读取、修改 Request Body） <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-Cloud-Alibaba"><span class="nav-number">1.</span> <span class="nav-text">Spring Cloud Alibaba</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Nacos"><span class="nav-number">2.</span> <span class="nav-text">Nacos</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Nacos-Server"><span class="nav-number">2.1.</span> <span class="nav-text">Nacos Server</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#standalone-模式"><span class="nav-number">2.1.1.</span> <span class="nav-text">standalone 模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-模式"><span class="nav-number">2.1.2.</span> <span class="nav-text">cluster 模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置管理"><span class="nav-number">2.2.</span> <span class="nav-text">配置管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据源"><span class="nav-number">2.2.1.</span> <span class="nav-text">数据源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#服务发现"><span class="nav-number">2.3.</span> <span class="nav-text">服务发现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#小结"><span class="nav-number">3.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考"><span class="nav-number">4.</span> <span class="nav-text">参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">congsheng.wang</p>
  <div class="site-description" itemprop="description">trouble is a friend</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">984</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">94</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">156</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">congsheng.wang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.6.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
