<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://congsheng.wang').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="ä¸Šé¢ä¸¤ç¯‡åšæ–‡æ‹‰å¼€äº†jpaä½¿ç”¨å§¿åŠ¿çš„é¢çº±ä¸€è§’ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å¾€ä¸‹æ‰¯ï¼Œæ•°æ®æ’å…¥dbä¹‹åï¼Œå¹¶ä¸æ˜¯è¯´å°±ä¸€å±‚ä¸å˜äº†ï¼Œå°±å¥½æ¯”æˆ‘åœ¨é“¶è¡Œå¼€äº†æˆ·ï¼Œå½“ç„¶æ˜¯å‡†å¤‡å¾€é‡Œé¢å­˜é’±äº†ï¼Œæœ‰å­˜å°±æœ‰å–ï¼ˆç‰¹åˆ«æ˜¯å½“ä¸‹é“¶è¡Œåˆ©ç‡è¿™ä¹ˆä½è¿˜ä¸å¦‚ä¹°æ¯”ç‰¹å¸å±¯ç€ï¼Œæˆªæ­¢19å¹´6æœˆ22æ—¥ï¼Œbtcå·²ç»çªç ´1.1w$ï¼Œå¯æƒœæ²¡é’±ä¹°ğŸ˜­ï¼‰è¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ä¸»é¢˜ï¼Œæ•°æ®æ›´æ–°â€“updateçš„ä½¿ç”¨å§¿åŠ¿é€šè¿‡æœ¬ç¯‡åšæ–‡ï¼Œæ‚¨è‡³å°‘å¯ä»¥é€‰åˆ°  save() ç›´æ¥æ ¹æ®idæ¥ä¿®æ”¹è®°å½• åˆ©ç”¨">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Boot é«˜çº§ç¯‡--JPAï¼ˆ3ï¼‰ï¼šupdateä½¿ç”¨å§¿åŠ¿">
<meta property="og:url" content="http:&#x2F;&#x2F;congsheng.wang&#x2F;2020&#x2F;01&#x2F;08&#x2F;Spring-Boot-%E9%AB%98%E7%BA%A7%E7%AF%87-JPA%EF%BC%883%EF%BC%89%EF%BC%9Aupdate%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF&#x2F;index.html">
<meta property="og:site_name" content="ä¸ªäººåšå®¢">
<meta property="og:description" content="ä¸Šé¢ä¸¤ç¯‡åšæ–‡æ‹‰å¼€äº†jpaä½¿ç”¨å§¿åŠ¿çš„é¢çº±ä¸€è§’ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å¾€ä¸‹æ‰¯ï¼Œæ•°æ®æ’å…¥dbä¹‹åï¼Œå¹¶ä¸æ˜¯è¯´å°±ä¸€å±‚ä¸å˜äº†ï¼Œå°±å¥½æ¯”æˆ‘åœ¨é“¶è¡Œå¼€äº†æˆ·ï¼Œå½“ç„¶æ˜¯å‡†å¤‡å¾€é‡Œé¢å­˜é’±äº†ï¼Œæœ‰å­˜å°±æœ‰å–ï¼ˆç‰¹åˆ«æ˜¯å½“ä¸‹é“¶è¡Œåˆ©ç‡è¿™ä¹ˆä½è¿˜ä¸å¦‚ä¹°æ¯”ç‰¹å¸å±¯ç€ï¼Œæˆªæ­¢19å¹´6æœˆ22æ—¥ï¼Œbtcå·²ç»çªç ´1.1w$ï¼Œå¯æƒœæ²¡é’±ä¹°ğŸ˜­ï¼‰è¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ä¸»é¢˜ï¼Œæ•°æ®æ›´æ–°â€“updateçš„ä½¿ç”¨å§¿åŠ¿é€šè¿‡æœ¬ç¯‡åšæ–‡ï¼Œæ‚¨è‡³å°‘å¯ä»¥é€‰åˆ°  save() ç›´æ¥æ ¹æ®idæ¥ä¿®æ”¹è®°å½• åˆ©ç”¨">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;c34e8-00.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;7917b-01.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;38a6e-02.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;3e923-03.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;e99c2-04.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;96d2c-05.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;9e7d7-06.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;8f0fc-07.jpg">
<meta property="og:updated_time" content="2020-01-08T09:20:14.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;image.winrains.cn&#x2F;2019&#x2F;11&#x2F;c34e8-00.jpg">

<link rel="canonical" href="http://congsheng.wang/2020/01/08/Spring-Boot-%E9%AB%98%E7%BA%A7%E7%AF%87-JPA%EF%BC%883%EF%BC%89%EF%BC%9Aupdate%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>Spring Boot é«˜çº§ç¯‡--JPAï¼ˆ3ï¼‰ï¼šupdateä½¿ç”¨å§¿åŠ¿ | ä¸ªäººåšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ä¸ªäººåšå®¢</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">congshengçš„åšå®¢</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>æ ‡ç­¾<span class="badge">156</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»<span class="badge">94</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£<span class="badge">984</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="æœç´¢..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2020/01/08/Spring-Boot-%E9%AB%98%E7%BA%A7%E7%AF%87-JPA%EF%BC%883%EF%BC%89%EF%BC%9Aupdate%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="congsheng.wang">
      <meta itemprop="description" content="trouble is a friend">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¸ªäººåšå®¢">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring Boot é«˜çº§ç¯‡--JPAï¼ˆ3ï¼‰ï¼šupdateä½¿ç”¨å§¿åŠ¿
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-01-08 17:20:14" itemprop="dateCreated datePublished" datetime="2020-01-08T17:20:14+08:00">2020-01-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">SpringæŠ€æœ¯</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring%E6%8A%80%E6%9C%AF/Spring-Boot/" itemprop="url" rel="index">
                    <span itemprop="name">Spring Boot</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring%E6%8A%80%E6%9C%AF/Spring-Data-JPA/" itemprop="url" rel="index">
                    <span itemprop="name">Spring Data JPA</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>ä¸Šé¢ä¸¤ç¯‡åšæ–‡æ‹‰å¼€äº†jpaä½¿ç”¨å§¿åŠ¿çš„é¢çº±ä¸€è§’ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å¾€ä¸‹æ‰¯ï¼Œæ•°æ®æ’å…¥dbä¹‹åï¼Œå¹¶ä¸æ˜¯è¯´å°±ä¸€å±‚ä¸å˜äº†ï¼Œå°±å¥½æ¯”æˆ‘åœ¨é“¶è¡Œå¼€äº†æˆ·ï¼Œå½“ç„¶æ˜¯å‡†å¤‡å¾€é‡Œé¢å­˜é’±äº†ï¼Œæœ‰å­˜å°±æœ‰å–ï¼ˆç‰¹åˆ«æ˜¯å½“ä¸‹é“¶è¡Œåˆ©ç‡è¿™ä¹ˆä½è¿˜ä¸å¦‚ä¹°æ¯”ç‰¹å¸å±¯ç€ï¼Œæˆªæ­¢19å¹´6æœˆ22æ—¥ï¼Œbtcå·²ç»çªç ´1.1w$ï¼Œå¯æƒœæ²¡é’±ä¹°ğŸ˜­ï¼‰è¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ä¸»é¢˜ï¼Œæ•°æ®æ›´æ–°â€“updateçš„ä½¿ç”¨å§¿åŠ¿<br>é€šè¿‡æœ¬ç¯‡åšæ–‡ï¼Œæ‚¨è‡³å°‘å¯ä»¥é€‰åˆ°</p>
<ul>
<li><code>save()</code> ç›´æ¥æ ¹æ®idæ¥ä¿®æ”¹è®°å½•</li>
<li>åˆ©ç”¨<code>jpl</code> å®ç°æŸ¥è¯¢ä¿®æ”¹çš„ä½¿ç”¨å§¿åŠ¿</li>
<li>åˆè¯†äº‹ç‰©çš„ç¥ç§˜é¢çº±</li>
</ul>
<a id="more"></a>

<h2 id="I-ç¯å¢ƒå‡†å¤‡"><a href="#I-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="I. ç¯å¢ƒå‡†å¤‡"></a>I. ç¯å¢ƒå‡†å¤‡</h2><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œå½“ç„¶å¾—å…ˆå‡†å¤‡å¥½åŸºç¡€ç¯å¢ƒï¼Œå¦‚å®‰è£…æµ‹è¯•ä½¿ç”¨mysqlï¼Œåˆ›å»ºSpringBooté¡¹ç›®å·¥ç¨‹ï¼Œè®¾ç½®å¥½é…ç½®ä¿¡æ¯ç­‰ï¼Œå…³äºæ­å»ºé¡¹ç›®çš„è¯¦æƒ…å¯ä»¥å‚è€ƒå‰ä¸€ç¯‡æ–‡ç« </p>
<ul>
<li><a href="http://spring.hhui.top/spring-blog/2019/06/12/190612-SpringBootç³»åˆ—æ•™ç¨‹JPAä¹‹åŸºç¡€ç¯å¢ƒæ­å»º/" target="_blank" rel="noopener">190612-SpringBootç³»åˆ—æ•™ç¨‹JPAä¹‹åŸºç¡€ç¯å¢ƒæ­å»º</a></li>
<li><a href="http://spring.hhui.top/spring-blog/2019/06/14/190614-SpringBootç³»åˆ—æ•™ç¨‹JPAä¹‹æ–°å¢è®°å½•ä½¿ç”¨å§¿åŠ¿/" target="_blank" rel="noopener">190614-SpringBootç³»åˆ—æ•™ç¨‹JPAä¹‹æ–°å¢è®°å½•ä½¿ç”¨å§¿åŠ¿</a></li>
</ul>
<p>ä¸‹é¢ç®€å•çš„çœ‹ä¸€ä¸‹æ¼”ç¤ºæ·»åŠ è®°å½•çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦çš„é…ç½®</p>
<h3 id="1-è¡¨å‡†å¤‡"><a href="#1-è¡¨å‡†å¤‡" class="headerlink" title="1. è¡¨å‡†å¤‡"></a>1. è¡¨å‡†å¤‡</h3><p>æ²¿ç”¨å‰ä¸€ç¯‡çš„è¡¨ï¼Œç»“æ„å¦‚ä¸‹</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">CREATE TABLE `money` (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  `id` int(11) unsigned <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  `name` varchar(20) <span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> DEFAULT </span><span class="string">''</span> COMMENT <span class="string">'ç”¨æˆ·å'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  `money` int(26) <span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> DEFAULT </span><span class="string">'0'</span> COMMENT <span class="string">'é’±'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  `is_deleted` tinyint(1) <span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> DEFAULT </span><span class="string">'0'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  `create_at` timestamp <span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> DEFAULT </span>CURRENT_TIMESTAMP COMMENT <span class="string">'åˆ›å»ºæ—¶é—´'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  `update_at` timestamp <span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> DEFAULT </span>CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT <span class="string">'æ›´æ–°æ—¶é—´'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  PRIMARY KEY (`id`),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">  KEY `name` (`name`)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">) <span class="attribute">ENGINE</span>=InnoDB <span class="attribute">AUTO_INCREMENT</span>=1<span class="built_in"> DEFAULT </span><span class="attribute">CHARSET</span>=utf8mb4;</span></pre></td></tr></table></figure>

<h3 id="2-é¡¹ç›®é…ç½®"><a href="#2-é¡¹ç›®é…ç½®" class="headerlink" title="2. é¡¹ç›®é…ç½®"></a>2. é¡¹ç›®é…ç½®</h3><p>é…ç½®ä¿¡æ¯ï¼Œä¸ä¹‹å‰æœ‰ä¸€ç‚¹ç‚¹åŒºåˆ«ï¼Œæˆ‘ä»¬æ–°å¢äº†æ›´è¯¦ç»†çš„æ—¥å¿—æ‰“å°ï¼›æœ¬ç¯‡ä¸»è¦ç›®æ ‡é›†ä¸­åœ¨æ·»åŠ è®°å½•çš„ä½¿ç”¨å§¿åŠ¿ï¼Œå¯¹äºé…ç½®è¯´æ˜ï¼Œåé¢å•ç‹¬è¿›è¡Œè¯´æ˜</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">## DataSource</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.url</span>=jdbc:mysql://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3306</span>/story?useUnicode=<span class="literal">true</span>&amp;characterEncoding=UTF-<span class="number">8</span>&amp;useSSL=<span class="literal">false</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=com.mysql.jdbc.Driver</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.username</span>=root</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.password</span>=</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment">## jpaç›¸å…³é…ç½®</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.jpa.database</span>=MYSQL</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.jpa.hibernate.ddl-auto</span>=none</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.jpa.show-sql</span>=<span class="literal">true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.jackson.serialization.indent_output</span>=<span class="literal">true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.jpa.hibernate.naming.physical-strategy</span>=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl</span></pre></td></tr></table></figure>

<h3 id="3-æ•°æ®å‡†å¤‡"><a href="#3-æ•°æ®å‡†å¤‡" class="headerlink" title="3. æ•°æ®å‡†å¤‡"></a>3. æ•°æ®å‡†å¤‡</h3><p>æ•°æ®ä¿®æ”¹å˜›ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå‘è¡¨é‡Œé¢æ’å…¥ä¸¤æ¡æ•°æ®ï¼Œç”¨äºåé¢çš„æ“ä½œ</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="symbol">`money`</span> (<span class="symbol">`id`</span>, <span class="symbol">`name`</span>, <span class="symbol">`money`</span>, <span class="symbol">`is_deleted`</span>, <span class="symbol">`create_at`</span>, <span class="symbol">`update_at`</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">VALUES</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  (<span class="number">21</span>, <span class="string">'jpa ä¿®æ”¹-&gt;ä¸€ç°ç°'</span>, <span class="number">1212</span>, <span class="number">0</span>, <span class="string">'2019-06-22 21:41:13'</span>, <span class="string">'2019-06-22 21:41:13'</span>),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  (<span class="number">22</span>, <span class="string">'jpa ä¿®æ”¹-&gt;ä¸€ç°ç°'</span>, <span class="number">6666</span>, <span class="number">0</span>, <span class="string">'2019-06-22 21:41:13'</span>, <span class="string">'2019-06-22 21:41:13'</span>);</span></pre></td></tr></table></figure>

<p><a href="http://image.winrains.cn/2019/11/c34e8-00.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/c34e8-00.jpg" alt="img"></a></p>
<h2 id="II-Updateä½¿ç”¨æ•™ç¨‹"><a href="#II-Updateä½¿ç”¨æ•™ç¨‹" class="headerlink" title="II. Updateä½¿ç”¨æ•™ç¨‹"></a>II. Updateä½¿ç”¨æ•™ç¨‹</h2><p>ä¸‹é¢å¼€å§‹è¿›å…¥æ­£é¢˜ï¼Œä¸ºæ–¹ä¾¿åˆçœ‹çš„åŒå­¦ï¼ˆæ²¡ç©ºæˆ–è€…æ²¡å…´è¶£ç…å‰é¢å‡ ä¸ªåšæ–‡çš„åŒå­¦ï¼‰ä¼šæœ‰éƒ¨åˆ†å†…å®¹å’Œå‰é¢çš„åšæ–‡ç›¸åŒï¼Œçœ‹è¿‡çš„è¯·æ— è§†</p>
<h3 id="1-è¡¨å…³è”POJO"><a href="#1-è¡¨å…³è”POJO" class="headerlink" title="1. è¡¨å…³è”POJO"></a>1. è¡¨å…³è”POJO</h3><p>å‰é¢æ’å…¥ç¯‡å·²ç»ä»‹ç»äº†POJOçš„é€æ­¥åˆ›å»ºè¿‡ç¨‹ï¼Œå·²ç»å¯¹åº”çš„æ³¨è§£å«ä¹‰ï¼Œä¸‹é¢ç›´æ¥è´´å‡ºæˆæœ</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@Data</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@DynamicInsert</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@Entity</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@Table</span>(name = <span class="string">"money"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">public class MoneyPO &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="variable">@Id</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="variable">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="variable">@Column</span>(name = <span class="string">"id"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    private Integer id;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="variable">@Column</span>(name = <span class="string">"name"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    private String name;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    <span class="variable">@Column</span>(name = <span class="string">"money"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    private Long money;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    <span class="variable">@Column</span>(name = <span class="string">"is_deleted"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    private Byte isDeleted;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    <span class="variable">@Column</span>(name = <span class="string">"create_at"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    <span class="variable">@CreatedDate</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    private Timestamp createAt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">    <span class="variable">@Column</span>(name = <span class="string">"update_at"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    <span class="variable">@CreatedDate</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    private Timestamp updateAt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>ä¸Šé¢ç±»ä¸­çš„å‡ ä¸ªæ³¨è§£ï¼Œè¯´æ˜å¦‚ä¸‹</p>
<ul>
<li><code>@Data</code> å±äºlombokæ³¨è§£ï¼Œä¸jpaæ— å…³ï¼Œè‡ªåŠ¨ç”Ÿæˆ<code>getter/setter/equals/hashcode/tostring</code>ç­‰æ–¹æ³•</li>
<li><code>@Entity</code>, <code>@Table</code> jpaæ³¨è§£ï¼Œè¡¨ç¤ºè¿™ä¸ªç±»ä¸dbçš„è¡¨å…³è”ï¼Œå…·ä½“åŒ¹é…çš„æ˜¯è¡¨ <code>money</code></li>
<li><code>@Id</code> <code>@GeneratedValue</code> ä½œç”¨ä¸è‡ªå¢ä¸»é”®</li>
<li><code>@Column</code>è¡¨æ˜è¿™ä¸ªå±æ€§ä¸è¡¨ä¸­çš„æŸåˆ—å¯¹åº”</li>
<li><code>@CreateDate</code>æ ¹æ®å½“å‰æ—¶é—´æ¥ç”Ÿæˆé»˜è®¤çš„æ—¶é—´æˆ³</li>
</ul>
<h3 id="2-Repository-APIå£°æ˜"><a href="#2-Repository-APIå£°æ˜" class="headerlink" title="2. Repository APIå£°æ˜"></a>2. Repository APIå£°æ˜</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ–°å»ºä¸€ä¸ªapiç»§æ‰¿è‡ª<code>CurdRepository</code>ï¼Œç„¶åé€šè¿‡è¿™ä¸ªapiæ¥ä¸æ•°æ®åº“æ‰“äº¤é“</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public<span class="built_in"> interface </span>MoneyUpdateRepository extends CrudRepository&lt;MoneyPO, Integer&gt; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h3 id="3-ä½¿ç”¨å§¿åŠ¿"><a href="#3-ä½¿ç”¨å§¿åŠ¿" class="headerlink" title="3. ä½¿ç”¨å§¿åŠ¿"></a>3. ä½¿ç”¨å§¿åŠ¿</h3><h4 id="a-save"><a href="#a-save" class="headerlink" title="a. save"></a>a. save</h4><p>åœ¨å‰é¢ä¸€ç¯‡æ’å…¥åšæ–‡ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å½“POJOçš„idå­˜åœ¨æ—¶ï¼Œè°ƒç”¨saveæ–¹æ³•å¯èƒ½æœ‰ä¸¤ç§æƒ…å†µ</p>
<ul>
<li>è‹¥dbä¸­è¿™ä¸ªidå¯¹åº”çš„å­—æ®µä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥</li>
<li>è‹¥dbä¸­è¿™ä¸ªidå¯¹åº”çš„å­—æ®µå­˜åœ¨ï¼Œåˆ™æ›´æ–°</li>
</ul>
<p>æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹æ›´æ–°çš„æ•ˆæœï¼Œä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†ä¸¤å—ï¼Œä¸€ä¸ªæ˜¯å½“poä¸­çš„æ‰€æœ‰æˆå‘˜å€¼æœ‰æ•ˆï¼Œæ›´æ–°å…¶ä¸­çš„ä¸€ä¸ªæ—¶ï¼Œä¼šæ€æ ·ï¼›å¦å¤–ä¸€ä¸ªæ¼”ç¤ºçš„æ˜¯éƒ¨åˆ†æ›´æ–°æ—¶ä¼šæ€æ ·ï¼ˆnameä¸ºç©ºï¼Œè¡¨ç¤ºæˆ‘ä¸å¸Œæœ›æ›´æ–°nameï¼‰</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="type">void</span> simpleUpdateById() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    MoneyPO <span class="type">record</span> = moneyUpdateRepository.findById(<span class="number">21</span>).<span class="keyword">get</span>();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    // ç›´æ¥ä¿®æ”¹è¿™ä¸ª<span class="type">record</span>çš„å†…å®¹</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="type">record</span>.setMoney(<span class="number">3333</span>L);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    moneyUpdateRepository.save(<span class="type">record</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="type">record</span> = moneyUpdateRepository.findById(<span class="number">21</span>).<span class="keyword">get</span>();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">System</span>.<span class="keyword">out</span>.println("after updateMoney record: " + <span class="type">record</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="type">record</span>.setName(<span class="keyword">null</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="type">record</span>.setMoney(<span class="number">6666</span>L);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    moneyUpdateRepository.save(<span class="type">record</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="type">record</span> = moneyUpdateRepository.findById(<span class="number">21</span>).<span class="keyword">get</span>();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">System</span>.<span class="keyword">out</span>.println("after updateMoney record: " + <span class="type">record</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå‘ç°ï¼Œå‰é¢æ‰§è¡ŒæˆåŠŸï¼Œåé¢æ‰§è¡Œå¤±è´¥<br><a href="http://image.winrains.cn/2019/11/7917b-01.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/7917b-01.jpg" alt="img"></a><br>ä¸Šé¢ä¸ºç¬¬ä¸€ä¸ªæ‰§è¡Œç»“æœï¼Œä»æ‹¼æ¥çš„sqlå¯ä»¥çŸ¥é“ï¼Œæ˜¯å…¨é‡çš„ä¿®æ”¹ï¼›è¾“å‡ºç»“æœä¹Ÿå¦‚æˆ‘ä»¬é¢„æœŸ<br>åé¢å°†nameè®¾ç½®ä¸ºç©ºä¹‹åï¼Œå†æ¬¡æ›´æ–°ï¼Œå‘ç°æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚ä¸‹ï¼Œè¿™ä¸ªæ˜¯å› ä¸ºæˆ‘ä»¬çš„dbé™åˆ¶ï¼Œå­—æ®µä¸å…è®¸æœ‰nullçš„å­˜åœ¨<br><a href="http://image.winrains.cn/2019/11/38a6e-02.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/38a6e-02.jpg" alt="img"></a><br>ä»æ‹¼æ¥çš„sqlä¸Šçœ‹ï¼Œæˆ‘ä»¬çŸ¥é“æ˜¯å› ä¸ºæ¯ä¸ªæˆå‘˜éƒ½ä½œä¸ºäº†<code>update sql</code>å®¶æ—çš„ä¸€å‘˜ï¼Œåœ¨insertè¿™ä¸€ç¯‡ä¸­æˆ‘ä»¬ä¹Ÿé‡åˆ°äº†ç±»ä¼¼çš„é—®é¢˜ï¼Œå½“æ—¶æ˜¯åœ¨POJOä¸Šæ·»åŠ æ³¨è§£<code>@DynamicInsert</code>ï¼Œæ ¹æ®å®é™…éœ€è¦é€‰æ‹©æ’å…¥ï¼Œé‚£ä¹ˆåœ¨æ›´æ–°è¿™é‡Œæ˜¯ä¸æ˜¯ä¹Ÿæœ‰ç±»ä¼¼çš„æ³¨è§£å‘¢</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@Data</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@DynamicUpdate</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@DynamicInsert</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@Entity</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@Table</span>(name = <span class="string">"money"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">public class MoneyPO &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>åœ¨pojoä¸Šæ·»åŠ æ³¨è§£<code>@DynamicUpdate</code>ä¹‹åï¼Œå†æ¬¡è¿›è¡Œå°è¯•ï¼Œç»“æœå¦‚ä¸‹<br><a href="http://image.winrains.cn/2019/11/3e923-03.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/3e923-03.jpg" alt="img"></a><br>å±…ç„¶è¿˜æ˜¯å¤±è´¥äº†ï¼Œä»è¾“å‡ºçš„sqlæ¥çœ‹ï¼Œå±…ç„¶æŠŠ<code>name</code>å’Œ<code>money</code>éƒ½å½“æˆäº†sqlçš„ä¸€éƒ¨åˆ†ï¼Œéš¾é“æ˜¯å› ä¸ºæˆ‘ä»¬è°ƒç”¨äº†setteræ–¹æ³•çš„åŸå› ä¹ˆã€‚å¾…ç€çŒœæµ‹ï¼Œå†æ¥ä¸€æ¬¡</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">MoneyPO <span class="keyword">to</span>Update = new MoneyPO();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">to</span>Update.<span class="built_in">set</span>Id(<span class="number">21</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">to</span>Update.<span class="built_in">set</span>Money(<span class="number">6666</span>L);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">moneyUpdateRepository.save(<span class="keyword">to</span>Update);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">record = moneyUpdateRepository.findById(<span class="number">21</span>).get();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">System.<span class="keyword">out</span>.println(<span class="string">"after updateMoney record: "</span> + record);</span></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼Œçœ‹æ¥æˆ‘ä»¬ä¸Šé¢çš„çŒœæµ‹å¹¶ä¸å¯¹ï¼Œæ‹¼æ¥sqlåº”è¯¥æ˜¯æ ¹æ®å“ªä¸ªå­—æ®µå‘ç”Ÿäº†å˜åŒ–ï¼Œå°±æŠŠå“ªä¸ªåšä¸ºsqlçš„ä¸€éƒ¨åˆ†æ¥åšçš„<br><a href="http://image.winrains.cn/2019/11/e99c2-04.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/e99c2-04.jpg" alt="img"></a><br>ä¸Šé¢è¿™ä¸ªä½¿ç”¨å§¿åŠ¿çœ‹å®Œä¹‹åï¼Œä¼šæœ‰ä¸€ä¸ªæ˜æ˜¾çš„æ„Ÿè§‰ï¼Œè¿™ä¸ªæ›´æ–°çš„æ”¯æŒï¼Œå¿…é¡»å…ˆè·å–ç›®æ ‡å¯¹è±¡å†è¿›è¡Œä¿®æ”¹ï¼Œå¾ˆéš¾æ»¡è¶³æˆ‘ä»¬çš„æ—¥å¸¸ä¸šåŠ¡åœºæ™¯ï¼›</p>
<h4 id="b-æŸ¥è¯¢æ›´æ–°"><a href="#b-æŸ¥è¯¢æ›´æ–°" class="headerlink" title="b. æŸ¥è¯¢æ›´æ–°"></a>b. æŸ¥è¯¢æ›´æ–°</h4><p>æ ¹æ®æŸä¸ªæ¡ä»¶æ¥æ›´æ–°å¯¹åº”çš„æ•°æ®ï¼Œè¿™ä¸ªå°±æ¯”è¾ƒå¸¸è§äº†ï¼Œåœ¨jpaä¸­ï¼Œæ²¡æœ‰æ‰¾åˆ°æ ¹æ®æ–¹æ³•åæ¥æ”¯æ’‘è¿™ç§åœºæ™¯çš„æ–¹å¼ï¼Œä½†æ˜¯å‘ç°äº†å¦å¤–ä¸€ä¸ªæœ‰æ„æ€çš„ä¸œè¥¿â€“<code>jql</code><br>ç›´æ¥åœ¨æ–¹æ³•æ–¹é¢ï¼Œæ·»åŠ æ³¨è§£ï¼Œæ³¨è§£å†…éƒ¨å†™sql</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * æ ¹æ®é‡‘é’±æ¥ä¿®æ”¹çŠ¶æ€</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> *</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * @param money</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * @param state</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@Modifying</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@Query</span>(<span class="string">"update MoneyPO m set m.isDeleted=?2 where  m.money=?1"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">void updateStateByMoney(Long money, Byte state);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * è¡¨è¾¾å¼è®¡ç®—</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> *</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * @param id</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * @param money</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@Modifying</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@Query</span>(<span class="string">"update MoneyPO m set m.money=m.money + ?2 where m.id=?1"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">void addMoneyById(Integer id, Long money);</span></pre></td></tr></table></figure>

<p>ä¸Šé¢å°±æ˜¯ä¸€ä¸ªæŸ¥è¯¢æ›´æ–°çš„caseï¼Œæ³¨æ„ä¸¤ä¸ªæ³¨è§£</p>
<ul>
<li><code>@Modifying</code> è¿™ä¸ªå¿…é¡»æœ‰ï¼Œå‘Šè¯‰æ¡†æ¶æˆ‘ä»¬æ‰§è¡Œçš„æ˜¯æ›´æ–°/åˆ é™¤æ“ä½œ</li>
<li><code>@Query</code> å†…éƒ¨æ˜¯æ­£å¸¸çš„sqlè¯­å¥ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯è¡¨åï¼Œä¸æ˜¯å®é™…çš„è¡¨ï¼Œè€Œæ˜¯æˆ‘ä»¬å‰é¢å®šä¹‰çš„POJO</li>
</ul>
<p>ç„¶åæ¥æµ‹è¯•ä¸€ä¸‹ä½¿ç”¨</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="type">void</span> updateByQuery() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    // é€šè¿‡æŸ¥è¯¢ä¿®æ”¹</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    moneyUpdateRepository.updateStateByMoney(<span class="number">6666</span>L, (byte) <span class="number">0x01</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    MoneyPO <span class="type">record</span> = moneyUpdateRepository.findById(<span class="number">21</span>).<span class="keyword">get</span>();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">System</span>.<span class="keyword">out</span>.println("after update record: " + <span class="type">record</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    moneyUpdateRepository.addMoneyById(<span class="number">21</span>, <span class="number">3333</span>L);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="type">record</span> = moneyUpdateRepository.findById(<span class="number">21</span>).<span class="keyword">get</span>();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">System</span>.<span class="keyword">out</span>.println("after addMoney record: " + <span class="type">record</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>æ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œæ‚²å‚¬çš„å‘ç°å±…ç„¶æŠ¥é”™äº† <code>Caused by: javax.persistence.TransactionRequiredException: Executing an update/delete query</code><br><a href="http://image.winrains.cn/2019/11/96d2c-05.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/96d2c-05.jpg" alt="img"></a><br>ä»å †æ ˆçš„æè¿°ä¸Šæ¥çœ‹ï¼Œæ›´æ–°/åˆ é™¤å¿…é¡»è¦å¼€å¯äº‹åŠ¡ï¼Œé‚£ä¹ˆäº‹åŠ¡æ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿä¸‹é¢æ¨èå‡ ç¯‡åšæ–‡</p>
<ul>
<li><a href="https://blog.hhui.top/hexblog/2018/03/23/mysqlä¹‹é”ä¸äº‹åŠ¡è¯¦è§£/" target="_blank" rel="noopener">mysqlä¹‹é”ä¸äº‹åŠ¡è¯¦è§£</a></li>
<li><a href="https://blog.hhui.top/hexblog/2018/05/12/Springå­¦ä¹ ä¹‹äº‹åŠ¡çš„ä½¿ç”¨å§¿åŠ¿/" target="_blank" rel="noopener">Springå­¦ä¹ ä¹‹äº‹åŠ¡çš„ä½¿ç”¨å§¿åŠ¿</a></li>
<li><a href="https://blog.hhui.top/hexblog/2018/05/13/Springå­¦ä¹ ä¹‹äº‹åŠ¡ç®¡ç†ä¸ä¼ æ’­å±æ€§/" target="_blank" rel="noopener">Springå­¦ä¹ ä¹‹äº‹åŠ¡ç®¡ç†ä¸ä¼ æ’­å±æ€§</a></li>
</ul>
<p>å…³äºjpaä¸­æ›´å¤šäº‹åŠ¡ç›¸å…³çš„ï¼Œåé¢å†å¼•å…¥ï¼Œæˆ‘ä»¬å…ˆå›åˆ°æœ¬æ–‡ä¸»é¢˜ï¼Œå¦‚ä½•è§£å†³é—®é¢˜: åœ¨è°ƒç”¨ä¸Šé¢çš„æ–¹æ³•ä¸Šé¢æ·»åŠ äº‹åŠ¡æ³¨è§£å³å¯</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    simpleUpdateById();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    updateByQuery();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>å†æ¬¡æ‰§è¡Œä¹‹åï¼Œç»“æœå¦‚ä¸‹<br><a href="http://image.winrains.cn/2019/11/9e7d7-06.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/9e7d7-06.jpg" alt="img"></a><br>çœ‹ä¸Šé¢çš„ç»“æœï¼Œå‘ç°money+3333ä¹‹åçš„è¾“å‡ºç»“æœå±…ç„¶è¿˜æ˜¯6666ï¼›ä½†æ˜¯æˆ‘ä»¬å†çœ‹dbçš„ç»“æœï¼Œå·²ç»æ˜¯9999äº†ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ<br><a href="http://image.winrains.cn/2019/11/8f0fc-07.jpg" target="_blank" rel="noopener"><img src="http://image.winrains.cn/2019/11/8f0fc-07.jpg" alt="img"></a><br>ä¸Šé¢è¿™ä¸ªé—®é¢˜æ¯”è¾ƒæœ‰æ„æ€äº†ï¼Œåˆæ­¥çŒœæµ‹ä¸äº‹ç‰©å·²ç»jpaçš„å†…éƒ¨ç¼“å­˜æœºåˆ¶æœ‰å…³ç³»ï¼Œè‡³äºå…·ä½“æ˜¯ä¸æ˜¯è¿™æ ·ï¼Œæœ‰å¿…è¦ä¸“é—¨å¼€å‘æ¥éªŒè¯ä¸€äºŒ</p>
<h3 id="4-å°ç»“"><a href="#4-å°ç»“" class="headerlink" title="4. å°ç»“"></a>4. å°ç»“</h3><p>åˆ©ç”¨JPAå®ç°è¡¨æ•°æ®çš„æ›´æ–°ï¼Œä¸Šé¢ä¸»è¦ä»‹ç»äº†ä¸¤ç§æ–¹å¼ï¼Œ save + jql<br><strong>save</strong><br>é€šè¿‡saveæ›´æ–°æ—¶ï¼Œéœ€è¦æŒ‡å®šidæ¥å®ç°å•æ¡è®°å½•çš„ä¿®æ”¹<br><strong>jql</strong><br>è¯­æ³•ä¸sqlå·®ä¸å¤šï¼Œé…åˆä¸¤ä¸ªæ³¨è§£ <code>@Modifying</code>, <code>@Query</code>æ¥ä½¿ç”¨ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œä¸¤ç‚¹éœ€è¦æ³¨æ„</p>
<ul>
<li>è¡¨åæ˜¯æˆ‘ä»¬å®šä¹‰çš„ä¸dbä¸­è¡¨å…³è”çš„POJO</li>
<li>å‚æ•°ä¼ é€’æ ¼å¼ä¸º<code>?index</code>ï¼Œ indexä¸ºå‚æ•°ä½ç½®</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@Modifying</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="variable">@Query</span>(<span class="string">"update MoneyPO m set m.isDeleted=?2 where  m.money=?1"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">void updateStateByMoney(Long money, Byte state);</span></pre></td></tr></table></figure>

<p>æ•°æ®ä¿®æ”¹å’Œåˆ é™¤ï¼Œéœ€è¦æ˜¾ç¤ºå£°æ˜äº‹åŠ¡ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œä¸€ä¸ªæ˜¯åœ¨è°ƒç”¨çš„æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ <code>@Transactional</code>ï¼Œæˆ–è€…ç›´æ¥åœ¨repository apiçš„æ¥å£ä¸Šæ·»åŠ æ³¨è§£ <code>@Transactional</code></p>
<blockquote>
<p>ä½œè€…ï¼šä¸€ç°ç°Blog</p>
<p>æ¥æºï¼š<a href="http://spring.hhui.top/spring-blog/2019/06/23/190623-SpringBoot%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8BJPA%E4%B9%8Bupdate%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/" target="_blank" rel="noopener">http://spring.hhui.top/spring-blog/2019/06/23/190623-SpringBoot%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8BJPA%E4%B9%8Bupdate%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/</a></p>
</blockquote>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/08/Spring-Boot-%E9%AB%98%E7%BA%A7%E7%AF%87-JPA%EF%BC%882%EF%BC%89%EF%BC%9A%E6%96%B0%E5%A2%9E%E8%AE%B0%E5%BD%95%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/" rel="prev" title="Spring Boot é«˜çº§ç¯‡--JPAï¼ˆ2ï¼‰ï¼šæ–°å¢è®°å½•ä½¿ç”¨å§¿åŠ¿">
      <i class="fa fa-chevron-left"></i> Spring Boot é«˜çº§ç¯‡--JPAï¼ˆ2ï¼‰ï¼šæ–°å¢è®°å½•ä½¿ç”¨å§¿åŠ¿
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/01/08/Spring-Boot-%E9%AB%98%E7%BA%A7%E7%AF%87-JPA%EF%BC%884%EF%BC%89%EF%BC%9Adelete%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF%E8%AF%A6%E8%A7%A3/" rel="next" title="Spring Boot é«˜çº§ç¯‡--JPAï¼ˆ4ï¼‰ï¼šdeleteä½¿ç”¨å§¿åŠ¿è¯¦è§£">
      Spring Boot é«˜çº§ç¯‡--JPAï¼ˆ4ï¼‰ï¼šdeleteä½¿ç”¨å§¿åŠ¿è¯¦è§£ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#I-ç¯å¢ƒå‡†å¤‡"><span class="nav-number">1.</span> <span class="nav-text">I. ç¯å¢ƒå‡†å¤‡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-è¡¨å‡†å¤‡"><span class="nav-number">1.1.</span> <span class="nav-text">1. è¡¨å‡†å¤‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-é¡¹ç›®é…ç½®"><span class="nav-number">1.2.</span> <span class="nav-text">2. é¡¹ç›®é…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-æ•°æ®å‡†å¤‡"><span class="nav-number">1.3.</span> <span class="nav-text">3. æ•°æ®å‡†å¤‡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#II-Updateä½¿ç”¨æ•™ç¨‹"><span class="nav-number">2.</span> <span class="nav-text">II. Updateä½¿ç”¨æ•™ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-è¡¨å…³è”POJO"><span class="nav-number">2.1.</span> <span class="nav-text">1. è¡¨å…³è”POJO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Repository-APIå£°æ˜"><span class="nav-number">2.2.</span> <span class="nav-text">2. Repository APIå£°æ˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-ä½¿ç”¨å§¿åŠ¿"><span class="nav-number">2.3.</span> <span class="nav-text">3. ä½¿ç”¨å§¿åŠ¿</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-save"><span class="nav-number">2.3.1.</span> <span class="nav-text">a. save</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-æŸ¥è¯¢æ›´æ–°"><span class="nav-number">2.3.2.</span> <span class="nav-text">b. æŸ¥è¯¢æ›´æ–°</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-å°ç»“"><span class="nav-number">2.4.</span> <span class="nav-text">4. å°ç»“</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">congsheng.wang</p>
  <div class="site-description" itemprop="description">trouble is a friend</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">984</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">94</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">156</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">congsheng.wang</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.6.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
