<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://congsheng.wang').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="trouble is a friend">
<meta property="og:type" content="website">
<meta property="og:title" content="个人博客">
<meta property="og:url" content="http:&#x2F;&#x2F;congsheng.wang&#x2F;page&#x2F;50&#x2F;index.html">
<meta property="og:site_name" content="个人博客">
<meta property="og:description" content="trouble is a friend">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://congsheng.wang/page/50/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>个人博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">congsheng的博客</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">156</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">94</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">984</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2019/12/29/Spring-Boot%E7%9F%A5%E8%AF%86%E6%B8%85%E5%8D%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="congsheng.wang">
      <meta itemprop="description" content="trouble is a friend">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/29/Spring-Boot%E7%9F%A5%E8%AF%86%E6%B8%85%E5%8D%95/" class="post-title-link" itemprop="url">Spring Boot知识清单</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-29 22:33:30" itemprop="dateCreated datePublished" datetime="2019-12-29T22:33:30+08:00">2019-12-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">Spring技术</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring%E6%8A%80%E6%9C%AF/Spring-Boot/" itemprop="url" rel="index">
                    <span itemprop="name">Spring Boot</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<ol>
<li>预警：本文非常长，建议先mark后看，也许是最后一次写这么长的文章</li>
<li>说明：前面有4个小节关于Spring的基础知识，分别是：IOC容器、JavaConfig、事件监听、SpringFactoriesLoader详解，它们占据了本文的大部分内容，虽然它们之间可能没有太多的联系，但这些知识对于理解Spring Boot的核心原理至关重要，如果你对Spring框架烂熟于心，完全可以跳过这4个小节。正是因为这个系列的文章是由这些看似不相关的知识点组成，因此取名知识清单。</li>
</ol>
</blockquote>
<p>在过去两三年的Spring生态圈，最让人兴奋的莫过于Spring Boot框架。或许从命名上就能看出这个框架的设计初衷：快速的启动Spring应用。因而Spring Boot应用本质上就是一个基于Spring框架的应用，它是Spring对“约定优先于配置”理念的最佳实践产物，它能够帮助开发者更快速高效地构建基于Spring生态圈的应用。<br>那Spring Boot有何魔法？<strong>自动配置</strong>、<strong>起步依赖</strong>、<strong>Actuator</strong>、<strong>命令行界面(CLI)</strong> 是Spring Boot最重要的4大核心特性，其中CLI是Spring Boot的可选特性，虽然它功能强大，但也引入了一套不太常规的开发模型，因而这个系列的文章仅关注其它3种特性。如文章标题，本文是这个系列的第一部分，将为你打开Spring Boot的大门，重点为你剖析其启动流程以及自动配置实现原理。要掌握这部分核心内容，理解一些Spring框架的基础知识，将会让你事半功倍。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/12/29/Spring-Boot%E7%9F%A5%E8%AF%86%E6%B8%85%E5%8D%95/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%886%EF%BC%89%EF%BC%9A%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="congsheng.wang">
      <meta itemprop="description" content="trouble is a friend">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%886%EF%BC%89%EF%BC%9A%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">Redis使用教程（6）：管理</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-29 22:32:37" itemprop="dateCreated datePublished" datetime="2019-12-29T22:32:37+08:00">2019-12-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">Java技术</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%8A%80%E6%9C%AF/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="7-管理"><a href="#7-管理" class="headerlink" title="7 管理"></a>7 管理</h1><blockquote>
<p>虽然小白的博客已经运行有一段时间了，可是小白对如何管理Redis依然完全没有概念。比如他知道Redis将所有的数据都存储在内存中，那么如果服务器重启了，Redis中的数据怎么恢复呢？又如怎样给Redis设置密码以防其他未经授权的客户端连接呢？带着这些疑惑，小白再一次找到了宋老师。</p>
</blockquote>
<p>本章将会讲解Redis的管理知识，包括持久化、复制和安全内容，同时还会介绍一些第三方的Redis管理工具。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%886%EF%BC%89%EF%BC%9A%E7%AE%A1%E7%90%86/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%885%EF%BC%89%EF%BC%9A%E9%AB%98%E5%8F%AF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="congsheng.wang">
      <meta itemprop="description" content="trouble is a friend">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%885%EF%BC%89%EF%BC%9A%E9%AB%98%E5%8F%AF%E7%94%A8/" class="post-title-link" itemprop="url">Redis使用教程（5）：高可用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-29 22:30:58" itemprop="dateCreated datePublished" datetime="2019-12-29T22:30:58+08:00">2019-12-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">Java技术</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%8A%80%E6%9C%AF/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="6-reids高可用"><a href="#6-reids高可用" class="headerlink" title="6 reids高可用"></a>6 reids高可用</h1><h2 id="6-1-持久化"><a href="#6-1-持久化" class="headerlink" title="6.1 持久化"></a>6.1 持久化</h2><p><strong>Redis 持久化</strong><br>提供了多种不同级别的持久化方式：</p>
<ul>
<li><code>RDB</code>持久化可以在指定的时间间隔内生成数据集的时间点快照（point-in-time snapshot）。</li>
<li><code>AOF</code>持久化记录服务器执行的所有写操作命令，并在服务器启动时，通过重新执行这些命令来还原数据集。 AOF 文件中的命令全部以 Redis 协议的格式来保存，新命令会被追加到文件的末尾。 Redis 还可以在后台对 AOF 文件进行重写（rewrite），使得 AOF 文件的体积不会超出保存数据集状态所需的实际大小。Redis 还可以同时使用 AOF 持久化和 RDB 持久化。 在这种情况下， 当 Redis 重启时， 它会优先使用 AOF 文件来还原数据集， 因为 AOF 文件保存的数据集通常比 RDB 文件所保存的数据集更完整。</li>
<li>你甚至可以关闭持久化功能，让数据只在服务器运行时存在。了解 RDB 持久化和 AOF 持久化之间的异同是非常重要的， 以下几个小节将详细地介绍这这两种持久化功能， 并对它们的相同和不同之处进行说明。</li>
</ul>
<p>Redis的强劲性能很大程度上是由于其将所有数据都存储在了内存中，为了使Redis在重启之后仍能保证数据不丢失，需要将数据从内存中以某种形式同步到硬盘中，这一过程就是持久化。<br>Redis支持两种方式的持久化，一种是<code>RDB</code>方式，一种是<code>AOF</code>方式。可以单独使用其中一种或将二者结合使用。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%885%EF%BC%89%EF%BC%9A%E9%AB%98%E5%8F%AF%E7%94%A8/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%884%EF%BC%89%EF%BC%9AJedis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="congsheng.wang">
      <meta itemprop="description" content="trouble is a friend">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%884%EF%BC%89%EF%BC%9AJedis/" class="post-title-link" itemprop="url">Redis使用教程（4）：Jedis</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-29 22:30:16" itemprop="dateCreated datePublished" datetime="2019-12-29T22:30:16+08:00">2019-12-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">Java技术</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%8A%80%E6%9C%AF/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="5-Jedis简介"><a href="#5-Jedis简介" class="headerlink" title="5 Jedis简介"></a>5 Jedis简介</h1><p>在此之前我们进行的操作都是通过Redis的命令行客户端redis-cli进行的，并没有介绍实际编程时如何操作Redis。<br>本章将会介绍Java客户端的使用方法。</p>
<h3 id="5-1-1-Jedis简介"><a href="#5-1-1-Jedis简介" class="headerlink" title="5.1.1 Jedis简介"></a><strong>5.1.1 Jedis简介</strong></h3><p><code>Jedis</code>其实可以理解为一个驱动，想一想我们在使用 java链接mysql 数据库的时候，是不是需要使用驱动： mysql-connector-java-5.1.2-bin.jar。<br>同样作为数据库，java链接Redis 也是需要需要驱动的，这个驱动就是 Jedis。<br>事实上，Redis对几十种编程语言客户端提供了支持。基本上，主流的编程语言都可以操作 redis。<br>在<a href="http://www.redis.cn/clients.html上可以查看redis对哪些编程语言提供了支持。以" target="_blank" rel="noopener">http://www.redis.cn/clients.html上可以查看redis对哪些编程语言提供了支持。以</a> java为例，有四种方式都可以去操作 redis.<br><img src="http://image.winrains.cn/2019/10/231fd-1458313179558011312.png" alt="Image.png"><br>事实上，Redis对几十种编程语言客户端提供了支持。基本上，主流的编程语言都可以操作 redis。<br>官方建议是使用 Jedis，J 代表的就是Java。</p>
<h3 id="5-1-2-下载安装Jedis"><a href="#5-1-2-下载安装Jedis" class="headerlink" title="5.1.2 下载安装Jedis"></a><strong>5.1.2 下载安装Jedis</strong></h3><p><strong>Maven用户：</strong><br>在pom.xml文件中添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre></td></tr></table></figure>

<p><strong>非Maven用户：</strong><br>Jedis所有版本的下载地址为: <a href="https://github.com/xetorthio/jedis/releases" target="_blank" rel="noopener">https://github.com/xetorthio/jedis/releases</a><br>本文使用的是最新版本 V2.6.2<br>下载完成之后，进入 src\main\java，将里面的redis 文件夹拷贝到项目的 src目录下。此外你还要导入另外一个 jar， commons-pool2-2.0.jar ，Jedis需要依赖这个 jar才能编译成功。</p>
<h3 id="5-1-3-HelloRedis"><a href="#5-1-3-HelloRedis" class="headerlink" title="5.1.3 HelloRedis"></a><strong>5.1.3 HelloRedis</strong></h3><p>关于以下代码，暂时不用深究，只是为了测试开发环境是否搭建成功，后面的教程中会有详细的讲解。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">package com.tianshouzhi;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * HelloRedis ： 第一个 Redis案例：向 Redis 中存储一个键值对，然后再查询出来并打印</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> *</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> * @author tianshouzhi</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> *</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"> */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> HelloRedis &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="built_in">public</span> static <span class="type">void</span> main(String[] args) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        // Connecting <span class="keyword">to</span> Redis <span class="keyword">server</span> <span class="keyword">on</span> localhost</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        Jedis jedis = <span class="built_in">new</span> Jedis("localhost");</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("Connection to server sucessfully");</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">        // <span class="keyword">check</span> whether <span class="keyword">server</span> <span class="keyword">is</span> running <span class="keyword">or</span> <span class="keyword">not</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println("Server is running: " + jedis.ping());</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>运行代码，如果你的控制台打印出来以下内容</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">Connection <span class="keyword">to</span><span class="built_in"> server </span>sucessfully</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">Server is running: PONG</span></pre></td></tr></table></figure>

<p>恭喜你，你已经成功的进行了一次 java对redis 进行的操作。同时证明我们了我们的开发环境已经搭建好。<br>说明：Jedis对象是在 java中操作redis 最核心的类，当 new的时候，就与服务器建立了连接。在后面的代码中，我们将不会再重复这个 new的过程，只介绍其api如何使用。</p>
<h3 id="5-1-4可能的异常"><a href="#5-1-4可能的异常" class="headerlink" title="5.1.4可能的异常"></a><strong>5.1.4可能的异常</strong></h3><p>如果你出现了异常ConnectionTimeoutException，连接超时异常，那么可能是：<br>1、 因为你的ip地址输错，使用ifconfig可以查看你的linux的ip地址信息<br>2、 如果不是第一个原因，则可能是因为你的服务器防火墙没有针对6379端口开放，redis默认监听的就是这个端口，为了方便，可以选择直接关闭防火墙.命令为：service iptables stop<br>3、如果redis-server不是在6379端口启动，那么使用redis-cli连接的时候需要指定端口号。同理，这种情况下，使用java操作redis，也要指定端口等信息。</p>
<h3 id="5-1-5Jedis设计"><a href="#5-1-5Jedis设计" class="headerlink" title="5.1.5Jedis设计"></a><strong>5.1.5Jedis设计</strong></h3><p>Jedis作为推荐的java语言redis客户端，其抽象封装为三部分：</p>
<ul>
<li>对象池设计：Pool，JedisPool，GenericObjectPool，BasePoolableObjectFactory，JedisFactory</li>
<li>面向用户的redis操作封装：BinaryJedisCommands，JedisCommands，BinaryJedis，Jedis</li>
<li>面向redis服务器的操作封装：Commands，Client，BinaryClient，Connection，Protocol</li>
</ul>
<p>其类设计图如下：<br><img src="http://image.winrains.cn/2019/10/7f585-1458474866382096963.jpg" alt="cd3e4917-0dd5-3de9-9a7d-3781c2c246a6.jpg"><br>关于common-pool的相关内容，可以参见：<a href="http://macrochen.iteye.com/blog/320077" target="_blank" rel="noopener">http://macrochen.iteye.com/blog/320077</a><br>其他类的设计作用如下：</p>
<table>
<thead>
<tr>
<th>类名</th>
<th>职责</th>
</tr>
</thead>
<tbody><tr>
<td>Pool</td>
<td>抽象Jedis对象池操作；并委托给操作给GenericObjectPool</td>
</tr>
<tr>
<td>JedisPool</td>
<td>实现Pool并提供JedisFactory工厂</td>
</tr>
<tr>
<td>JedisFactory</td>
<td>实现BasePoolableObjectFactory，提供创建，销毁Jedis方法</td>
</tr>
<tr>
<td>BinaryJedisCommands</td>
<td>抽象面向客户端操作的Redis命令；key，value都为序列化后的byte数组</td>
</tr>
<tr>
<td>JedisCommands</td>
<td>抽象面向客户端操作的Redis命令；提供String类型的key，value</td>
</tr>
<tr>
<td>BinaryJedis</td>
<td>实现BinaryJedisCommands接口，并将实际操作委托给Client</td>
</tr>
<tr>
<td>Jedis</td>
<td>实现JedisCommands接口，并将操作委托给Client</td>
</tr>
<tr>
<td>Commands</td>
<td>抽象Redis操作接口，提供String类型的key，value操作；被Jedis调用</td>
</tr>
<tr>
<td>Connection</td>
<td>抽象了Redis连接；包括host，port，pass，socket，inputstream,outputstream,protocol 完成与Redis服务器的通信</td>
</tr>
<tr>
<td>Protocol</td>
<td>抽象了Redis协议处理</td>
</tr>
<tr>
<td>BinaryClient</td>
<td>继承Connection类，封装了基于Byte[]的key，value操作</td>
</tr>
<tr>
<td>Client</td>
<td>继承BinaryClient同时实现了Commands，对上层提供基于String类型的操作</td>
</tr>
</tbody></table>
<p>参考：<br><a href="http://yychao.iteye.com/blog/1751583" target="_blank" rel="noopener">http://yychao.iteye.com/blog/1751583</a></p>
<h2 id="5-1-Jedis基本使用"><a href="#5-1-Jedis基本使用" class="headerlink" title="5.1 Jedis基本使用"></a>5.1 Jedis基本使用</h2><p>本节讲解如何通过Jedis来操作Redis中的各种数据类型</p>
<h3 id="1、Jedis操作Redis各种数据结构案例"><a href="#1、Jedis操作Redis各种数据结构案例" class="headerlink" title="1、Jedis操作Redis各种数据结构案例"></a><strong>1、Jedis操作Redis各种数据结构案例</strong></h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Map;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Set;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.BeforeClass;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisTest</span> &#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">static</span> Jedis jedis;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    @BeforeClass</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">beforeClass</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">        jedis = <span class="keyword">new</span> Jedis(<span class="string">"115.28.65.149"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Redis和Java字符串实例</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    @Test</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testString</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">// set the data in redis string</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">        jedis.<span class="built_in">set</span>(<span class="string">"tutorial-name"</span>, <span class="string">"Redis tutorial"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">// Get the stored data and print it</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"Stored string in redis:: "</span> + jedis.<span class="built_in">get</span>(<span class="string">"tutorial-name"</span>));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">// 输出：Stored string in redis:: Redis tutorial</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Redis和Java列表示例</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">    @Test</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testList</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">        jedis.lpush(<span class="string">"tutorial-list"</span>, <span class="string">"Redis"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">        jedis.lpush(<span class="string">"tutorial-list"</span>, <span class="string">"Mongodb"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">        jedis.lpush(<span class="string">"tutorial-list"</span>, <span class="string">"Mysql"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">// Get the stored data and print it</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">        List&lt;<span class="keyword">String</span>&gt; <span class="built_in">list</span> = jedis.lrange(<span class="string">"tutorial-list"</span>, <span class="number">0</span>, <span class="number">5</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">list</span>.<span class="built_in">size</span>(); i++) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">"Stored string in redis:: "</span> + <span class="built_in">list</span>.<span class="built_in">get</span>(i));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">/*</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"><span class="comment">         * 输出 Stored string in redis:: Mysql Stored string in redis:: Mongodb Stored</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line"><span class="comment">         * string in redis:: Redis</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line"><span class="comment">         */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Redis和Java的键实例</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">    @Test</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testKeys</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">        Set&lt;<span class="keyword">String</span>&gt; keys = jedis.keys(<span class="string">"*"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">for</span> (<span class="keyword">String</span> key : keys) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">"List of stored keys:: "</span> + key);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">/*</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line"><span class="comment">         * 输出 List of stored keys:: tutorial-name List of stored keys:: tutorial-list</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line"><span class="comment">         */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Redis和Java的hash实例</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line">    @Test</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHash</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">String</span> key = <span class="string">"user"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">String</span> field_name = <span class="string">"name"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">String</span> field_name_value = <span class="string">"tianshouzhi"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">String</span> field_city = <span class="string">"city"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">String</span> field_city_value = <span class="string">"shanghai"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">        jedis.hset(key, field_name, field_name_value);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line">        jedis.hset(key, field_city, field_city_value);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line">        Map&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; <span class="built_in">map</span> = jedis.hgetAll(key);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line">        Set&lt;Entry&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt;&gt; entrySet = <span class="built_in">map</span>.entrySet();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">for</span> (Entry&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; entry : entrySet) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line">            System.out.<span class="built_in">println</span>(entry.<span class="built_in">getKey</span>() + <span class="string">":"</span> + entry.getValue());</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">/*</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line"><span class="comment">         * 输出 name:tianshouzhi city:shanghai</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line"><span class="comment">         */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Redis和Java的集合实例</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">71</span></pre></td><td class="code"><pre><span class="line">    @Test</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">72</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSet</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">73</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">String</span> key = <span class="string">"set_key"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">74</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">String</span>[] members = <span class="keyword">new</span> <span class="keyword">String</span>[] &#123; <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"a"</span>, <span class="string">"c"</span> &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">75</span></pre></td><td class="code"><pre><span class="line">        jedis.sadd(key, members);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">76</span></pre></td><td class="code"><pre><span class="line">        Set&lt;<span class="keyword">String</span>&gt; smembers = jedis.smembers(key);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">77</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">for</span> (<span class="keyword">String</span> <span class="built_in">string</span> : smembers) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">78</span></pre></td><td class="code"><pre><span class="line">            System.out.<span class="built_in">println</span>(<span class="built_in">string</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">79</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">80</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">/*</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">81</span></pre></td><td class="code"><pre><span class="line"><span class="comment">         * 输出 name:tianshouzhi city:shanghai</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">82</span></pre></td><td class="code"><pre><span class="line"><span class="comment">         */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">83</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">84</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Redis和Java的集合实例</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">85</span></pre></td><td class="code"><pre><span class="line">    @Test</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">86</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testZSet</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">87</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">String</span> key = <span class="string">"zset_key"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">88</span></pre></td><td class="code"><pre><span class="line">        Map&lt;<span class="keyword">String</span>, Double&gt; scoreMembers = <span class="keyword">new</span> HashMap&lt;<span class="keyword">String</span>, Double&gt;();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">89</span></pre></td><td class="code"><pre><span class="line">        jedis.zadd(key, scoreMembers);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">90</span></pre></td><td class="code"><pre><span class="line">        Set&lt;<span class="keyword">String</span>&gt; zrange = jedis.zrange(key, <span class="number">0</span>, <span class="number">2</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">91</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">for</span> (<span class="keyword">String</span> member : zrange) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">92</span></pre></td><td class="code"><pre><span class="line">            System.out.<span class="built_in">println</span>(member);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">93</span></pre></td><td class="code"><pre><span class="line">            System.out.<span class="built_in">println</span>(jedis.zscore(key, member));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">94</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">95</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">/*</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">96</span></pre></td><td class="code"><pre><span class="line"><span class="comment">         * 输出 tianshouzhi 1.0 huhuamin 2.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">97</span></pre></td><td class="code"><pre><span class="line"><span class="comment">         */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">98</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">99</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h3 id="2、Jedis-通知"><a href="#2、Jedis-通知" class="headerlink" title="2、Jedis 通知"></a><strong>2、Jedis 通知</strong></h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订阅：需要先执行订阅操作</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 覆盖JedisPubSub中的onMessage，用于回调</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">@Test</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSubsribe</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    JedisPubSub jedisPubSub = <span class="keyword">new</span> JedisPubSub() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        @Override</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> onMessage(<span class="keyword">String</span> channel, <span class="keyword">String</span> message) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">            System.out.<span class="built_in">println</span>(channel);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">            System.out.<span class="built_in">println</span>(message);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    jedis.subscribe(jedisPubSub, <span class="string">"channel1"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">/*</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment">     * 输出 channel1 test publish substribe</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment">     */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">@Test</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPublish</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">String</span> channel = <span class="string">"channel1"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">String</span> message = <span class="string">"test publish substribe"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">    jedis.publish(channel, message);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>订阅一个channel，需要先用一个client来订阅。然后再publish消息到这个channel中，所以我们需要先执行testSubsribe，再执行testPublish。需要注意的是，<code>JedisPubSub</code>是在后台运行的，因此可以重复不断的接受消息。<br>需要注意的是，因为发布订阅模型中，一条消息被所有订阅次channel的client接受到。有的业务场景下，可能不满足我们要的要求，例如处理订单，我们可能只需要一个Client来处理。此时我们需要使用到阻塞队列。</p>
<h3 id="3、阻塞队列"><a href="#3、阻塞队列" class="headerlink" title="3、阻塞队列"></a><strong>3、阻塞队列</strong></h3><p>为了演示阻塞队列的功能，我们启动2个客户端，一个是java客户端，一个是redis-cli客户端，都从列表queue中使用brpop获取数据。<br><strong>redis-cli客户端</strong><br><img src="http://image.winrains.cn/2019/10/35b84-1458405466365044531.png" alt="QQ截图20160320003724.png"><br><strong>Java客户端</strong></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">@Test</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBlockedQueue</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    List&lt;<span class="keyword">String</span>&gt; brpop = jedis.brpop(<span class="number">0</span>, <span class="string">"queue"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">for</span> (<span class="keyword">String</span> <span class="built_in">string</span> : brpop) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        System.out.<span class="built_in">println</span>(<span class="built_in">string</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>运行这个测试方法，也会进入阻塞状态。<br><strong>往queue中放入消息</strong></p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">testLpush</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    jedis.lpush(<span class="string">"queue"</span>, <span class="string">"queue_message1"</span>, <span class="string">"queue_message2"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>执行这段代码，我们将会看到两个客户端分别接受到了一条消息，而不是每条消息被共享。<br>redis-cli接受到queue_message1<br><img src="http://image.winrains.cn/2019/10/3ffd1-1458405637087040647.png" alt="QQ截图20160320004006.png"><br>Java客户端接受到</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">queue</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">queue_message2</span></pre></td></tr></table></figure>

<p>需要注意的是，阻塞队列接受到一条消息之后，就会跳出阻塞状态。如果需要不断的循环监听，则要使用while(true)将这段代码包含起来，如</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 阻塞队列</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">@Test</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBlockedQueue</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        List&lt;<span class="keyword">String</span>&gt; brpop = jedis.brpop(<span class="number">0</span>, <span class="string">"queue"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">for</span> (<span class="keyword">String</span> <span class="built_in">string</span> : brpop) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">            System.out.<span class="built_in">println</span>(<span class="built_in">string</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>此时，我们在执行testLpush方法，看到控制台输出</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">queue</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">queue_message1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">queue</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">queue_message2</span></pre></td></tr></table></figure>

<p>从现实的结果中，我们可以看出以下这段代码的返回值的组成</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">List</span>&lt;<span class="keyword">String</span>&gt; brpop = jedis.brpop(<span class="number">0</span>,<span class="string">"queue"</span>);</span></pre></td></tr></table></figure>

<p>List中的元素总是偶数个，其中奇数表示的从哪一个队列中监听到的消息，偶数表示消息的内容。</p>
<h3 id="使用-pipeline"><a href="#使用-pipeline" class="headerlink" title="使用 pipeline"></a><strong>使用 pipeline</strong></h3><p>如果希望一次发送一批 redis 命令，一种有效的方式是使用 pipeline。<br>jedis 使用 pipeline 的代码如下：</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">Pipeline p = jedis.pipelined();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">p.<span class="keyword">set</span>(<span class="string">"fool"</span>, <span class="string">"bar"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">p.zadd(<span class="string">"foo"</span>, <span class="number">1</span>, <span class="string">"barowitch"</span>); p.zadd(<span class="string">"foo"</span>, <span class="number">0</span>, <span class="string">"barinsky"</span>); p.zadd(<span class="string">"foo"</span>, <span class="number">0</span>, <span class="string">"barikoviev"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">Response</span>&lt;<span class="built_in">String</span>&gt; pipeString = p.<span class="keyword">get</span>(<span class="string">"fool"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">Response</span>&lt;<span class="keyword">Set</span>&lt;<span class="built_in">String</span>&gt;&gt; sose = p.zrange(<span class="string">"foo"</span>, <span class="number">0</span>, <span class="number">-1</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">p.sync();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> soseSize = sose.<span class="keyword">get</span>().size();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">Set</span>&lt;<span class="built_in">String</span>&gt; setBack = sose.<span class="keyword">get</span>();</span></pre></td></tr></table></figure>

<h3 id="使用-transaction"><a href="#使用-transaction" class="headerlink" title="使用 transaction"></a><strong>使用 transaction</strong></h3><p>如果希望一些命令一起执行而不被干扰，可以通过 transaction 将命令打包到一起执行：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">jedis.watch </span>(key1, key2, ...);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">BinaryTransaction </span>t = <span class="keyword">jedis.multi();</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">t.set("foo", </span><span class="string">"bar"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">t.exec();</span></pre></td></tr></table></figure>

<p>如果需要得到返回值，可以参考下面的代码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">Transaction t = jedis.multi();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">t.<span class="keyword">set</span>(<span class="string">"fool"</span>, <span class="string">"bar"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">Response&lt;<span class="built_in">String</span>&gt; result1 = t.<span class="keyword">get</span>(<span class="string">"fool"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">t.zadd(<span class="string">"foo"</span>, <span class="number">1</span>, <span class="string">"barowitch"</span>); t.zadd(<span class="string">"foo"</span>, <span class="number">0</span>, <span class="string">"barinsky"</span>); t.zadd(<span class="string">"foo"</span>, <span class="number">0</span>, <span class="string">"barikoviev"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">Response&lt;<span class="built_in">Set</span>&lt;<span class="built_in">String</span>&gt;&gt; sose = t.zrange(<span class="string">"foo"</span>, <span class="number">0</span>, <span class="number">-1</span>); <span class="comment">// get the entire sortedset</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">t.exec(); <span class="comment">// dont forget it</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span> foolbar = result1.<span class="keyword">get</span>(); <span class="comment">// use Response.get() to retrieve</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">things from a Response</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> soseSize = sose.<span class="keyword">get</span>().size(); <span class="comment">// on sose.get() you can directly</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">call <span class="built_in">Set</span> methods!</span></pre></td></tr></table></figure>

<h2 id="5-2-ShardedJedis"><a href="#5-2-ShardedJedis" class="headerlink" title="5.2 ShardedJedis"></a>5.2 ShardedJedis</h2><p>简单的说， <code>ShardedJedis</code> 是一种帮助提高读/写并发能力的群集，群集使用一致性 hash 来确保一个 key 始终被指向相同的 redis server。每个 redis server 被称为一个 shard。<br>因为每个 shard 都是一个 master，因此使用 sharding 机制会产生一些限制：不能在 sharding中直接使用 jedis 的 transactions、pipelining、pub/sub 这些 API，基本的原则是不能跨越 shard。但 jedis 并没有在 API 的层面上禁止这些行为，但是这些行为会有不确定的结果。一种可能的方式是使用 keytags 来干预 key 的分布，当然，这需要手工的干预。<br>另外一个限制是正在使用的 shards 是不能被改变的，因为所有的 sharding 都是预分片的。<br>注：如果希望使用可以改变的 shards，可以使用 yaourt - dynamic sharding implementation（一个jedis 的实现分支）。</p>
<h3 id="ShardedJedis-的使用方法："><a href="#ShardedJedis-的使用方法：" class="headerlink" title="ShardedJedis 的使用方法："></a><strong>ShardedJedis 的使用方法：</strong></h3><p><strong>1. 定义 shards:</strong></p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">List&lt;JedisShardInfo&gt; shards = new ArrayList&lt;JedisShardInfo&gt;()<span class="comment">;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">JedisShardInfo <span class="built_in">si</span> = new JedisShardInfo(<span class="string">"localhost"</span>, <span class="number">6379</span>)<span class="comment">;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">si</span><span class="number">.</span>setPassword(<span class="string">"foobared"</span>)<span class="comment">;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">shards<span class="number">.</span><span class="keyword">add</span>(<span class="built_in">si</span>)<span class="comment">;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">si</span> = new JedisShardInfo(<span class="string">"localhost"</span>, <span class="number">6380</span>)<span class="comment">;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">si</span><span class="number">.</span>setPassword(<span class="string">"foobared"</span>)<span class="comment">;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">shards<span class="number">.</span><span class="keyword">add</span>(<span class="built_in">si</span>)<span class="comment">;</span></span></pre></td></tr></table></figure>

<p><strong>2.a) 直接使用:</strong></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">ShardedJedis jedis = <span class="keyword">new</span> ShardedJedis(shards);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">jedis.<span class="built_in">set</span>(<span class="string">"a"</span>, <span class="string">"foo"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">jedis.<span class="built_in">disconnect</span>;</span></pre></td></tr></table></figure>

<p><strong>2.b) 或 使用连接池:</strong></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">ShardedJedisPool pool = <span class="keyword">new</span> <span class="constructor">ShardedJedisPool(<span class="params">new</span> Config()</span>, shards);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">ShardedJedis jedis = pool.get<span class="constructor">Resource()</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">jedis.set(<span class="string">"a"</span>, <span class="string">"foo"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">.... <span class="comment">// do your work here</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">pool.return<span class="constructor">Resource(<span class="params">jedis</span>)</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">.... <span class="comment">// a few moments later</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">ShardedJedis jedis2 = pool.get<span class="constructor">Resource()</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">jedis.set(<span class="string">"z"</span>, <span class="string">"bar"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">pool.return<span class="constructor">Resource(<span class="params">jedis</span>)</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">pool.destroy<span class="literal">()</span>;</span></pre></td></tr></table></figure>

<p><strong>判断使用的是那个 shards：</strong></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">ShardInfo si = jedis.getShardInfo(key);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">si.getHost<span class="regexp">/getPort/g</span>etPassword<span class="regexp">/getTimeout/g</span>etName</span></pre></td></tr></table></figure>

<p>也可以通过 keytags 来确保 key 位于相同的 shard。如：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ShardedJedis </span><span class="keyword">jedis </span>= new <span class="keyword">ShardedJedis(shards,</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ShardedJedis.DEFAULT_KEY_TAG_PATTERN);</span></span></pre></td></tr></table></figure>

<p>这样，默认的 keytags 是”{}”，这表示在”{}”内的字符会用于决定使用那个 shard。如：</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">jedis.<span class="keyword">set</span>(<span class="string">"foo&#123;bar&#125;"</span>, <span class="string">"12345"</span>);</span></pre></td></tr></table></figure>

<p>和</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">jedis.<span class="keyword">set</span>(<span class="string">"car&#123;bar&#125;"</span>, <span class="string">"877878"</span>);</span></pre></td></tr></table></figure>

<p>会使用同一个 shard。<br>注：如果 key 和 keytag 不匹配，会使用原来的 key 作为选择 shard 的 key。</p>
<h3 id="使用-ShardedJedisPipeline"><a href="#使用-ShardedJedisPipeline" class="headerlink" title="使用 ShardedJedisPipeline"></a><strong>使用 ShardedJedisPipeline</strong></h3><p>ShardedJedisPipeline 其实是一个很鸡肋的功能。<br>为了能在 ShardedJedis 中平滑的支持 redis 的 pipeline 的功能， ShardedJedis 通过ShardedJedisPipeline 类对 pipeline 提供了支持。<br>简单的说， ShardedJedis 是通过向每个用到的 shard 发起 pipeline 来实现 ShardedJedisPipeline的功能，这种方式如果累积的 key 不够多，很难达到提高效率的目的。<br>如果需要在 ShardedJedis 中使用 pipeline，还是建议尽量通过 keytag 将关联的 key 放到同一shard 之中。<br>ShardedJedisPipeline 简单的示例代码如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">ShardedJedis jedis = <span class="keyword">new</span> ShardedJedis(shards);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">ShardedJedisPipeline p = jedis.pipelined();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">p.<span class="keyword">set</span>(<span class="string">"foo"</span>, <span class="string">"bar"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">p.<span class="keyword">get</span>(<span class="string">"foo"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">Object</span>&gt; results = p.syncAndReturnAll();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment">//assertEquals(2, results.size());</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment">//assertEquals("OK", results.get(0));</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment">//assertEquals("bar", results.get(1));</span></span></pre></td></tr></table></figure>

<p>ShardedJedisPipeline 相对复杂的示例代码：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">ShardedJedis jedis = <span class="keyword">new</span> <span class="constructor">ShardedJedis(<span class="params">shards</span>)</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">jedis.set(<span class="string">"string"</span>, <span class="string">"foo"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">jedis.lpush(<span class="string">"list"</span>, <span class="string">"foo"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">jedis.hset(<span class="string">"hash"</span>, <span class="string">"foo"</span>, <span class="string">"bar"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">jedis.zadd(<span class="string">"zset"</span>, <span class="number">1</span>, <span class="string">"foo"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">jedis.sadd(<span class="string">"set"</span>, <span class="string">"foo"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">ShardedJedisPipeline p = jedis.pipelined<span class="literal">()</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">Response&lt;String&gt; <span class="built_in">string</span> = p.get(<span class="string">"string"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">Response&lt;Long&gt; del = p.del(<span class="string">"string"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">Response&lt;String&gt; emptyString = p.get(<span class="string">"string"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">Response&lt;String&gt; <span class="built_in">list</span> = p.lpop(<span class="string">"list"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">Response&lt;String&gt; hash = p.hget(<span class="string">"hash"</span>, <span class="string">"foo"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">Response&lt;Set&lt;String&gt;&gt; zset = p.zrange(<span class="string">"zset"</span>, <span class="number">0</span>, -<span class="number">1</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">Response&lt;String&gt; set = p.spop(<span class="string">"set"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">Response&lt;Boolean&gt; blist = p.exists(<span class="string">"list"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">Response&lt;Double&gt; zincrby = p.zincrby(<span class="string">"zset"</span>, <span class="number">1</span>, <span class="string">"foo"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">Response&lt;Long&gt; zcard = p.zcard(<span class="string">"zset"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">p.lpush(<span class="string">"list"</span>, <span class="string">"bar"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">Response&lt;List&lt;String&gt;&gt; lrange = p.lrange(<span class="string">"list"</span>, <span class="number">0</span>, -<span class="number">1</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">Response&lt;Map&lt;String, String&gt;&gt; hgetAll = p.hget<span class="constructor">All(<span class="string">"hash"</span>)</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">p.sadd(<span class="string">"set"</span>, <span class="string">"foo"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">Response&lt;Set&lt;String&gt;&gt; smembers = p.smembers(<span class="string">"set"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">Response&lt;Set&lt;Tuple&gt;&gt; zrangeWithScores = p.zrange<span class="constructor">WithScores(<span class="string">"zset"</span>, 0,-1)</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">p.sync<span class="literal">()</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(<span class="string">"foo"</span>, <span class="params">string</span>.<span class="params">get</span>()</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(Long.<span class="params">valueOf</span>(1)</span>, del.get<span class="literal">()</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span><span class="constructor">Null(<span class="params">emptyString</span>.<span class="params">get</span>()</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(<span class="string">"foo"</span>, <span class="params">list</span>.<span class="params">get</span>()</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(<span class="string">"bar"</span>, <span class="params">hash</span>.<span class="params">get</span>()</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(<span class="string">"foo"</span>, <span class="params">zset</span>.<span class="params">get</span>()</span>.iterator<span class="literal">()</span>.next<span class="literal">()</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(<span class="string">"foo"</span>, <span class="params">set</span>.<span class="params">get</span>()</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span><span class="constructor">False(<span class="params">blist</span>.<span class="params">get</span>()</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(Double.<span class="params">valueOf</span>(2)</span>, zincrby.get<span class="literal">()</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(Long.<span class="params">valueOf</span>(1)</span>, zcard.get<span class="literal">()</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(1, <span class="params">lrange</span>.<span class="params">get</span>()</span>.size<span class="literal">()</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span><span class="constructor">NotNull(<span class="params">hgetAll</span>.<span class="params">get</span>()</span>.get(<span class="string">"foo"</span>));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(1, <span class="params">smembers</span>.<span class="params">get</span>()</span>.size<span class="literal">()</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(1, <span class="params">zrangeWithScores</span>.<span class="params">get</span>()</span>.size<span class="literal">()</span>);</span></pre></td></tr></table></figure>

<h3 id="ShardedJedis实现分析"><a href="#ShardedJedis实现分析" class="headerlink" title="ShardedJedis实现分析"></a><strong>ShardedJedis实现分析</strong></h3><p>ShardedJedis是基于一致性哈希算法实现的分布式Redis集群客户端；ShardedJedis的设计分为以下几块：</p>
<ul>
<li>对象池设计：Pool，ShardedJedisPool，ShardedJedisFactory</li>
<li>面向用户的操作封装：BinaryShardedJedis，BinaryShardedJedis</li>
<li>一致性哈希实现：Sharded</li>
</ul>
<p>关于ShardedJedis设计，忽略了Jedis的设计细节，设计类图如下：<br><img src="http://image.winrains.cn/2019/10/efe05-1458475110109071209.jpg" alt="8bd3b170-018d-36a2-b2e5-44cde24caceb.jpg"><br>关于ShardedJedis类图设计，省略了对象池，以及Jedis设计的以下细节介绍：</p>
<table>
<thead>
<tr>
<th>类名</th>
<th>职责</th>
</tr>
</thead>
<tbody><tr>
<td>Sharded</td>
<td>抽象了基于一致性哈希算法的划分设计，设计思路基于hash算法划分redis服务器保持每台Redis服务器的Jedis客户端提供基于Key的划分方法；提供了ShardKeyTag实现</td>
</tr>
<tr>
<td>BinaryShardedJedis</td>
<td>同BinaryJedis类似，实现BinaryJedisCommands对外提供基于Byte[]的key，value操作</td>
</tr>
<tr>
<td>ShardedJedis</td>
<td>同Jedis类似，实现JedisCommands对外提供基于String的key，value操作</td>
</tr>
</tbody></table>
<h3 id="shared一致性哈希采用以下方案："><a href="#shared一致性哈希采用以下方案：" class="headerlink" title="shared一致性哈希采用以下方案："></a><strong>shared一致性哈希采用以下方案：</strong></h3><ol>
<li>Redis服务器节点划分：将每台服务器节点采用hash算法划分为160个虚拟节点(可以配置划分权重)</li>
<li>将划分虚拟节点采用TreeMap存储</li>
<li>对每个Redis服务器的物理连接采用LinkedHashMap存储</li>
<li>对Key or KeyTag 采用同样的hash算法，然后从TreeMap获取大于等于键hash值得节点，取最邻近节点存储；当key的hash值大于虚拟节点hash值得最大值时，存入第一个虚拟节点</li>
</ol>
<p>sharded采用的hash算法：MD5 和 MurmurHash两种；默认采用64位的MurmurHash算法；有兴趣的可以研究下，MurmurHash是一种高效，低碰撞的hash算法；<br>参考地址：<br><a href="http://blog.csdn.net/yfkiss/article/details/7337382" target="_blank" rel="noopener">http://blog.csdn.net/yfkiss/article/details/7337382</a><br><a href="https://sites.google.com/site/murmurhash/" target="_blank" rel="noopener">https://sites.google.com/site/murmurhash/</a></p>
<h2 id="5-3-使用-jedis-的对象池"><a href="#5-3-使用-jedis-的对象池" class="headerlink" title="5.3 使用 jedis 的对象池"></a>5.3 使用 jedis 的对象池</h2><p>jedis 通过 commons-pool 来提供其对象池的功能，其对象池类有 JedisPool 和 ShardedJedisPool，面向普通的 redis 连接池和 pre-sharding 的 redis 连接池。<br>在连接池的使用和配置层面，这两个类基本没什么差别。<br>配置 jedis 的连接池，一般通过 JedisPoolConfig 类完成，其提供了一个不同于基类的默认值，当然也可以通过 org.apache.commons.pool.impl.GenericObjectPool.Config 类来配置，这个类的默认值我们可以在 commons-pool 对象池配置的小节中看到。</p>
<h3 id="对象池的使用"><a href="#对象池的使用" class="headerlink" title="对象池的使用"></a><strong>对象池的使用</strong></h3><p>jedis 创建对象池的方式：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">JedisPool<span class="built_in"> pool </span>= new JedisPool(new JedisPoolConfig(), <span class="string">"localhost"</span>);</span></pre></td></tr></table></figure>

<p>使用池中的对象，是通过 JedisPool 的 getResource 和 returnResource 来得到和归还资源：</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">Jedis jedis = pool.getResource();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">/// ... do stuff here ... for example</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    jedis.<span class="built_in">set</span>(<span class="string">"foo"</span>, <span class="string">"bar"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">String</span> foobar = jedis.<span class="built_in">get</span>(<span class="string">"foo"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    jedis.zadd(<span class="string">"sose"</span>, <span class="number">0</span>, <span class="string">"car"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    jedis.zadd(<span class="string">"sose"</span>, <span class="number">0</span>, <span class="string">"bike"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    Set&lt;<span class="keyword">String</span>&gt; sose = jedis.zrange(<span class="string">"sose"</span>, <span class="number">0</span>, <span class="number">-1</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#125; <span class="keyword">catch</span> (JedisConnectionException e) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// returnBrokenResource when the state of the object is unrecoverable</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != jedis) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        pool.returnBrokenResource(jedis);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">        jedis = <span class="keyword">null</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">&#125; <span class="keyword">finally</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">/// ... it's important to return the Jedis instance to the pool once you've</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">/// finished using it</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != jedis)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">        pool.returnResource(jedis);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment">/// ... when closing your application:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">pool.destroy();</span></pre></td></tr></table></figure>

<h3 id="commons-pool-对象池配置"><a href="#commons-pool-对象池配置" class="headerlink" title="commons-pool 对象池配置"></a><strong>commons-pool 对象池配置</strong></h3><p>jedis 的对象池是通过apache的commons-pool实现的。 其对象池的配置是通过org.apache.commons.pool.impl.GenericObjectPool.Config 类完成。<br>Config 是一个简单的值对象类，其成员都有预设的默认值。<br>我们将 Config 类的各个成员的配置含义描述如下：</p>
<ul>
<li>maxActive</li>
</ul>
<p>控制池中对象的最大数量。默认值是 8，如果是负值表示没限制。</p>
<ul>
<li>maxIdle</li>
</ul>
<p>控制池中空闲的对象的最大数量。默认值是 8，如果是负值表示没限制。</p>
<ul>
<li>minIdle</li>
</ul>
<p>控制池中空闲的对象的最小数量。默认值是 0。</p>
<ul>
<li>whenExhaustedAction</li>
</ul>
<p>指定池中对象被消耗完以后的行为，有下面这些选择：<br>&gt;&gt; WHEN_EXHAUSTED_FAIL 0<br>&gt;&gt; WHEN_EXHAUSTED_GROW 2<br>&gt;&gt; WHEN_EXHAUSTED_BLOCK 1<br>如果是 WHEN_EXHAUSTED_FAIL，当池中对象达到上限以后，继续 borrowObject 会抛出NoSuchElementException 异常。<br>如果是 WHEN_EXHAUSTED_GROW，当池中对象达到上限以后，会创建一个新对象，并返回它。<br>如果是 WHEN_EXHAUSTED_BLOCK，当池中对象达到上限以后， 会一直等待，直到有一个对象可用。 这个行为还与 maxWait 有关，如果 maxWait 是正数，那么会等待 maxWait 的毫秒的时间，超时会抛出 NoSuchElementException 异常；如果 maxWait 为负值，会永久等待。<br>whenExhaustedAction 的默认值是 WHEN_EXHAUSTED_BLOCK， maxWait 的默认值是-1。</p>
<ul>
<li>maxWait</li>
</ul>
<p>whenExhaustedAction 如果是 WHEN_EXHAUSTED_BLOCK，指定等待的毫秒数。如果 maxWait是正数，那么会等待 maxWait 的毫秒的时间，超时会抛出 NoSuchElementException 异常；如果 maxWait 为负值，会永久等待。maxWait 的默认值是-1。</p>
<ul>
<li>testOnBorrow</li>
</ul>
<p>如果 testOnBorrow 被设置， pool 会在 borrowObject 返回对象之前使用 PoolableObjectFactory的 validateObject 来验证这个对象是否有效，要是对象没通过验证，这个对象会被丢弃，然后重新选择一个新的对象。testOnBorrow 的默认值是 false。</p>
<ul>
<li>testOnReturn</li>
</ul>
<p>如果 testOnReturn 被设置， pool 会在 returnObject 的时候通过 PoolableObjectFactory 的validateObject 方法验证对象，如果对象没通过验证，对象会被丢弃，不会被放到池中。testOnReturn 的默认值是 false。</p>
<ul>
<li>testWhileIdle</li>
</ul>
<p>指定 idle 对象是否应该使用 PoolableObjectFactory 的 validateObject 校验，如果校验失败，这个对象会从对象池中被清除。这个设置仅在 timeBetweenEvictionRunsMillis 被设置成正值（ &gt;0） 的时候才会生效。testWhileIdle 的默认值是 false。</p>
<ul>
<li>timeBetweenEvictionRunsMillis</li>
</ul>
<p>指定驱逐线程的休眠时间。如果这个值不是正数（ &gt;0），不会有驱逐线程运行。timeBetweenEvictionRunsMillis 的默认值是-1。</p>
<ul>
<li>numTestsPerEvictionRun</li>
</ul>
<p>设置驱逐线程每次检测对象的数量。这个设置仅在 timeBetweenEvictionRunsMillis 被设置成正值（ &gt;0）的时候才会生效。numTestsPerEvictionRun 的默认值是 3。</p>
<ul>
<li>minEvictableIdleTimeMillis</li>
</ul>
<p>指定最小的空闲驱逐的时间间隔（空闲超过指定的时间的对象，会被清除掉）。这个设置仅在 timeBetweenEvictionRunsMillis 被设置成正值（ &gt;0）的时候才会生效。minEvictableIdleTimeMillis 默认值是 30 分钟。</p>
<ul>
<li>softMinEvictableIdleTimeMillis</li>
</ul>
<p>与 minEvictableIdleTimeMillis 类似，也是指定最小的空闲驱逐的时间间隔（空闲超过指定的时间的对象，会被清除掉），不过会参考 minIdle 的值，只有 idle 对象的数量超过 minIdle 的值，对象才会被清除。<br>这个设置仅在 timeBetweenEvictionRunsMillis 被设置成正值（ &gt;0）的时候才会生效，并且这个配置能被 minEvictableIdleTimeMillis 配置取代（ minEvictableIdleTimeMillis 配置项的优先级更高）。softMinEvictableIdleTimeMillis 的默认值是-1。</p>
<ul>
<li>lifo</li>
</ul>
<p>pool 可以被配置成 LIFO 队列（ last-in-first-out）或 FIFO 队列（ first-in-first-out），来指定空闲对象被使用的次序。lifo 的默认值是 true。</p>
<h3 id="JedisPoolConfig-的调整"><a href="#JedisPoolConfig-的调整" class="headerlink" title="JedisPoolConfig 的调整"></a><strong>JedisPoolConfig 的调整</strong></h3><p>jedis 的对象池是通过 commons-pool 实现的，对对象池的配置应该通过 JedisPoolConfig 来完成， jedis 提供了自己的配置参数：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">JedisPoolConfig</span> <span class="keyword">extends</span> <span class="title">Config</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    public <span class="type">JedisPoolConfig</span>() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">// defaults to make your life with connection pool easier :)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        setTestWhileIdle(<span class="literal">true</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        setMinEvictableIdleTimeMillis(<span class="number">60000</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        setTimeBetweenEvictionRunsMillis(<span class="number">30000</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        setNumTestsPerEvictionRun(<span class="number">-1</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>简单的说，是启用了 commons-pool 的驱逐线程，并配置了驱逐线程的轮询参数。</p>
<blockquote>
<p>作者：田守芝</p>
<p>来源：<a href="http://www.tianshouzhi.com/api/tutorials/redis/199" target="_blank" rel="noopener">http://www.tianshouzhi.com/api/tutorials/redis/199</a></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%883%EF%BC%89%EF%BC%9A%E8%BF%9B%E9%98%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="congsheng.wang">
      <meta itemprop="description" content="trouble is a friend">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%883%EF%BC%89%EF%BC%9A%E8%BF%9B%E9%98%B6/" class="post-title-link" itemprop="url">Redis使用教程（3）：进阶</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-29 22:29:01" itemprop="dateCreated datePublished" datetime="2019-12-29T22:29:01+08:00">2019-12-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">Java技术</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%8A%80%E6%9C%AF/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="4-进阶"><a href="#4-进阶" class="headerlink" title="4 进阶"></a>4 进阶</h1><h2 id="4-1-事务"><a href="#4-1-事务" class="headerlink" title="4.1 事务"></a>4.1 事务</h2><h3 id="4-1-1-概述"><a href="#4-1-1-概述" class="headerlink" title="4.1.1 概述"></a><strong>4.1.1 概述</strong></h3><p>Redis中的事务（<code>transaction</code>）是一组命令的集合。事务同命令一样都是Redis的最小执行单位，一个事务中的命令要么都执行，要么都不执行。事务的应用非常普遍，如银行转账过程中A给B汇款，首先系统从A的账户中将钱划走，然后向B的账户增加相应的金额。这两个步骤必<br>须属于同一个事务，要么全执行，要么全不执行。否则只执行第一步，钱就凭空消失了，这显然让人无法接受。<br>事务的原理是先将属于一个事务的命令发送给Redis，然后再让Redis依次执行这些命令。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%883%EF%BC%89%EF%BC%9A%E8%BF%9B%E9%98%B6/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%882%EF%BC%89%EF%BC%9A%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="congsheng.wang">
      <meta itemprop="description" content="trouble is a friend">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%882%EF%BC%89%EF%BC%9A%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">Redis使用教程（2）：入门</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-29 13:29:17" itemprop="dateCreated datePublished" datetime="2019-12-29T13:29:17+08:00">2019-12-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">Java技术</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%8A%80%E6%9C%AF/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="3-入门"><a href="#3-入门" class="headerlink" title="3 入门"></a>3 入门</h1><p>学会了如何安装和运行Redis，并了解了Redis的基础知识后，本章将详细介绍Redis的五种数据类型及相应的命令，带领读者真正进入Redis的世界。在学习的时候，手边打开一个redis-cli程序来跟着一起输入命令将会极大地提高学习效率。<br>在之后的章节中你会遇到两个学习伙伴：小白和宋老师。小白是一个标准的极客，最近刚开始他的Redis学习之旅，而他大学时的计算机老师宋老师恰好对 Redis颇有研究，于是就顺理成章地成为了小白的私人Redis教师。这不，小白想基于Redis开发一个博客，于是找到宋老师，向他请教。在本章中宋老师会向小白介绍Redis最核心的内容——数据类型，从他们的对话中你一定能学到不少知识！<br>3.2节到3.6节这5节将分别介绍Redis的5种数据类型，其中每节都是由4个部分组成，依次是“介绍”、“命令”、“实践”和“命令拾遗”。“介绍”部分是对数据类型的概述，“命令”部分会对“实践”部分将用到的命令进行介绍，“实践”部分会讲解该数据类型在开发中的应用方法，“命令拾遗”部分会对该数据类型其他比较有用的命令进行补充介绍。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%882%EF%BC%89%EF%BC%9A%E5%85%A5%E9%97%A8/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%881%EF%BC%89%EF%BC%9A%E5%87%86%E5%A4%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="congsheng.wang">
      <meta itemprop="description" content="trouble is a friend">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%881%EF%BC%89%EF%BC%9A%E5%87%86%E5%A4%87/" class="post-title-link" itemprop="url">Redis使用教程（1）：准备</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-29 13:28:43" itemprop="dateCreated datePublished" datetime="2019-12-29T13:28:43+08:00">2019-12-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">Java技术</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%8A%80%E6%9C%AF/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-Redis简介"><a href="#1-Redis简介" class="headerlink" title="1 Redis简介"></a>1 Redis简介</h1><p><img src="http://image.winrains.cn/2019/10/5cca8-1458321704791041932.png" alt="QQ截图20160319012123.png"><br>Redis是一个开源的高性能键值对数据库。它通过提供多种键值数据类型来适应不同场景下的存储需求，并借助许多高层级的接口使其可以胜任如缓存、队列系统等不同的角色。本章将分别介绍Redis的历史和特性，以使读者能够快速地对Redis有一个全面的了解。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/12/29/Redis%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%881%EF%BC%89%EF%BC%9A%E5%87%86%E5%A4%87/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2019/12/29/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="congsheng.wang">
      <meta itemprop="description" content="trouble is a friend">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/29/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">数据库中间件详解</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-29 13:28:06" itemprop="dateCreated datePublished" datetime="2019-12-29T13:28:06+08:00">2019-12-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-数据库拆分过程及挑战"><a href="#1-数据库拆分过程及挑战" class="headerlink" title="1 数据库拆分过程及挑战"></a><strong>1 数据库拆分过程及挑战</strong></h1><p>互联网当下的数据库拆分过程基本遵循的顺序是：垂直拆分、读写分离、分库分表(水平拆分)。每个拆分过程都能解决业务上的一些问题，但同时也面临了一些挑战。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/12/29/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%AF%A6%E8%A7%A3/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2019/12/29/RESTful-API%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="congsheng.wang">
      <meta itemprop="description" content="trouble is a friend">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/29/RESTful-API%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" class="post-title-link" itemprop="url">RESTful API的设计原则</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-29 13:27:31" itemprop="dateCreated datePublished" datetime="2019-12-29T13:27:31+08:00">2019-12-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%85%B6%E5%AE%83%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">其它技术</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%85%B6%E5%AE%83%E6%8A%80%E6%9C%AF/Restful/" itemprop="url" rel="index">
                    <span itemprop="name">Restful</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>做出一个好的API设计很难。API表达的是你的数据和你的数据使用者之间的契约。打破这个契约将会招致很多愤怒的邮件，和一大堆伤心的用户-因为他们手机上的App不工作了。而文档化只能达到一半的效果，并且也很难找到一个愿意写文档的程序员。<br>你所能做的最重要一件事来提高服务的价值就是创建一个API。因为随着其他服务的成长，有这样一个API会使你的服务或者核心应用将有机会变成一个平台。环顾一下现有的这些大公司：Facebook，Twitter，Google， Github，Amazon，Netflix等。如果当时他们没有通过API来开放数据的话，也不可能成长到如今的规模。事实上，整个行业存在的唯一目的就是消费所谓平台上的数据。<br><strong>你的API越容易使用，那么就会有越多的人去用它。</strong><br>本文提到的这些原则，如果你的API能严格按照这些原则来设计，使用者就可以知道它接下来要做什么，并且能减少大量不必要的疑惑或者是愤怒的邮件。我已经把所有内容都整理到不同的主题里了，你无需按顺序去阅读它。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/12/29/RESTful-API%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://congsheng.wang/2019/12/29/%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81%E5%AE%9A%E4%B8%8E%E5%BB%B6%E8%BF%9F%E5%88%9D%E5%A7%8B%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="congsheng.wang">
      <meta itemprop="description" content="trouble is a friend">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/29/%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81%E5%AE%9A%E4%B8%8E%E5%BB%B6%E8%BF%9F%E5%88%9D%E5%A7%8B%E5%8C%96/" class="post-title-link" itemprop="url">双重检查锁定与延迟初始化</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-29 13:26:58" itemprop="dateCreated datePublished" datetime="2019-12-29T13:26:58+08:00">2019-12-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">Java技术</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在 java 程序中，有时候可能需要推迟一些高开销的对象初始化操作，并且只有在使用这些对象时才进行初始化。此时程序员可能会采用延迟初始化。但要正确实现线程安全的延迟初始化需要一些技巧，否则很容易出现问题。比如，下面是非线程安全的延迟初始化对象的示例代码：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public class UnsafeLazyInitialization &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">   <span class="keyword"> private</span><span class="keyword"> static</span> Instance instance;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">   <span class="keyword"> public</span><span class="keyword"> static</span> Instance getInstance() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">       <span class="built_in"> if </span>(instance == null) // 1：A 线程执行</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">           <span class="built_in"> instance </span>=<span class="built_in"> new </span>Instance(); // 2：B 线程执行</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">       <span class="built_in"> return </span>instance;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/12/29/%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81%E5%AE%9A%E4%B8%8E%E5%BB%B6%E8%BF%9F%E5%88%9D%E5%A7%8B%E5%8C%96/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/49/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/49/">49</a><span class="page-number current">50</span><a class="page-number" href="/page/51/">51</a><span class="space">&hellip;</span><a class="page-number" href="/page/99/">99</a><a class="extend next" rel="next" href="/page/51/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">congsheng.wang</p>
  <div class="site-description" itemprop="description">trouble is a friend</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">984</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">94</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">156</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">congsheng.wang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.6.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
